---
description: 文档维护与反向更新规则（避免 doc 过时）
---

# 文档维护规则（doc/）

目标：让 `doc/` 的 SRS/PRD 始终可用，且能跟随代码演进而不持续过时。

## 适用范围

- `doc/**`
- `.cursor/rules/**`（与文档相关的规范）

## 基本原则

- **先查证再改**：任何文档中的“事实描述”（接口、路由、数据模型、鉴权、存储、日志策略）在更新前必须先从代码/配置中验证（只读）。
- **不改业务代码**：进行 doc 维护时，默认禁止修改 `prd-api/`、`prd-admin/`、`prd-desktop/` 的业务实现。若必须改代码，需由仓库维护者明确授权。
- **遇到重大冲突先上报**：当“文档/安全红线”与“代码实现”显著冲突时：
  - 先列出差异（哪些文件/哪些行为）；
  - 再列出冲突点与风险；
  - 最后由维护者决策“以代码为准修文档”还是“以文档为准改实现”。

## 文档更新触发器（发生即应更新 doc）

- **新增/删除/改名** API 路由、Admin 路由、Desktop IPC/关键调用点
- **鉴权变更**：匿名/登录/角色权限变化（尤其是 ADMIN 专用接口）
- **数据语义变更**：例如模型唯一键变更（必须遵循 `.cursor/rules/model-identity.mdc`）
- **Run/任务化链路变更**：runId、断线续传、幂等、worker 等
- **日志/脱敏/存储策略变化**：尤其涉及 PRD 原文、用户内容、密钥类字段

## 脱敏与留存（协作约束）

- **密钥类字段必须脱敏**：API Key / Token / Secret / Password / 证书内容不得写入仓库、不得出现在文档示例的真实值中。
- **个人信息不得入日志示例**：示例中使用占位符（如 `userId: "u_xxx"`）。
- **PRD 原文留存是“需决策项”**：文档必须明确当前实现与目标策略；若两者不一致，必须标注“待决策”。

## 文档结构建议（便于长期维护）

- `doc/2.srs.md`：稳定契约（接口/错误码/鉴权/幂等/Run/SSE/数据模型/非功能）
- `doc/3.prd.md`：产品功能与用户价值（模块清单/流程/验收口径）
- 允许新增 `doc/0.doc-maintenance.md` 作为维护流程说明与差异汇总入口

