---
alwaysApply: true
---

# Workflow Rules

## Global Constraints (MUST follow)

- **No emoji**: Do not use emoji in any content
- Year is 2026
- Fast dev phase: no backward compatibility; ok to delete the database
- Multi-agent parallel work: keep git isolation, avoid touching other agent areas
- Do not revert any code without explicit permission

## Execution Discipline

### Read Before Write
- Must read related files before modifying code, no guessing
- Prefer parallel reads for multiple potentially related files
- When user specifies a path, must open and confirm before modifying

### Local Self-Check
- After modification, only lint/type-check the changed scope
- Do not proactively lint the entire repo (unless user requests)
- Must fix lint errors before continuing
- Sub-project required self-check commands are in corresponding rule files:
  - `prd-admin/`: see `.cursor/rules/prd-admin.mdc`
  - `prd-desktop/`: see `.cursor/rules/prd-desktop.mdc`
  - `prd-api/`: see `.cursor/rules/prd-api.mdc`

### Commit Discipline
- Commit message focuses on "why" not "what"
- Do not include sensitive info in commit/PR
- Use HEREDOC format for multi-line commit messages

## Documentation Map (read by task type)

| Doc | Purpose | When to Read |
|-----|---------|--------------|
| `doc/1.why.md` | Project background, design principles | Understanding product boundaries |
| `doc/2.srs.md` | **Requirement baseline**: architecture, API, data model | Implementing interfaces/data structures |
| `doc/3.prd.md` | **Feature baseline**: user scenarios, feature list | Adding features/understanding business flow |
| `doc/4.dev.md` | **Dev handbook**: directory structure, setup, naming | Writing code/configuring environment |
| `doc/5.step.md` | Progress tracking, release flow | Checking milestones, release steps |

### Reference Priority
1. **Requirement/Spec conflict**: `doc/2.srs.md` and `doc/3.prd.md` take precedence
2. **Implementation/Engineering conflict**: `doc/4.dev.md` takes precedence
3. **Progress/Release**: `doc/5.step.md` is for reference only

## Parallel Optimization
- Multiple independent read/search operations should be initiated in parallel
- Multiple independent file modifications can be batched (when no dependencies)
- Avoid serial tool calls in loops
