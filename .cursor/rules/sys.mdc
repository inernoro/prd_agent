---
alwaysApply: true
---

# PRD Agent 开发规范

## 技术栈

### 桌面客户端 (prd-agent-desktop/)
- Tauri 2.0+ / Rust 1.70+ / React 18 / TypeScript 5
- 状态管理: Zustand
- UI: Tailwind CSS + Radix UI
- IPC命令放 `src-tauri/src/commands/`

### 后端服务 (PrdAgent.Server/)
- .NET 8.0 / ASP.NET Core / C# 12
- 分层: Api → Core → Infrastructure
- 数据库: MongoDB 8.0+（MongoDB.Driver）
- 缓存: Redis
- 日志: Serilog（结构化）

### Web管理后台 (prd-agent-admin/)
- React 18 / TypeScript 5 / Vite / Ant Design 5

## API规范

- RESTful + SSE流式响应
- 基础路径: `/api/v1/`
- 认证: Bearer JWT
- 响应格式:
```json
{ "success": true, "data": {}, "error": null }
```
- 错误响应:
```json
{ "success": false, "data": null, "error": { "code": "ERROR_CODE", "message": "描述" } }
```

## 错误码

| 码 | HTTP | 说明 |
|---|---|---|
| INVALID_FORMAT | 400 | 格式不支持 |
| CONTENT_EMPTY | 400 | 内容为空 |
| DOCUMENT_TOO_LARGE | 413 | 文档超10MB |
| SESSION_NOT_FOUND | 404 | 会话不存在 |
| SESSION_EXPIRED | 410 | 会话已过期 |
| RATE_LIMITED | 429 | 限流 |
| PERMISSION_DENIED | 403 | 无权限 |
| LLM_ERROR | 502 | LLM调用失败 |

## 安全约束

- PRD内容仅存缓存，不落盘
- 敏感配置用环境变量，不入仓库
- 日志脱敏，不记录用户原文/密钥
- 所有通信HTTPS (TLS 1.2+)
- 写接口支持 Idempotency-Key

## 角色枚举

- `PM` - 产品经理（可创建群组、上传PRD）
- `DEV` - 开发（技术视角）
- `QA` - 测试（验证视角）
- `ADMIN` - 超管（Web后台管理）

## 性能指标

- 问答首字延迟 < 2s
- 文档上传响应 < 3s（10万字内）
- 会话超时 30分钟
- LLM调用超时 60s，重试≤3次（指数退避）

## 命名约定

- 后端: PascalCase 类/方法，camelCase 变量
- 前端: camelCase 变量/函数，PascalCase 组件
- API路径: kebab-case
- MongoDB集合: 全小写（如 users, groups, messages）
- 文档字段: camelCase