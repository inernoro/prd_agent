---
description: prd-admin（Web 管理后台）约束与自检
globs: prd-admin/**
---

# prd-admin（Web 管理后台）规则

## 技术栈
- React 18.3 / TypeScript 5.6 / Vite 6.0
- Radix UI (dialog, dropdown-menu, scroll-area, select, switch, tabs, tooltip)
- Tailwind CSS 4.1 + tailwind-merge + clsx
- Zustand 5.0（状态管理）
- Lucide React（图标）
- React Router DOM 7.0
- Lexical 0.39（富文本编辑器）
- ECharts 6.0（图表）
- Three.js + @react-three/fiber（3D 效果）
- react-markdown + remark-gfm + rehype-raw（Markdown 渲染）
- dayjs（日期处理）
- vitest（测试）
- Playwright（E2E/视觉回归）

## 命名约定
- 变量/函数: camelCase
- React 组件: PascalCase
- CSS 类名: Tailwind 原子类

## 视觉规范（管理后台）
- 页面级列表/卡片集合必须放在「背板/容器」内，避免直接裸露在大面积背景上
- 背板推荐使用 `GlassCard` 的 `subtle` 变体且关闭 `glow`，避免与内层卡片叠加产生色差
- **按钮不换行**：按钮内文字必须保持单行，使用 `whitespace-nowrap` 或 `shrink-0` 防止换行

## API 路由约定

- **后台 API 基础路径**: `/api/{module}`（如 `/api/users`、`/api/mds`、`/api/authz`）
- **禁止版本化路径**: 新增 API 不得使用 `/v1/`、`/v2/` 等版本号
- **历史兼容**: 老接口 `/api/v1/xxx` 暂时保留，新接口必须使用 `/api/{module}` 格式
- API 路径定义统一在 `src/services/api.ts` 维护

## 用户头像获取规范

**【重要】获取用户头像必须使用 `avatarFileName`，禁止使用 `username`！**

原因：
- `username` 会被 `resolveAvatarUrl` 拼接成 `{username}.png`
- 用户头像可能是 `.gif`、`.jpg` 等其他格式，使用 `username` 会导致 404

正确做法：

```typescript
// ✓ 正确：使用 avatarFileName
resolveAvatarUrl({ avatarFileName: user.avatarFileName })

// ✗ 错误：使用 username（会强制拼接 .png）
resolveAvatarUrl({ username: user.username })
```

后端模型存储用户信息时：

```csharp
// ✓ 正确：存储 AvatarFileName
public string? ReporterAvatarFileName { get; set; }

// ✗ 错误：存储 Username 用于头像
public string? ReporterUsername { get; set; }
```

推荐使用 `getUserAvatarUrl` 辅助函数：

```typescript
import { getUserAvatarUrl } from '@/lib/avatar';
const avatarUrl = getUserAvatarUrl({ avatarFileName: user.avatarFileName });
```

## 局部前置自检（避免 CI 才爆）

当你改动了 `prd-admin/src/**`、依赖、Vite 配置时，必须执行：
- `pnpm -C prd-admin lint`
- `pnpm -C prd-admin tsc --noEmit`
