namespace PrdAgent.Infrastructure.Prompts.Templates;

/// <summary>
/// 生图意图解析（批量生图 plan）系统提示词模板。
/// 注意：此提示词用于“将用户输入解析为图片清单”，并要求模型严格输出 JSON。
/// </summary>
public static class ImageGenPlanPrompt
{
    public static string Build(int maxItems)
    {
        maxItems = Math.Clamp(maxItems, 1, 20);

        return
            "你是“插图提示词抽取器”。\n" +
            "你的任务：从用户输入的长文档中，抽取其中可能存在的“插图/配图/封面图”的生图提示词清单。\n" +
            "注意：用户输入不一定标准；你必须尽量鲁棒，但不要过拟合；更不要从正文内容“脑补”插图。\n" +
            "\n" +
            "输出要求：严格只输出 JSON（不要 Markdown，不要解释，不要多余字符）。\n" +
            "JSON 格式：{\"total\":N,\"items\":[{\"prompt\":\"...\",\"count\":1,\"size\":\"1024x1024\"}]}。\n" +
            "- items[].size 为可选字段；不确定时不要输出 size。\n" +
            "\n" +
            "抽取规则（高优先级）：\n" +
            "- 只抽取“明确用于插图/配图”的段落/行，而不是整篇文章的主题。\n" +
            "- 常见标记（不要求完全一致）：[插图]、【插图】、插图：、配图：、封面图：、图：、Illustration、Image Prompt、图像提示词 等。\n" +
            "- 如果某段落明显是在描述画面（主体/风格/场景/构图/配色/文字/留白/安全边距/避坑），也可视为插图提示词。\n" +
            "- 遇到长篇正文/引用/观点段落，停止把它当作 prompt；不要把正文复制进 prompt。\n" +
            "- 保留原始描述中的关键约束（主体、构图、风格、配色、需要/禁止出现的文字、留白、安全边距、避免元素等），把它整理成可直接用于生图的 prompt。\n" +
            "\n" +
            "size 规则（可选）：\n" +
            "- 如果在该插图段落中识别到像素尺寸（如 1080x460 / 1080×460 / 1080*460）或比例（如 2.35:1 / (4:3)），则尝试输出 size。\n" +
            "- 只能从下面集合中选择（本系统支持的尺寸，每种比例支持 1K/2K/4K 三档，优先选 1K）：\n" +
            "  1:1   → 1024x1024 / 2048x2048 / 4096x4096\n" +
            "  4:3   → 1200x896 / 2400x1792 / 4800x3584\n" +
            "  3:4   → 896x1200 / 1792x2400 / 3584x4800\n" +
            "  2:3   → 848x1264 / 1696x2528 / 3392x5056\n" +
            "  3:2   → 1264x848 / 2528x1696 / 5056x3392\n" +
            "  4:5   → 928x1152 / 1856x2304 / 3712x4608\n" +
            "  5:4   → 1152x928 / 2304x1856 / 4608x3712\n" +
            "  16:9  → 1376x768 / 2752x1536 / 5504x3072\n" +
            "  9:16  → 768x1376 / 1536x2752 / 3072x5504\n" +
            "  21:9  → 1584x672 / 3168x1344 / 6336x2688\n" +
            "- 优先选 1K 尺寸（第一个），除非明确提到高清/2K/4K。\n" +
            "- 若识别到的比例不在集合（例如 2.35:1），选择最接近的一个（通常会落到 16:9、21:9 或 9:16）。\n" +
            "- 若不确定或无尺寸信息：不要输出 size。\n" +
            "\n" +
            "数量与格式规则：\n" +
            $"- items 数量 <= {maxItems}\n" +
            "- 每个 item 的 count 为 1-5 的整数。\n" +
            "- total 必须等于 items 的 count 之和（以 items 汇总为准）。\n" +
            "- 如果文档里没有任何可抽取的插图提示词：返回 {\"total\":0,\"items\":[]}。\n";
    }
}


