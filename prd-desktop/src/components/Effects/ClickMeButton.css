/*
  基于 thirdparty/ref/clickme.html 提炼的 clickme 动效。
  说明：为避免污染全局样式，所有选择器都以 prd-clickme 前缀。
*/

@property --prdClickmeMask {
  syntax: "<angle>";
  inherits: false;
  initial-value: 33deg;
}

@keyframes prdClickmeSpin {
  0% { --prdClickmeMask: 0deg; }
  100% { --prdClickmeMask: 360deg; }
}

@keyframes prdClickmeWipe {
  0% { mask-position: 200% center; }
  100% { mask-position: 0% center; }
}

@keyframes prdClickmePulse {
  0%, 90%, 100% { opacity: 0; }
  20% { opacity: 1; }
}

@keyframes prdClickmePulse2 {
  0% { opacity: 0; }
  8% { opacity: 1; }
  14% { opacity: 0; }
  20% { opacity: 1; }
  100% { opacity: 0; }
}

@keyframes prdClickmeFlicker {
  0% { opacity: 0.1; mask-image: none; }
  1% { opacity: 1; }
  2% { opacity: 0.5; }
  3% { opacity: 0.1; }
  4% { opacity: 0.7; }
  5% { opacity: 1; }
  7% {
    opacity: 0.7;
    mask-image: linear-gradient(90deg, transparent 15%, black 45%, black 55%, transparent 85%);
  }
  8% { opacity: 0.1; }
  10% { opacity: 0.4; }
  13% { opacity: 1; }
  15% {
    opacity: 0.1;
    mask-image: linear-gradient(45deg, rgba(0,0,0,0.4) 25%, transparent 45%, black 65%, black 90%, transparent 100%);
  }
  17% { opacity: 0.8; }
  19% { opacity: 0.3; }
  21.5% { opacity: 0; }
  23% { opacity: 1; }
  39% { opacity: 0.7; }
  45% { opacity: 0.2; }
  49% { opacity: 0.9; }
  52% { opacity: 0.7; }
  53.5% {
    opacity: 0.2;
    mask-image: linear-gradient(90deg, black 15%, black 45%, rgba(0,0,0,0.4) 75%, transparent 85%);
  }
  57% { opacity: 0.8; }
  63% { opacity: 1; }
  75% { opacity: 0.85; }
  77% { opacity: 1; }
  80% { opacity: 0.9; }
  82% { opacity: 0.95; }
  83% { opacity: 0.85; }
  86% { opacity: 1; }
  89% { opacity: 0.85; }
  91% { opacity: 1; }
  92% { opacity: 0.9; }
  100% { opacity: 1; }
}

/* 轻微的“点一下”诱导：不依赖 hover */
@keyframes prdClickmeNudge {
  0%, 72%, 100% { transform: translateY(0) scale(1); }
  78% { transform: translateY(-1px) scale(1.01); }
  84% { transform: translateY(0) scale(1.005); }
  90% { transform: translateY(-1px) scale(1.012); }
  96% { transform: translateY(0) scale(1); }
}

.prd-clickmeBtn {
  /* 只做“外圈诱导动效”，不改变按钮本体配色/hover（由外部 className 决定） */
  --prd-clickme-glow: rgba(99, 102, 241, 0.35);  /* indigo */
  --prd-clickme-glow2: rgba(168, 85, 247, 0.22); /* purple */

  /* 复刻 ref 的 shimmer 配色（只用于光效，不改按钮底色） */
  --shimmer-hue-1: 213deg;
  --shimmer-sat-1: 95%;
  --shimmer-lit-1: 91%;
  --shimmer-hue-2: 248deg;
  --shimmer-sat-2: 100%;
  --shimmer-lit-2: 86%;

  position: relative;
  isolation: isolate;
  text-transform: unset;
}

.prd-clickmeBtn:disabled {
  animation: none;
}

.prd-clickmeBtn[data-nudge='1'] {
  animation: prdClickmeNudge 2.6s ease-in-out infinite;
}

.prd-clickmeLabel {
  position: relative;
  z-index: 1;
}

.prd-clickmeShimmer {
  position: absolute;
  /* 关键：把扩散半径收敛，避免“紫色云雾”污染周围 UI */
  inset: -10px;
  border-radius: inherit;
  opacity: 0.9;
  filter: blur(6px);
  z-index: 0;
  pointer-events: none;
}

.dark .prd-clickmeShimmer {
  /* 深色背景下允许更亮一些（更清晰） */
  mix-blend-mode: plus-lighter;
  opacity: 1;
  filter: blur(7px);
}

.prd-clickmeShimmer::before,
.prd-clickmeShimmer::after {
  content: "";
  position: absolute;
  inset: 10px;
  border-radius: inherit;
}

.prd-clickmeShimmer::before {
  /* 更贴近 ref 的“外发光”层（强度下调，避免发脏） */
  box-shadow:
    0 0 2px 1px hsl(var(--shimmer-hue-1) 35% 92% / 0.55),
    0 0 10px 2px hsl(var(--shimmer-hue-1) 55% 70% / 0.35),
    0 0 18px 5px hsl(var(--shimmer-hue-2) 70% 65% / 0.28);
  z-index: -1;
}

.prd-clickmeShimmer::after {
  /* 内侧细描边，提升“环”边界可见性 */
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.22);
  z-index: 2;
}

/* 默认效果：flicker */
.prd-clickmeBtn:not(:disabled) .prd-clickmeShimmer {
  mask-image: none;
  animation: prdClickmeFlicker 3.33s ease infinite both -0.5s;
}

.prd-clickmeBtn:disabled .prd-clickmeShimmer {
  display: none;
}

.prd-clickmeBtn:not(:disabled)[data-effect='spin'] .prd-clickmeShimmer {
  /* 回到 ref 的实现：旋转 mask 变量，不用 mask-composite，避免 WebView 差异 */
  inset: -12px;
  opacity: 0.95;
  filter: blur(8px);
  mask-image: conic-gradient(
    from var(--prdClickmeMask, 0deg),
    transparent 0%,
    transparent 12%,
    black 36%,
    black 46%,
    transparent 52%,
    transparent 64%,
    black 86%,
    black 96%,
    transparent 100%
  );
  mask-size: cover;
  animation: prdClickmeSpin 1.8s linear infinite both -0.5s;
}

.prd-clickmeBtn:not(:disabled)[data-effect='wipe'] .prd-clickmeShimmer {
  mask-image: linear-gradient(90deg, transparent 20%, black 88%, transparent 90%);
  mask-size: 200% 200%;
  mask-position: center;
  animation: prdClickmeWipe 1.5s linear infinite both -0.5s;
}

.prd-clickmeBtn:not(:disabled)[data-effect='wave'] .prd-clickmeShimmer {
  mask-image: linear-gradient(90deg, transparent 15%, black 45%, black 55%, transparent 85%);
  mask-size: 200% 200%;
  mask-position: center;
  animation: prdClickmeWipe 3s linear infinite both -0.5s;
}

.prd-clickmeBtn:not(:disabled)[data-effect='throb'] .prd-clickmeShimmer {
  mask-image: none;
  animation: prdClickmePulse 3s ease infinite both -0.5s;
}

.prd-clickmeBtn:not(:disabled)[data-effect='pulse'] .prd-clickmeShimmer {
  mask-image: none;
  animation: prdClickmePulse2 3s ease infinite both -0.5s;
}

.prd-clickmeBtn:not(:disabled)[data-effect='flicker'] .prd-clickmeShimmer {
  mask-image: none;
  animation: prdClickmeFlicker 3.33s ease infinite both -0.5s;
}

@media (prefers-reduced-motion: reduce) {
  .prd-clickmeBtn[data-nudge='1'] {
    animation: none;
  }
  .prd-clickmeShimmer {
    animation: none !important;
  }
}
