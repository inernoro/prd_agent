@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --color-primary: #0ea5e9;
  --color-surface: #ffffff;
  --color-background: #f8fafc;
  --color-text: #1e293b;
  --color-text-secondary: #64748b;
  --color-border: #e2e8f0;

  /* Glass tokens (light, B: 克制) */
  --glass-bg: rgba(255, 255, 255, 0.72);
  --glass-bg-strong: rgba(255, 255, 255, 0.86);
  --glass-ring: rgba(15, 23, 42, 0.08);
  --glass-shadow: 0 14px 40px rgba(2, 6, 23, 0.10);

  /* Control tokens (light) */
  --control-bg: rgba(255, 255, 255, 0.78);
  --control-ring: rgba(15, 23, 42, 0.12);
  --control-focus-ring: rgba(14, 165, 233, 0.35);
  --control-placeholder: rgba(30, 41, 59, 0.45);

  /* Markdown tokens (light) */
  --md-text: var(--color-text);
  --md-muted: var(--color-text-secondary);
  --md-border: var(--color-border);
  --md-link: #0369a1;
  --md-code-bg: #f8fafc;
  --md-code-text: #0f172a;
  --md-inline-code-bg: rgba(2, 132, 199, 0.08);
  --md-inline-code-text: #0b4a6f;
  --md-quote-border: rgba(2, 132, 199, 0.35);
}

.dark {
  --color-primary: #38bdf8;
  --color-surface: #1e293b;
  --color-background: #0f172a;
  --color-text: #f1f5f9;
  --color-text-secondary: #94a3b8;
  --color-border: #334155;

  /* Glass tokens (dark, B: 克制/更稳) */
  --glass-bg: rgba(15, 23, 42, 0.55);
  --glass-bg-strong: rgba(15, 23, 42, 0.72);
  --glass-ring: rgba(255, 255, 255, 0.10);
  --glass-shadow: 0 18px 54px rgba(0, 0, 0, 0.55);

  /* Control tokens (dark) */
  --control-bg: rgba(255, 255, 255, 0.06);
  --control-ring: rgba(255, 255, 255, 0.14);
  --control-focus-ring: rgba(56, 189, 248, 0.30);
  --control-placeholder: rgba(241, 245, 249, 0.35);

  /* Markdown tokens (dark) */
  --md-text: var(--color-text);
  --md-muted: var(--color-text-secondary);
  --md-border: var(--color-border);
  --md-link: #7dd3fc;
  --md-code-bg: rgba(2, 6, 23, 0.65);
  --md-code-text: #e2e8f0;
  --md-inline-code-bg: rgba(56, 189, 248, 0.12);
  --md-inline-code-text: #bae6fd;
  --md-quote-border: rgba(56, 189, 248, 0.45);
}

/*
 * Dark mode prose: hardcoded overrides for Tailwind typography variables.
 *
 * The primary fix is in MarkdownRenderer.tsx (rehypeStripInlineColors plugin)
 * which strips inline color styles from raw HTML in PRD content. This CSS
 * block provides a safety net by setting all prose variables to concrete
 * dark-mode values, avoiding CSS variable chain resolution issues in WebView.
 */
.dark .prose {
  color: #f1f5f9;
  --tw-prose-body: #f1f5f9;
  --tw-prose-headings: #f1f5f9;
  --tw-prose-lead: #f1f5f9;
  --tw-prose-bold: #f1f5f9;
  --tw-prose-quotes: #f1f5f9;
  --tw-prose-counters: #94a3b8;
  --tw-prose-bullets: #94a3b8;
  --tw-prose-captions: #94a3b8;
  --tw-prose-code: #bae6fd;
  --tw-prose-pre-code: #e2e8f0;
  --tw-prose-pre-bg: rgba(2, 6, 23, 0.65);
  --tw-prose-links: #7dd3fc;
  --tw-prose-hr: #334155;
  --tw-prose-quote-borders: rgba(56, 189, 248, 0.45);
  --tw-prose-th-borders: #334155;
  --tw-prose-td-borders: #334155;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  height: 100%;
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  background-color: var(--color-background);
  color: var(--color-text);
  /* 外层不允许滚动：滚动只发生在内部可滚容器（如消息列表） */
  overflow: hidden;
  overscroll-behavior: none;
}

@layer components {
  /* 面板/卡片：弱 ring + 轻 blur + 柔和阴影 */
  .ui-glass-panel {
    background: var(--glass-bg);
    border: 1px solid var(--glass-ring);
    box-shadow: var(--glass-shadow);
    border-radius: 1rem; /* 16px */
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  /* 弹窗容器：更稳的底色（更不透），避免“发白” */
  .ui-glass-modal {
    background: var(--glass-bg-strong);
    border: 1px solid var(--glass-ring);
    box-shadow: var(--glass-shadow);
    border-radius: 1.25rem; /* 20px */
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }

  /* 登录页专用玻璃卡片：更“透”以便看到毛玻璃效果（需要背后有纹理/光晕） */
  .ui-login-card {
    background: rgba(255, 255, 255, 0.58);
    border: 1px solid rgba(15, 23, 42, 0.10);
    box-shadow:
      0 20px 60px rgba(2, 6, 23, 0.10),
      0 1px 0 rgba(255, 255, 255, 0.65) inset;
    border-radius: 1.25rem; /* 20px */
    backdrop-filter: blur(18px) saturate(135%);
    -webkit-backdrop-filter: blur(18px) saturate(135%);
  }
  .dark .ui-login-card {
    background: rgba(2, 6, 23, 0.52);
    border: 1px solid rgba(255, 255, 255, 0.14);
    box-shadow:
      0 22px 70px rgba(0, 0, 0, 0.62),
      0 1px 0 rgba(255, 255, 255, 0.06) inset;
    backdrop-filter: blur(18px) saturate(120%);
    -webkit-backdrop-filter: blur(18px) saturate(120%);
  }

  /* 输入控件：统一边界与 focus ring（避免亮边框跳变） */
  .ui-control {
    background: var(--control-bg);
    border: 1px solid var(--control-ring);
    color: var(--color-text);
    border-radius: 0.75rem; /* 12px */
  }
  .ui-control::placeholder {
    color: var(--control-placeholder);
  }
  .ui-control:focus,
  .ui-control:focus-visible {
    outline: none;
    border-color: transparent;
    box-shadow: 0 0 0 3px var(--control-focus-ring);
  }

  /* chip/pill：更克制的“细线无边框感” */
  .ui-chip {
    border-radius: 9999px;
    border: 1px solid var(--glass-ring);
    background: rgba(255, 255, 255, 0.06);
  }
  .dark .ui-chip {
    background: rgba(0, 0, 0, 0.18);
  }

  /* 顶部/侧栏 bar：更像玻璃，不抢内容 */
  .ui-glass-bar {
    background: var(--glass-bg-strong);
    border-color: var(--glass-ring);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
}

@layer utilities {
  /* 主题语义色：优先使用语义 token（避免深色硬编码导致浅色不适配） theme-scan-ignore */
  .text-text-primary { color: var(--color-text); }
  .text-text-secondary { color: var(--color-text-secondary); }
  .border-border { border-color: var(--color-border); }
  .bg-surface { background-color: var(--color-surface); }
  .bg-background { background-color: var(--color-background); }

  /* 消息气泡性能优化：使用 CSS contain 限制重绘/重排范围 */
  .message-item-contain {
    contain: layout style paint;
  }
}

/* =========================================
 * Theme linear transition (desktop)
 * - 目标：直接线性过渡到目标主题颜色（避免白->黑->白闪烁）
 * - 实现：切换主题时临时给 html 加 theme-transitioning
 * ========================================= */

html.theme-transitioning,
html.theme-transitioning body,
html.theme-transitioning #root,
html.theme-transitioning * {
  transition:
    background-color 520ms linear,
    color 520ms linear,
    border-color 520ms linear,
    box-shadow 520ms linear,
    fill 520ms linear,
    stroke 520ms linear,
    opacity 520ms linear;
}

@media (prefers-reduced-motion: reduce) {
  html.theme-transitioning,
  html.theme-transitioning body,
  html.theme-transitioning #root,
  html.theme-transitioning * {
    transition: none !important;
  }
}

/* 等宽字体栈：
 * - 优先 Maple Mono（若用户已安装则生效）
 * - Windows 默认兜底 Consolas
 * - 其它平台兜底系统等宽
 * 参考字体项目：`https://github.com/subframe7536/maple-font`
 */
:root {
  --font-mono: "Maple Mono", "Maple Mono NF", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

#root {
  height: 100%;
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-secondary);
}

/* Custom animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { 
    opacity: 0;
    transform: translateY(10px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

/* 旧的 prd-theme-fade 遮罩过渡已弃用（改为线性过渡），保留为空避免老版本残留 class 报错 */

.animate-fade-in {
  animation: fadeIn 0.3s ease-out;
}

.animate-slide-up {
  animation: slideUp 0.3s ease-out;
}
