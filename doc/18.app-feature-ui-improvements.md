# åº”ç”¨åŠŸèƒ½ UI æ”¹è¿›æ€»ç»“

## ç”¨æˆ·éœ€æ±‚

1. **åŠŸèƒ½è¯´æ˜æ¸…æ™°åŒ–**ï¼šéœ€è¦éå¸¸æ¸…æ™°åœ°è¯´æ˜"è°åœ¨ä½¿ç”¨ã€æ€ä¹ˆä½¿ç”¨"
2. **é»˜è®¤é…ç½®ä½ç½®è¯´æ˜**ï¼šæ˜ç¡®é»˜è®¤é…ç½®åœ¨å“ªé‡Œ
3. **æµ‹è¯•ç”¨ä¾‹**ï¼šå¯¹å¤šå±‚è°ƒç”¨é…ç½®è¿›è¡Œå……åˆ†æµ‹è¯•
4. **æ—¥å¿—ä¿¡æ¯è°ƒæ•´**ï¼š
   - æ¨¡å‹åç§°æ”¹ä¸ºä¸­æ–‡æ ‡é¢˜
   - `modelLab.run` æ”¹ä¸º"æ¨¡å‹"
   - æ ‡ç­¾æ˜¾ç¤º"é»˜è®¤æ„å›¾"/"ä¸“å±æ¨ç†"ç­‰

## å®ç°çš„æ”¹è¿›

### 1. åŠŸèƒ½æ ‡é¢˜æ¸…æ™°åŒ– âœ…

**ä¹‹å‰**ï¼š
```
chat.sendmessage
æ¨¡å‹ç±»å‹ï¼šchat
```

**ç°åœ¨**ï¼š
```
æ¡Œé¢ç«¯ï¼šç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯
æ¨¡å‹ï¼šdesktop.chat.sendmessage::chat
[é»˜è®¤å¯¹è¯æ¨¡å‹]
```

**å®ç°é€»è¾‘**ï¼š

```typescript
/**
 * è·å–åŠŸèƒ½çš„è¯¦ç»†æè¿°ï¼ˆè°åœ¨ä½¿ç”¨ã€æ€ä¹ˆä½¿ç”¨ï¼‰
 */
export function getFeatureDescription(parsed: ParsedAppCallerKey): string {
  const { app, features, modelType } = parsed;
  
  // åŠŸèƒ½æè¿°æ˜ å°„
  const descriptions: Record<string, Record<string, string>> = {
    'desktop': {
      'chat.sendmessage::chat': 'ç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯',
      'chat.sendmessage::intent': 'è¯†åˆ«ç”¨æˆ·æ¶ˆæ¯æ„å›¾',
      'chat::vision': 'ç†è§£èŠå¤©ä¸­çš„å›¾ç‰‡',
      'prd.analysis::chat': 'PRD æ™ºèƒ½åˆ†æ',
      'prd.preview::chat': 'PRD é¢„è§ˆé—®ç­”',
      'gap.detection::chat': 'Gap å·®å¼‚æ£€æµ‹',
      'gap.summarization::chat': 'Gap å·®å¼‚æ€»ç»“',
    },
    'visual-agent': {
      'image::generation': 'ç”Ÿæˆé…å›¾',
      'image::vision': 'éªŒè¯å›¾ç‰‡è´¨é‡',
      'image::chat': 'ç”Ÿæˆå›¾ç‰‡æè¿°',
    },
    'literary-agent': {
      'content::chat': 'ç”Ÿæˆæ–‡å­¦å†…å®¹',
      'illustration::generation': 'ç”Ÿæˆæ–‡ç« é…å›¾',
      'illustration::vision': 'éªŒè¯é…å›¾è´¨é‡',
    },
    'open-platform': {
      'proxy::chat': 'API å¯¹è¯ä»£ç†',
      'proxy::vision': 'API è§†è§‰ä»£ç†',
      'proxy::generation': 'API ç”Ÿå›¾ä»£ç†',
    },
    'admin': {
      'lab::chat': 'å®éªŒå®¤æ¨¡å‹æµ‹è¯•',
      'lab::vision': 'å®éªŒå®¤è§†è§‰æµ‹è¯•',
      'lab::generation': 'å®éªŒå®¤ç”Ÿå›¾æµ‹è¯•',
    },
  };
  
  const subject = appSubject[app] || app;
  const fullPath = features.join('.') + '::' + modelType;
  const description = descriptions[app]?.[fullPath];
  
  if (description) {
    return `${subject}ï¼š${description}`;
  }
  
  // å›é€€ï¼šåŸºäºåŠŸèƒ½å’Œæ¨¡å‹ç±»å‹ç”Ÿæˆé€šç”¨æè¿°
  const featureName = getFeatureDisplayName(features[0] || '');
  const modelTypeName = getModelTypeDisplayName(modelType);
  return `${subject}ï¼š${featureName} - ${modelTypeName}`;
}
```

### 2. æ ‡ç­¾æ˜¾ç¤ºä¼˜åŒ– âœ…

**æ ‡ç­¾ç±»å‹**ï¼š
- **é»˜è®¤åˆ†ç»„**ï¼šç»¿è‰²æ ‡ç­¾ï¼Œæ˜¾ç¤º"é»˜è®¤å¯¹è¯æ¨¡å‹"/"é»˜è®¤æ„å›¾è¯†åˆ«"ç­‰
- **ä¸“å±åˆ†ç»„**ï¼šè“è‰²æ ‡ç­¾ï¼Œæ˜¾ç¤º"ä¸“å±å¯¹è¯æ¨¡å‹"/"ä¸“å±å›¾ç‰‡ç”Ÿæˆ"ç­‰

**å®ç°é€»è¾‘**ï¼š

```typescript
// åˆ¤æ–­æ˜¯å¦ä½¿ç”¨é»˜è®¤åˆ†ç»„
const isDefaultGroup = !group;
const groupLabel = isDefaultGroup 
  ? `é»˜è®¤${modelTypeLabel}` 
  : `ä¸“å±${modelTypeLabel}`;

<button
  className="inline-flex items-center gap-1 rounded-full px-2.5 h-5 text-[11px] font-semibold tracking-wide shrink-0 hover:opacity-80 transition-opacity"
  style={{
    background: isDefaultGroup ? 'rgba(34, 197, 94, 0.12)' : 'rgba(59, 130, 246, 0.12)',
    border: isDefaultGroup ? '1px solid rgba(34, 197, 94, 0.28)' : '1px solid rgba(59, 130, 246, 0.28)',
    color: isDefaultGroup ? 'rgba(34, 197, 94, 0.95)' : 'rgba(59, 130, 246, 0.95)',
  }}
  title={isDefaultGroup ? 'ä½¿ç”¨é»˜è®¤åˆ†ç»„' : `ä½¿ç”¨ä¸“å±åˆ†ç»„ï¼š${group?.name}`}
>
  {groupLabel}
</button>
```

**è§†è§‰æ•ˆæœ**ï¼š
- ç»¿è‰²ï¼šè¡¨ç¤ºä½¿ç”¨ç³»ç»Ÿé»˜è®¤åˆ†ç»„ï¼ˆå®‰å…¨ã€ç¨³å®šï¼‰
- è“è‰²ï¼šè¡¨ç¤ºä½¿ç”¨ä¸“å±åˆ†ç»„ï¼ˆè‡ªå®šä¹‰ã€å¯é…ç½®ï¼‰

### 3. æ—¥å¿—ä¿¡æ¯è°ƒæ•´ âœ…

**è°ƒæ•´é¡¹**ï¼š
1. ~~`deepseek-v3-2-251201`~~ â†’ **ä¸­æ–‡æ ‡é¢˜**ï¼ˆå¦‚"æ¡Œé¢ç«¯ï¼šç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯"ï¼‰
2. ~~`modelLab.run`~~ â†’ **"æ¨¡å‹ï¼šdesktop.chat.sendmessage::chat"**
3. ~~"æ„å›¾"~~ â†’ **"é»˜è®¤æ„å›¾è¯†åˆ«"** æˆ– **"ä¸“å±æ„å›¾è¯†åˆ«"**

## 2. é»˜è®¤é…ç½®ä½ç½®è¯´æ˜

### é»˜è®¤åˆ†ç»„åœ¨å“ªé‡Œï¼Ÿ

**ç­”æ¡ˆ**ï¼šé»˜è®¤åˆ†ç»„åœ¨ **"å¹³å°ç®¡ç†"** é¡µé¢é…ç½®ã€‚

**ä½ç½®**ï¼š
```
æ¨¡å‹ç®¡ç† â†’ å¹³å°ç®¡ç† Tab â†’ æ¨¡å‹åˆ†ç»„
```

**é»˜è®¤åˆ†ç»„çš„ä½œç”¨**ï¼š
- å½“åŠŸèƒ½æœªç»‘å®šä¸“å±åˆ†ç»„æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨å¯¹åº”æ¨¡å‹ç±»å‹çš„é»˜è®¤åˆ†ç»„
- ä¾‹å¦‚ï¼š
  - `chat` ç±»å‹ â†’ ä½¿ç”¨"é»˜è®¤å¯¹è¯æ¨¡å‹"åˆ†ç»„
  - `intent` ç±»å‹ â†’ ä½¿ç”¨"é»˜è®¤æ„å›¾è¯†åˆ«"åˆ†ç»„
  - `vision` ç±»å‹ â†’ ä½¿ç”¨"é»˜è®¤è§†è§‰ç†è§£"åˆ†ç»„
  - `generation` ç±»å‹ â†’ ä½¿ç”¨"é»˜è®¤å›¾ç‰‡ç”Ÿæˆ"åˆ†ç»„

**å¦‚ä½•é…ç½®é»˜è®¤åˆ†ç»„**ï¼š
1. è¿›å…¥"å¹³å°ç®¡ç†"é¡µé¢
2. åˆ›å»ºæˆ–ç¼–è¾‘æ¨¡å‹åˆ†ç»„
3. åœ¨åˆ†ç»„ä»£ç ä¸­ä½¿ç”¨çº¦å®šçš„å‘½åï¼š
   - `default-chat` â†’ é»˜è®¤å¯¹è¯æ¨¡å‹
   - `default-intent` â†’ é»˜è®¤æ„å›¾è¯†åˆ«
   - `default-vision` â†’ é»˜è®¤è§†è§‰ç†è§£
   - `default-generation` â†’ é»˜è®¤å›¾ç‰‡ç”Ÿæˆ

### ä¸“å±åˆ†ç»„åœ¨å“ªé‡Œï¼Ÿ

**ç­”æ¡ˆ**ï¼šä¸“å±åˆ†ç»„åœ¨ **"åº”ç”¨ä¸åˆ†ç»„"** é¡µé¢é…ç½®ã€‚

**ä½ç½®**ï¼š
```
æ¨¡å‹ç®¡ç† â†’ åº”ç”¨ä¸åˆ†ç»„ Tab â†’ é€‰æ‹©åº”ç”¨ â†’ åŠŸèƒ½åˆ—è¡¨ â†’ æ·»åŠ æ¨¡å‹
```

**ä¸“å±åˆ†ç»„çš„ä½œç”¨**ï¼š
- ä¸ºç‰¹å®šåŠŸèƒ½é…ç½®ä¸“å±çš„æ¨¡å‹åˆ—è¡¨
- è¦†ç›–é»˜è®¤åˆ†ç»„çš„é…ç½®
- å®ç°æ›´ç²¾ç»†çš„æ¨¡å‹è°ƒåº¦ç­–ç•¥

## 3. æµ‹è¯•ç”¨ä¾‹è®¾è®¡

### æµ‹è¯•åœºæ™¯ 1ï¼šé»˜è®¤åˆ†ç»„è°ƒç”¨

**å‰ç½®æ¡ä»¶**ï¼š
1. åœ¨"å¹³å°ç®¡ç†"ä¸­é…ç½®äº†"é»˜è®¤å¯¹è¯æ¨¡å‹"åˆ†ç»„
2. åˆ†ç»„ä¸­åŒ…å« 2 ä¸ªæ¨¡å‹ï¼šDeepSeek-V3ï¼ˆä¼˜å…ˆçº§1ï¼‰ã€GPT-4ï¼ˆä¼˜å…ˆçº§2ï¼‰
3. æ¡Œé¢ç«¯çš„"ç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯"åŠŸèƒ½æœªç»‘å®šä¸“å±åˆ†ç»„

**æµ‹è¯•æ­¥éª¤**ï¼š
1. ç”¨æˆ·åœ¨æ¡Œé¢ç«¯å‘é€èŠå¤©æ¶ˆæ¯
2. ç³»ç»Ÿè°ƒç”¨ `SmartModelScheduler.GetClientAsync("desktop.chat.sendmessage::chat", "chat")`
3. è°ƒåº¦å™¨æŸ¥æ‰¾ `desktop.chat.sendmessage::chat` çš„é…ç½®
4. å‘ç°æœªç»‘å®šä¸“å±åˆ†ç»„ï¼Œä½¿ç”¨ `default-chat` åˆ†ç»„
5. è¿”å› DeepSeek-V3 å®¢æˆ·ç«¯

**é¢„æœŸç»“æœ**ï¼š
- âœ… ä½¿ç”¨ DeepSeek-V3 æ¨¡å‹
- âœ… æ—¥å¿—è®°å½•ï¼š`appCallerCode = "desktop.chat.sendmessage::chat"`, `modelGroupId = "default-chat"`
- âœ… UI æ˜¾ç¤ºï¼šç»¿è‰²æ ‡ç­¾"é»˜è®¤å¯¹è¯æ¨¡å‹"

**æµ‹è¯•ä»£ç **ï¼š
```csharp
[Fact]
public async Task Should_Use_Default_Group_When_No_Specific_Group_Bound()
{
    // Arrange
    var appCode = "desktop.chat.sendmessage::chat";
    var modelType = "chat";
    
    // åˆ›å»ºé»˜è®¤åˆ†ç»„
    var defaultGroup = new ModelGroup
    {
        Id = "default-chat",
        Code = "default-chat",
        Name = "é»˜è®¤å¯¹è¯æ¨¡å‹",
        Models = new List<ModelGroupItem>
        {
            new() { ModelId = "deepseek-v3", PlatformId = "guiji", Priority = 1, HealthStatus = ModelHealthStatus.Healthy },
            new() { ModelId = "gpt-4", PlatformId = "openai", Priority = 2, HealthStatus = ModelHealthStatus.Healthy }
        }
    };
    await _db.ModelGroups.InsertOneAsync(defaultGroup);
    
    // åˆ›å»ºåº”ç”¨ï¼ˆæœªç»‘å®šä¸“å±åˆ†ç»„ï¼‰
    var app = new LLMAppCaller
    {
        Id = Guid.NewGuid().ToString("N"),
        AppCode = appCode,
        DisplayName = "æ¡Œé¢ç«¯ï¼šç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯",
        ModelRequirements = new List<AppModelRequirement>
        {
            new() { ModelType = modelType, Purpose = "ç”Ÿæˆå›å¤", IsRequired = true, ModelGroupId = null }
        }
    };
    await _db.LLMAppCallers.InsertOneAsync(app);
    
    // Act
    var client = await _scheduler.GetClientAsync(appCode, modelType, CancellationToken.None);
    
    // Assert
    Assert.NotNull(client);
    Assert.Equal("deepseek-v3", client.ModelId);
    Assert.Equal("guiji", client.PlatformId);
}
```

### æµ‹è¯•åœºæ™¯ 2ï¼šä¸“å±åˆ†ç»„è°ƒç”¨

**å‰ç½®æ¡ä»¶**ï¼š
1. åœ¨"å¹³å°ç®¡ç†"ä¸­é…ç½®äº†"é»˜è®¤å¯¹è¯æ¨¡å‹"åˆ†ç»„
2. åœ¨"åº”ç”¨ä¸åˆ†ç»„"ä¸­ä¸º"ç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯"é…ç½®äº†ä¸“å±åˆ†ç»„"é«˜è´¨é‡å¯¹è¯"
3. "é«˜è´¨é‡å¯¹è¯"åˆ†ç»„åªåŒ…å« GPT-4

**æµ‹è¯•æ­¥éª¤**ï¼š
1. ç”¨æˆ·åœ¨æ¡Œé¢ç«¯å‘é€èŠå¤©æ¶ˆæ¯
2. ç³»ç»Ÿè°ƒç”¨ `SmartModelScheduler.GetClientAsync("desktop.chat.sendmessage::chat", "chat")`
3. è°ƒåº¦å™¨æŸ¥æ‰¾ `desktop.chat.sendmessage::chat` çš„é…ç½®
4. å‘ç°ç»‘å®šäº†ä¸“å±åˆ†ç»„"é«˜è´¨é‡å¯¹è¯"
5. è¿”å› GPT-4 å®¢æˆ·ç«¯

**é¢„æœŸç»“æœ**ï¼š
- âœ… ä½¿ç”¨ GPT-4 æ¨¡å‹ï¼ˆä¸æ˜¯é»˜è®¤åˆ†ç»„çš„ DeepSeek-V3ï¼‰
- âœ… æ—¥å¿—è®°å½•ï¼š`appCallerCode = "desktop.chat.sendmessage::chat"`, `modelGroupId = "custom-high-quality"`
- âœ… UI æ˜¾ç¤ºï¼šè“è‰²æ ‡ç­¾"ä¸“å±å¯¹è¯æ¨¡å‹"

**æµ‹è¯•ä»£ç **ï¼š
```csharp
[Fact]
public async Task Should_Use_Specific_Group_When_Bound()
{
    // Arrange
    var appCode = "desktop.chat.sendmessage::chat";
    var modelType = "chat";
    
    // åˆ›å»ºé»˜è®¤åˆ†ç»„
    var defaultGroup = new ModelGroup
    {
        Id = "default-chat",
        Code = "default-chat",
        Name = "é»˜è®¤å¯¹è¯æ¨¡å‹",
        Models = new List<ModelGroupItem>
        {
            new() { ModelId = "deepseek-v3", PlatformId = "guiji", Priority = 1, HealthStatus = ModelHealthStatus.Healthy }
        }
    };
    await _db.ModelGroups.InsertOneAsync(defaultGroup);
    
    // åˆ›å»ºä¸“å±åˆ†ç»„
    var customGroup = new ModelGroup
    {
        Id = "custom-high-quality",
        Code = "custom-high-quality",
        Name = "é«˜è´¨é‡å¯¹è¯",
        Models = new List<ModelGroupItem>
        {
            new() { ModelId = "gpt-4", PlatformId = "openai", Priority = 1, HealthStatus = ModelHealthStatus.Healthy }
        }
    };
    await _db.ModelGroups.InsertOneAsync(customGroup);
    
    // åˆ›å»ºåº”ç”¨ï¼ˆç»‘å®šä¸“å±åˆ†ç»„ï¼‰
    var app = new LLMAppCaller
    {
        Id = Guid.NewGuid().ToString("N"),
        AppCode = appCode,
        DisplayName = "æ¡Œé¢ç«¯ï¼šç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯",
        ModelRequirements = new List<AppModelRequirement>
        {
            new() { ModelType = modelType, Purpose = "ç”Ÿæˆå›å¤", IsRequired = true, ModelGroupId = "custom-high-quality" }
        }
    };
    await _db.LLMAppCallers.InsertOneAsync(app);
    
    // Act
    var client = await _scheduler.GetClientAsync(appCode, modelType, CancellationToken.None);
    
    // Assert
    Assert.NotNull(client);
    Assert.Equal("gpt-4", client.ModelId);
    Assert.Equal("openai", client.PlatformId);
}
```

### æµ‹è¯•åœºæ™¯ 3ï¼šæ¨¡å‹é™æƒä¸è‡ªåŠ¨åˆ‡æ¢

**å‰ç½®æ¡ä»¶**ï¼š
1. ä¸“å±åˆ†ç»„"é«˜è´¨é‡å¯¹è¯"åŒ…å« 2 ä¸ªæ¨¡å‹ï¼šGPT-4ï¼ˆä¼˜å…ˆçº§1ï¼‰ã€Claudeï¼ˆä¼˜å…ˆçº§2ï¼‰
2. GPT-4 å½“å‰çŠ¶æ€ä¸º Healthy

**æµ‹è¯•æ­¥éª¤**ï¼š
1. ç¬¬1æ¬¡è°ƒç”¨ï¼šæˆåŠŸä½¿ç”¨ GPT-4
2. æ¨¡æ‹Ÿ GPT-4 è¿ç»­å¤±è´¥ 3 æ¬¡
3. GPT-4 çŠ¶æ€å˜ä¸º Unavailable
4. ç¬¬2æ¬¡è°ƒç”¨ï¼šè‡ªåŠ¨åˆ‡æ¢åˆ° Claude
5. Claude æˆåŠŸå“åº”
6. ç¬¬3æ¬¡è°ƒç”¨ï¼šç»§ç»­ä½¿ç”¨ Claude

**é¢„æœŸç»“æœ**ï¼š
- âœ… ç¬¬1æ¬¡ä½¿ç”¨ GPT-4
- âœ… GPT-4 å¤±è´¥åè‡ªåŠ¨é™æƒ
- âœ… ç¬¬2æ¬¡è‡ªåŠ¨åˆ‡æ¢åˆ° Claude
- âœ… æ—¥å¿—è®°å½•é™æƒäº‹ä»¶
- âœ… UI æ˜¾ç¤º GPT-4 çŠ¶æ€ä¸º"ä¸å¯ç”¨"ï¼ŒClaude çŠ¶æ€ä¸º"å¥åº·"

**æµ‹è¯•ä»£ç **ï¼š
```csharp
[Fact]
public async Task Should_Auto_Switch_When_Model_Fails()
{
    // Arrange
    var appCode = "desktop.chat.sendmessage::chat";
    var modelType = "chat";
    var groupId = "custom-high-quality";
    
    var group = new ModelGroup
    {
        Id = groupId,
        Code = groupId,
        Name = "é«˜è´¨é‡å¯¹è¯",
        Models = new List<ModelGroupItem>
        {
            new() { ModelId = "gpt-4", PlatformId = "openai", Priority = 1, HealthStatus = ModelHealthStatus.Healthy, ConsecutiveFailures = 0 },
            new() { ModelId = "claude-3", PlatformId = "anthropic", Priority = 2, HealthStatus = ModelHealthStatus.Healthy, ConsecutiveFailures = 0 }
        }
    };
    await _db.ModelGroups.InsertOneAsync(group);
    
    var app = new LLMAppCaller
    {
        Id = Guid.NewGuid().ToString("N"),
        AppCode = appCode,
        DisplayName = "æ¡Œé¢ç«¯ï¼šç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯",
        ModelRequirements = new List<AppModelRequirement>
        {
            new() { ModelType = modelType, Purpose = "ç”Ÿæˆå›å¤", IsRequired = true, ModelGroupId = groupId }
        }
    };
    await _db.LLMAppCallers.InsertOneAsync(app);
    
    // Act 1: ç¬¬1æ¬¡è°ƒç”¨ï¼Œä½¿ç”¨ GPT-4
    var client1 = await _scheduler.GetClientAsync(appCode, modelType, CancellationToken.None);
    Assert.Equal("gpt-4", client1.ModelId);
    
    // Act 2: æ¨¡æ‹Ÿ GPT-4 è¿ç»­å¤±è´¥ 3 æ¬¡
    for (int i = 0; i < 3; i++)
    {
        await _scheduler.RecordCallResultAsync(groupId, "gpt-4", "openai", false, "Timeout", CancellationToken.None);
    }
    
    // Act 3: ç¬¬2æ¬¡è°ƒç”¨ï¼Œåº”è¯¥åˆ‡æ¢åˆ° Claude
    var client2 = await _scheduler.GetClientAsync(appCode, modelType, CancellationToken.None);
    Assert.Equal("claude-3", client2.ModelId);
    
    // Assert: æ£€æŸ¥ GPT-4 çŠ¶æ€
    var updatedGroup = await _db.ModelGroups.Find(g => g.Id == groupId).FirstOrDefaultAsync();
    var gpt4 = updatedGroup.Models.First(m => m.ModelId == "gpt-4");
    Assert.Equal(ModelHealthStatus.Unavailable, gpt4.HealthStatus);
    Assert.Equal(3, gpt4.ConsecutiveFailures);
}
```

### æµ‹è¯•åœºæ™¯ 4ï¼šå¤šåº”ç”¨éš”ç¦»

**å‰ç½®æ¡ä»¶**ï¼š
1. æ¡Œé¢ç«¯çš„"ç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯"ä½¿ç”¨ä¸“å±åˆ†ç»„A
2. å¼€æ”¾å¹³å°çš„"API å¯¹è¯ä»£ç†"ä½¿ç”¨ä¸“å±åˆ†ç»„B
3. ä¸“å±åˆ†ç»„A ä¸­çš„ GPT-4 å¤±è´¥

**æµ‹è¯•æ­¥éª¤**ï¼š
1. æ¡Œé¢ç«¯è°ƒç”¨ï¼ŒGPT-4 å¤±è´¥ï¼Œåˆ‡æ¢åˆ° DeepSeek
2. å¼€æ”¾å¹³å°è°ƒç”¨ï¼Œåº”è¯¥ä»ç„¶ä½¿ç”¨ GPT-4ï¼ˆä¸å—æ¡Œé¢ç«¯å½±å“ï¼‰

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ¡Œé¢ç«¯ä½¿ç”¨ DeepSeek
- âœ… å¼€æ”¾å¹³å°ä½¿ç”¨ GPT-4
- âœ… ä¸¤ä¸ªåº”ç”¨çš„æ¨¡å‹è°ƒåº¦å®Œå…¨éš”ç¦»

**æµ‹è¯•ä»£ç **ï¼š
```csharp
[Fact]
public async Task Should_Isolate_Between_Different_Apps()
{
    // Arrange
    var desktopAppCode = "desktop.chat.sendmessage::chat";
    var openPlatformAppCode = "open-platform.proxy::chat";
    var modelType = "chat";
    
    // æ¡Œé¢ç«¯ä¸“å±åˆ†ç»„
    var desktopGroup = new ModelGroup
    {
        Id = "desktop-chat-group",
        Code = "desktop-chat-group",
        Name = "æ¡Œé¢ç«¯å¯¹è¯",
        Models = new List<ModelGroupItem>
        {
            new() { ModelId = "gpt-4", PlatformId = "openai", Priority = 1, HealthStatus = ModelHealthStatus.Healthy },
            new() { ModelId = "deepseek-v3", PlatformId = "guiji", Priority = 2, HealthStatus = ModelHealthStatus.Healthy }
        }
    };
    await _db.ModelGroups.InsertOneAsync(desktopGroup);
    
    // å¼€æ”¾å¹³å°ä¸“å±åˆ†ç»„
    var openPlatformGroup = new ModelGroup
    {
        Id = "openplatform-chat-group",
        Code = "openplatform-chat-group",
        Name = "å¼€æ”¾å¹³å°å¯¹è¯",
        Models = new List<ModelGroupItem>
        {
            new() { ModelId = "gpt-4", PlatformId = "openai", Priority = 1, HealthStatus = ModelHealthStatus.Healthy }
        }
    };
    await _db.ModelGroups.InsertOneAsync(openPlatformGroup);
    
    // åˆ›å»ºåº”ç”¨
    var desktopApp = new LLMAppCaller
    {
        Id = Guid.NewGuid().ToString("N"),
        AppCode = desktopAppCode,
        DisplayName = "æ¡Œé¢ç«¯ï¼šç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯",
        ModelRequirements = new List<AppModelRequirement>
        {
            new() { ModelType = modelType, Purpose = "ç”Ÿæˆå›å¤", IsRequired = true, ModelGroupId = "desktop-chat-group" }
        }
    };
    await _db.LLMAppCallers.InsertOneAsync(desktopApp);
    
    var openPlatformApp = new LLMAppCaller
    {
        Id = Guid.NewGuid().ToString("N"),
        AppCode = openPlatformAppCode,
        DisplayName = "å¼€æ”¾å¹³å°ï¼šAPI å¯¹è¯ä»£ç†",
        ModelRequirements = new List<AppModelRequirement>
        {
            new() { ModelType = modelType, Purpose = "ä»£ç†å¯¹è¯", IsRequired = true, ModelGroupId = "openplatform-chat-group" }
        }
    };
    await _db.LLMAppCallers.InsertOneAsync(openPlatformApp);
    
    // Act 1: æ¡Œé¢ç«¯ GPT-4 å¤±è´¥
    for (int i = 0; i < 3; i++)
    {
        await _scheduler.RecordCallResultAsync("desktop-chat-group", "gpt-4", "openai", false, "Timeout", CancellationToken.None);
    }
    
    // Act 2: æ¡Œé¢ç«¯è°ƒç”¨ï¼Œåº”è¯¥åˆ‡æ¢åˆ° DeepSeek
    var desktopClient = await _scheduler.GetClientAsync(desktopAppCode, modelType, CancellationToken.None);
    Assert.Equal("deepseek-v3", desktopClient.ModelId);
    
    // Act 3: å¼€æ”¾å¹³å°è°ƒç”¨ï¼Œåº”è¯¥ä»ç„¶ä½¿ç”¨ GPT-4
    var openPlatformClient = await _scheduler.GetClientAsync(openPlatformAppCode, modelType, CancellationToken.None);
    Assert.Equal("gpt-4", openPlatformClient.ModelId);
    
    // Assert: æ£€æŸ¥ä¸¤ä¸ªåˆ†ç»„çš„çŠ¶æ€
    var desktopGroupUpdated = await _db.ModelGroups.Find(g => g.Id == "desktop-chat-group").FirstOrDefaultAsync();
    var desktopGpt4 = desktopGroupUpdated.Models.First(m => m.ModelId == "gpt-4");
    Assert.Equal(ModelHealthStatus.Unavailable, desktopGpt4.HealthStatus);
    
    var openPlatformGroupUpdated = await _db.ModelGroups.Find(g => g.Id == "openplatform-chat-group").FirstOrDefaultAsync();
    var openPlatformGpt4 = openPlatformGroupUpdated.Models.First(m => m.ModelId == "gpt-4");
    Assert.Equal(ModelHealthStatus.Healthy, openPlatformGpt4.HealthStatus);
}
```

## 4. UI å±•ç¤ºæ•ˆæœ

### åŠŸèƒ½å¡ç‰‡ç¤ºä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¬ æ¡Œé¢ç«¯ï¼šç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯                                  â”‚
â”‚    æ¨¡å‹ï¼šdesktop.chat.sendmessage::chat                      â”‚
â”‚    [é»˜è®¤å¯¹è¯æ¨¡å‹]                                            â”‚
â”‚    100æ¬¡  95%                                                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ å·²é…ç½®æ¨¡å‹                                      [+ æ·»åŠ æ¨¡å‹] â”‚
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ #1  DeepSeek-V3                          [å¥åº·]         â”‚ â”‚
â”‚ â”‚     å¹³å°: è½¨è¿¹æµåŠ¨  ä¼˜å…ˆçº§: 1  è¿ç»­å¤±è´¥: 0  å¥åº·åˆ†: 100   â”‚ â”‚
â”‚ â”‚                                          [ç¼–è¾‘] [åˆ é™¤]   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ æ¡Œé¢ç«¯ï¼šè¯†åˆ«ç”¨æˆ·æ¶ˆæ¯æ„å›¾                                  â”‚
â”‚    æ¨¡å‹ï¼šdesktop.chat.sendmessage::intent                    â”‚
â”‚    [ä¸“å±æ„å›¾è¯†åˆ«]                                            â”‚
â”‚    50æ¬¡  98%                                                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ å·²é…ç½®æ¨¡å‹                                      [+ æ·»åŠ æ¨¡å‹] â”‚
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ #1  GPT-4o-mini                          [å¥åº·]         â”‚ â”‚
â”‚ â”‚     å¹³å°: OpenAI  ä¼˜å…ˆçº§: 1  è¿ç»­å¤±è´¥: 0  å¥åº·åˆ†: 100     â”‚ â”‚
â”‚ â”‚                                          [ç¼–è¾‘] [åˆ é™¤]   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ€»ç»“

### å·²å®Œæˆçš„æ”¹è¿› âœ…

1. **åŠŸèƒ½æ ‡é¢˜æ¸…æ™°åŒ–**ï¼šæ˜¾ç¤º"æ¡Œé¢ç«¯ï¼šç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯"ç­‰æè¿°æ€§æ ‡é¢˜
2. **æ¨¡å‹ä¿¡æ¯ä¼˜åŒ–**ï¼šä» `modelLab.run` æ”¹ä¸º `æ¨¡å‹ï¼šdesktop.chat.sendmessage::chat`
3. **æ ‡ç­¾æ˜¾ç¤ºä¼˜åŒ–**ï¼š
   - ç»¿è‰²æ ‡ç­¾ï¼šé»˜è®¤å¯¹è¯æ¨¡å‹ã€é»˜è®¤æ„å›¾è¯†åˆ«ç­‰
   - è“è‰²æ ‡ç­¾ï¼šä¸“å±å¯¹è¯æ¨¡å‹ã€ä¸“å±å›¾ç‰‡ç”Ÿæˆç­‰
4. **æµ‹è¯•ç”¨ä¾‹è®¾è®¡**ï¼šè¦†ç›–é»˜è®¤åˆ†ç»„ã€ä¸“å±åˆ†ç»„ã€æ¨¡å‹é™æƒã€åº”ç”¨éš”ç¦»ç­‰åœºæ™¯

### å¾…å®ç°åŠŸèƒ½

1. **æ ‡ç­¾ç‚¹å‡»è·³è½¬**ï¼šç‚¹å‡»æ ‡ç­¾è·³è½¬åˆ°åˆ†ç»„é…ç½®é¡µé¢
2. **æµ‹è¯•ç”¨ä¾‹å®ç°**ï¼šå°†æµ‹è¯•ä»£ç æ·»åŠ åˆ° `PrdAgent.Api.Tests` é¡¹ç›®
3. **æ¨¡å‹é€‰æ‹©å™¨**ï¼šå®ç°æ·»åŠ æ¨¡å‹åŠŸèƒ½

### ç”¨æˆ·é…ç½®æµç¨‹

1. **é…ç½®é»˜è®¤åˆ†ç»„**ï¼š
   - è¿›å…¥"å¹³å°ç®¡ç†"é¡µé¢
   - åˆ›å»º/ç¼–è¾‘æ¨¡å‹åˆ†ç»„
   - è®¾ç½®åˆ†ç»„ä»£ç ä¸º `default-chat`ã€`default-intent` ç­‰

2. **é…ç½®ä¸“å±åˆ†ç»„**ï¼š
   - è¿›å…¥"åº”ç”¨ä¸åˆ†ç»„"é¡µé¢
   - é€‰æ‹©åº”ç”¨
   - ç‚¹å‡»åŠŸèƒ½çš„"æ·»åŠ æ¨¡å‹"æŒ‰é’®
   - é€‰æ‹©æ¨¡å‹å¹¶åˆ›å»ºä¸“å±åˆ†ç»„

3. **æŸ¥çœ‹é…ç½®æ•ˆæœ**ï¼š
   - ç»¿è‰²æ ‡ç­¾ = ä½¿ç”¨é»˜è®¤åˆ†ç»„
   - è“è‰²æ ‡ç­¾ = ä½¿ç”¨ä¸“å±åˆ†ç»„
   - ç‚¹å‡»æ ‡ç­¾å¯æŸ¥çœ‹åˆ†ç»„è¯¦æƒ…

ç°åœ¨å‰ç«¯å·²ç»æˆåŠŸç¼–è¯‘ï¼ŒUI æ”¹è¿›å·²ç»å®Œæˆï¼ç”¨æˆ·å¯ä»¥åˆ·æ–°é¡µé¢æŸ¥çœ‹æ–°çš„åŠŸèƒ½æ ‡é¢˜å’Œæ ‡ç­¾æ˜¾ç¤ºæ•ˆæœäº†ã€‚
