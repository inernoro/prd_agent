# å‘¨æŠ¥ Agent â€” å®æ–½è¿›åº¦è¿½è¸ª

> **æœ€åæ›´æ–°**ï¼š2026-02-27 | **å½“å‰é˜¶æ®µ**ï¼šPhase 3 âœ… â†’ Phase 4 å¾…å¯åŠ¨
>
> **ç”¨é€”**ï¼šè·¨ session çš„å®æ–½è¿›åº¦å•ä¸€ä¿¡æ¯æºã€‚æ–° session è¯»æ­¤æ–‡æ¡£å³å¯æ¢å¤ä¸Šä¸‹æ–‡ï¼Œæ— éœ€å…¨ç›˜æ‰«æã€‚
>
> **ç»´æŠ¤è§„åˆ™**ï¼š
> 1. æ¯ä¸ª Phase å®Œæˆå â†’ æ›´æ–°æ€»è§ˆè¡¨ + å¡«å†™äº¤ä»˜ç‰© + è®°å½•æ¶æ„å†³ç­–
> 2. æ¯ä¸ª session å¼€å§‹æ—¶ â†’ è¯»æ­¤æ–‡æ¡£æ¢å¤ä¸Šä¸‹æ–‡
> 3. å…³è”æ›´æ–° â†’ åŒæ­¥æ›´æ–° `CLAUDE.md` åŠŸèƒ½æ³¨å†Œè¡¨çŠ¶æ€

---

## æ€»è§ˆ

| Phase | åç§° | çŠ¶æ€ | å…³é”® Commit | å®Œæˆæ—¥æœŸ |
|-------|------|------|-------------|----------|
| PRD | äº§å“éœ€æ±‚æ–‡æ¡£ v1.0 | âœ… DONE | `ff1943f` | 2026-02-24 |
| 1 | åŸºç¡€é—­ç¯ | âœ… DONE | `46c6d15` | 2026-02-24 |
| 2 | è‡ªåŠ¨é‡‡é›† | âœ… DONE | `ffce7fd` | 2026-02-26 |
| 3 | ç®¡ç†å¢å¼º | âœ… DONE | `005de06` | 2026-02-27 |
| 4 | ä½“éªŒä¼˜åŒ– | ğŸ”µ PLANNED | â€” | â€” |

---

## Phase 1ï¼šåŸºç¡€é—­ç¯ â€” âœ… DONE

> Commit: `46c6d15` (2026-02-24) â€” 23 files, +3561 lines
> æ–‡æ¡£åŒæ­¥: `60b6319` (2026-02-26)

### äº¤ä»˜ç‰©

**åç«¯ (C#)**ï¼š
- `ReportAgentController.cs` â€” 929 è¡Œï¼Œå›¢é˜Ÿ/æ¨¡æ¿/å‘¨æŠ¥ CRUD + çŠ¶æ€æœºï¼ˆ23 ä¸ªç«¯ç‚¹ï¼‰
- `ReportTeam.cs` / `ReportTeamMember.cs` â€” å›¢é˜Ÿ + æˆå‘˜æ¨¡å‹
- `ReportTemplate.cs` â€” æ¨¡æ¿æ¨¡å‹ï¼ˆæ®µè½å®šä¹‰ + å²—ä½ç»‘å®šï¼‰
- `WeeklyReport.cs` â€” å‘¨æŠ¥ä¸»ä½“ï¼ˆçŠ¶æ€æœº + æ®µè½å†…å®¹ï¼‰
- `MongoDbContext.cs` â€” 4 é›†åˆ + ç´¢å¼•æ³¨å†Œ
- `BsonClassMapRegistration.cs` â€” åµŒå¥—ç±»å‹åºåˆ—åŒ–æ³¨å†Œ
- `AdminPermissionCatalog.cs` â€” 4 æƒé™ç‚¹
- `AdminMenuCatalog.cs` â€” èœå•æ³¨å†Œ

**å‰ç«¯ (React/TypeScript)**ï¼š
- `ReportAgentPage.tsx` â€” ä¸»é¡µé¢ï¼ˆ4 tabs: æˆ‘çš„å‘¨æŠ¥/å›¢é˜Ÿé¢æ¿/æ¨¡æ¿ç®¡ç†/å›¢é˜Ÿç®¡ç†ï¼‰
- `MyReportsList.tsx` â€” æˆ‘çš„å‘¨æŠ¥åˆ—è¡¨
- `ReportEditor.tsx` â€” å‘¨æŠ¥ç¼–è¾‘å™¨ï¼ˆ302 è¡Œï¼‰
- `ReportDetailPanel.tsx` â€” å‘¨æŠ¥è¯¦æƒ…é¢æ¿
- `TeamDashboard.tsx` â€” å›¢é˜Ÿé¢æ¿ï¼ˆæˆå‘˜å‘¨æŠ¥ä¸€è§ˆï¼‰
- `TemplateManager.tsx` â€” æ¨¡æ¿ç®¡ç†
- `TeamManager.tsx` â€” å›¢é˜Ÿç®¡ç†
- `reportAgentStore.ts` â€” Zustand çŠ¶æ€ç®¡ç†
- `services/contracts/reportAgent.ts` â€” ç±»å‹å®šä¹‰
- `services/real/reportAgent.ts` â€” API å®ç°

**DB é›†åˆ**ï¼š`report_teams`, `report_team_members`, `report_templates`, `report_weekly_reports`

### æ¶æ„å†³ç­–

| å†³ç­– | é€‰æ‹© | ç†ç”± |
|------|------|------|
| appKey | `report-agent` | éµå¾ª kebab-case è§„èŒƒ |
| è·¯ç”±å‰ç¼€ | `/api/report-agent` | éµå¾ª Controller èº«ä»½éš”ç¦»åŸåˆ™ |
| çŠ¶æ€æœº | NotStarted â†’ Draft â†’ Submitted â†’ Reviewed/Returned â†’ Overdue | PRD Â§4.2 å®šä¹‰ |
| æƒé™ | 4 ç‚¹ (use / template.manage / team.manage / view.all) | PRD Â§9.3 å®šä¹‰ |
| å‘¨æœŸæ ‡è¯† | ISO 8601 WeekYear + WeekNumber | è·¨å¹´å‘¨å¤„ç†ä¸€è‡´ |

---

## Phase 2ï¼šè‡ªåŠ¨é‡‡é›† â€” âœ… DONE

> Commit: `ffce7fd` (2026-02-26) â€” 26 files, +2838 lines / -9 lines

### äº¤ä»˜ç‰©

**åç«¯æ–°å¢ â€” æ¨¡å‹ (3 ä¸ª)**ï¼š
- `ReportDailyLog.cs` â€” æ¯æ—¥æ‰“ç‚¹ï¼ˆUserId+Date å”¯ä¸€ï¼‰
- `ReportDataSource.cs` â€” Git æ•°æ®æºé…ç½®ï¼ˆToken åŠ å¯†å­˜å‚¨ï¼‰
- `ReportCommit.cs` â€” åŒæ­¥çš„ä»£ç æäº¤è®°å½•

**åç«¯æ–°å¢ â€” æœåŠ¡ (6 ä¸ªæ–‡ä»¶)**ï¼š
- `ICodeSourceConnector.cs` â€” ä»£ç æºè¿æ¥å™¨æ¥å£
- `GitHubConnector.cs` â€” GitHub REST API å®ç°ï¼ˆ164 è¡Œï¼‰
- `GitSyncWorker.cs` â€” BackgroundService å®šæ—¶åŒæ­¥ï¼ˆ106 è¡Œï¼‰
- `MapActivityCollector.cs` â€” MAP å¹³å°æ´»åŠ¨é‡‡é›†ï¼ˆ146 è¡Œï¼‰
- `ReportGenerationService.cs` â€” AI ç”Ÿæˆå¼•æ“ï¼ˆ340 è¡Œï¼‰
- `ReportAutoGenerateWorker.cs` â€” å‘¨äº”è‡ªåŠ¨ç”Ÿæˆ BackgroundServiceï¼ˆ181 è¡Œï¼‰

**åç«¯ä¿®æ”¹**ï¼š
- `ReportAgentController.cs` â€” +488 è¡Œï¼Œæ–°å¢ 13 ä¸ªç«¯ç‚¹
- `WeeklyReport.cs` â€” +AutoGeneratedAt å­—æ®µ
- `AppCallerRegistry.cs` â€” +ReportAgent (generate::chat, polish::chat)
- `AdminPermissionCatalog.cs` â€” +report-agent.datasource.manage
- `MongoDbContext.cs` â€” +3 é›†åˆ +4 ç´¢å¼•
- `Program.cs` â€” +4 DI æ³¨å†Œ

**å‰ç«¯æ–°å¢**ï¼š
- `DailyLogPanel.tsx` â€” æ¯æ—¥æ‰“ç‚¹é¢æ¿ï¼ˆ309 è¡Œï¼‰
- `DataSourceManager.tsx` â€” æ•°æ®æºç®¡ç†ï¼ˆ431 è¡Œï¼‰

**å‰ç«¯ä¿®æ”¹**ï¼š
- `ReportAgentPage.tsx` â€” +2 tabsï¼ˆæ¯æ—¥æ‰“ç‚¹/æ•°æ®æºï¼‰â†’ å…± 6 tabs
- `ReportEditor.tsx` â€” +AI ä¸€é”®ç”ŸæˆæŒ‰é’® +æ¥æºæ ‡ç­¾
- `services/contracts/reportAgent.ts` â€” +154 è¡Œç±»å‹
- `services/real/reportAgent.ts` â€” +131 è¡Œ API

**DB æ–°å¢é›†åˆ**ï¼š`report_daily_logs`, `report_data_sources`, `report_commits`

### API ç«¯ç‚¹æ¸…å•

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/report-agent/daily-logs` | POST | Upsert æ¯æ—¥æ‰“ç‚¹ |
| `/api/report-agent/daily-logs` | GET | åˆ—è¡¨ï¼ˆæŒ‰æ—¥æœŸèŒƒå›´ï¼‰ |
| `/api/report-agent/daily-logs/{date}` | GET | è·å–æŒ‡å®šæ—¥æœŸ |
| `/api/report-agent/daily-logs/{date}` | DELETE | åˆ é™¤æŒ‡å®šæ—¥æœŸ |
| `/api/report-agent/data-sources` | GET | æ•°æ®æºåˆ—è¡¨ |
| `/api/report-agent/data-sources` | POST | åˆ›å»ºæ•°æ®æº |
| `/api/report-agent/data-sources/{id}` | PUT | æ›´æ–°æ•°æ®æº |
| `/api/report-agent/data-sources/{id}` | DELETE | åˆ é™¤æ•°æ®æº |
| `/api/report-agent/data-sources/{id}/test` | POST | æµ‹è¯•è¿æ¥ |
| `/api/report-agent/data-sources/{id}/sync` | POST | æ‰‹åŠ¨åŒæ­¥ |
| `/api/report-agent/data-sources/{id}/commits` | GET | æŸ¥çœ‹åŒæ­¥æäº¤ |
| `/api/report-agent/reports/{id}/generate` | POST | AI ç”Ÿæˆ |
| `/api/report-agent/activity` | GET | é¢„è§ˆé‡‡é›†æ•°æ® |

### æ¶æ„å†³ç­–

| å†³ç­– | é€‰æ‹© | ç†ç”± |
|------|------|------|
| Git æ¥å…¥æ–¹å¼ | REST API è½®è¯¢ï¼ˆé Webhookï¼‰ | PRD æ˜ç¡®ï¼›æ— éœ€å…¬ç½‘å…¥å£ |
| MAP æ´»åŠ¨é‡‡é›† | æŒ‰éœ€æŸ¥è¯¢ï¼ˆéåå°ç¼“å­˜ï¼‰ | åŒåº“ç›´æŸ¥ï¼Œé¿å…å‰¯æœ¬ç»´æŠ¤ |
| AI ç”Ÿæˆæ¨¡å¼ | æ‰‹åŠ¨=åŒæ­¥ `SendAsync`ï¼›è‡ªåŠ¨=å®šæ—¶ BackgroundService | æ‰‹åŠ¨åœºæ™¯å“åº”å¿« |
| Git è¿æ¥å™¨æŠ½è±¡ | `ICodeSourceConnector` æ¥å£ | Phase 4 å¯æ‰©å±• SVN/GitLab |
| Token åŠ å¯† | å¤ç”¨ `ApiKeyCrypto` (AES-256-CBC) | å·²æœ‰æˆç†Ÿå®ç° |
| LLM è°ƒç”¨ | Gateway `report-agent.generate::chat` | éµå¾ª Gateway ç»Ÿä¸€è°ƒç”¨è§„åˆ™ |
| å®šæ—¶å™¨ | BackgroundService æ¨¡å¼ | å‚è€ƒ `LlmRequestLogWatchdog` |

---

## Phase 3ï¼šç®¡ç†å¢å¼º â€” âœ… DONE

> Commit: `005de06` (2026-02-27) â€” 20 files, +1618/-56 lines
> åŠŸèƒ½ï¼šé€šçŸ¥ç³»ç»Ÿ + é€€å›å®Œå–„ + è¯„è®ºç³»ç»Ÿ + è®¡åˆ’æ¯”å¯¹ + å›¢é˜Ÿæ±‡æ€»

### äº¤ä»˜ç‰©

**åç«¯æ–°å¢ â€” æ¨¡å‹ (2 ä¸ª)**ï¼š
- `ReportComment.cs` â€” æ®µè½çº§è¯„è®ºï¼ˆæ”¯æŒå›å¤çº¿ç¨‹ï¼ŒParentCommentIdï¼‰
- `TeamSummary.cs` â€” AI å›¢é˜Ÿæ±‡æ€»ï¼ˆTeamSummarySection åˆ†æ®µç»“æ„ï¼‰

**åç«¯æ–°å¢ â€” æœåŠ¡ (2 ä¸ª)**ï¼š
- `ReportNotificationService.cs` â€” 7 ç§é€šçŸ¥äº‹ä»¶ï¼ˆå¤ç”¨ AdminNotification + Key å¹‚ç­‰å»é‡ï¼‰
- `TeamSummaryService.cs` â€” AI å›¢é˜Ÿæ±‡æ€»ç”Ÿæˆï¼ˆILlmGateway.SendAsync + JSON è§£æï¼‰

**åç«¯ä¿®æ”¹**ï¼š
- `ReportAgentController.cs` â€” +6 ç«¯ç‚¹ï¼Œ+é€šçŸ¥è°ƒç”¨ï¼ˆSubmit/Review/Returnï¼‰ï¼Œ+2 DI æ³¨å…¥
- `WeeklyReport.cs` â€” +3 å­—æ®µï¼ˆReturnedBy/ReturnedByName/ReturnedAtï¼‰
- `AppCallerRegistry.cs` â€” +`report-agent.aggregate::chat` AppCallerCode
- `MongoDbContext.cs` â€” +2 é›†åˆï¼ˆ`report_comments`, `report_team_summaries`ï¼‰+3 ç´¢å¼•
- `ReportAutoGenerateWorker.cs` â€” +æˆªæ­¢æé†’ï¼ˆå‘¨äº” 10:00/15:00ï¼‰+é€¾æœŸæ ‡è®°ï¼ˆå‘¨ä¸€ï¼‰
- `Program.cs` â€” +2 DI æ³¨å†Œï¼ˆReportNotificationService, TeamSummaryServiceï¼‰

**å‰ç«¯æ–°å¢**ï¼š
- `PlanComparisonPanel.tsx` â€” è®¡åˆ’æ¯”å¯¹åŒæ è§†å›¾

**å‰ç«¯ä¿®æ”¹**ï¼š
- `ReportDetailPanel.tsx` â€” +é€€å› banner +è¯„è®ºç³»ç»Ÿ +è®¡åˆ’æ¯”å¯¹ tab
- `TeamDashboard.tsx` â€” +é€€å›å¯¹è¯æ¡† +å›¢é˜Ÿæ±‡æ€»åŒºåŸŸ +Overdue çŠ¶æ€
- `contracts/reportAgent.ts` â€” +ReportComment, PlanComparison, TeamSummary æ¥å£ +6 contract types
- `real/reportAgent.ts` â€” +6 API å‡½æ•°
- `api.ts` â€” +5 è·¯ç”±
- `services/index.ts` â€” +6 å¯¼å‡º

**DB æ–°å¢é›†åˆ**ï¼š`report_comments`, `report_team_summaries`

### API ç«¯ç‚¹æ¸…å•ï¼ˆPhase 3 æ–°å¢ 6 ä¸ªï¼‰

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/report-agent/reports/{id}/comments` | GET | è¯„è®ºåˆ—è¡¨ï¼ˆå¯é€‰ ?sectionIndex=ï¼‰ |
| `/api/report-agent/reports/{id}/comments` | POST | åˆ›å»ºè¯„è®ºï¼ˆæ”¯æŒ parentCommentId å›å¤ï¼‰ |
| `/api/report-agent/reports/{id}/comments/{commentId}` | DELETE | åˆ é™¤è¯„è®ºï¼ˆçº§è”åˆ é™¤å›å¤ï¼‰ |
| `/api/report-agent/reports/{id}/plan-comparison` | GET | è®¡åˆ’æ¯”å¯¹ï¼ˆä¸Šå‘¨è®¡åˆ’ vs æœ¬å‘¨å®é™…ï¼‰ |
| `/api/report-agent/teams/{id}/summary/generate` | POST | AI ç”Ÿæˆå›¢é˜Ÿæ±‡æ€» |
| `/api/report-agent/teams/{id}/summary` | GET | è·å–å›¢é˜Ÿæ±‡æ€»ï¼ˆ?weekYear=&weekNumber=ï¼‰ |

### æ¶æ„å†³ç­–

| å†³ç­– | é€‰æ‹© | ç†ç”± |
|------|------|------|
| é€šçŸ¥æœºåˆ¶ | å¤ç”¨ `AdminNotification` + Key å¹‚ç­‰å»é‡ | å·²æœ‰æˆç†ŸåŸºç¡€è®¾æ–½ï¼Œé¿å…æ–°å»º |
| è¯„è®ºç²’åº¦ | æ®µè½çº§ + ParentCommentId çº¿ç¨‹å›å¤ | ç”¨æˆ·æ˜ç¡®è¦æ±‚ï¼›å‚è€ƒ PrdComment æ¨¡å¼ |
| è®¡åˆ’æ¯”å¯¹ | çº¯æ•°æ®å…³è”ï¼ˆå…³é”®è¯åŒ¹é…æ®µè½æ ‡é¢˜ï¼‰ | ä¸éœ€è¦ LLMï¼Œåªæ˜¯æ•°æ®å±•ç¤º |
| å›¢é˜Ÿæ±‡æ€»å­˜å‚¨ | ç‹¬ç«‹é›†åˆ `report_team_summaries` | ç‹¬ç«‹ç”Ÿå‘½å‘¨æœŸï¼Œå”¯ä¸€ç´¢å¼•æŒ‰å‘¨å»é‡ |
| å›¢é˜Ÿæ±‡æ€» AI | `ILlmGateway.SendAsync` + CancellationToken.None | éµå¾ª Gateway è§„åˆ™ + æœåŠ¡å™¨æƒå¨æ€§ |
| æˆªæ­¢æé†’ | æ‰©å±•ç°æœ‰ `ReportAutoGenerateWorker` | é¿å…æ–°å»º Workerï¼Œå¤ç”¨å®šæ—¶å™¨ |

---

## Phase 4ï¼šä½“éªŒä¼˜åŒ– â€” ğŸ”µ PLANNED

> æ¥æºï¼šPRD `doc/agent.report-agent.md` Â§å…« Phase 4

### å¾…å®ç°

| åŠŸèƒ½ç‚¹ | è¯´æ˜ |
|--------|------|
| SVN è¿æ¥å™¨ | æ‰©å±• `ICodeSourceConnector` å®ç° SVN |
| å†å²è¶‹åŠ¿ | ä¸ªäºº/å›¢é˜Ÿè¶‹åŠ¿å›¾è¡¨ |
| å¯¼å‡ºåŠŸèƒ½ | PDF / Markdown å¯¼å‡º |
| æ¡Œé¢ç«¯æ‰“ç‚¹ | Tauri æ‰˜ç›˜å¿«æ·æ‰“ç‚¹ |
| å‡æœŸ/è¡¥æŠ¥ | è¯·å‡æ ‡è®°ã€è¡¥æŠ¥æµç¨‹ |

---

## é™„å½•ï¼šå…³è”æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| `doc/agent.report-agent.md` | PRD äº§å“éœ€æ±‚ï¼ˆv1.0ï¼Œå®šä¹‰ WHATï¼‰ |
| `CLAUDE.md` åŠŸèƒ½æ³¨å†Œè¡¨ | å…¨å±€åŠŸèƒ½çŠ¶æ€ä¸€è§ˆ |
| `doc/rule.data-dictionary.md` | MongoDB é›†åˆå­—æ®µå®šä¹‰ |
| `doc/rule.app-feature-definition.md` | AppCallerCode å®šä¹‰ |
| `doc/weekly-report-2026-W06.md` | å‘¨æŠ¥è¾“å‡ºæ ·ä¾‹ |
