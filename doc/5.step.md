# PRD Agent 开发进度跟踪

**更新日期**：2024年12月11日  
**当前版本**：v1.0 MVP

---

## ✅ 第一阶段完成情况（MVP v1.0）

### 后端服务 (PrdAgent.Server)
- [x] 项目架构搭建（Api/Core/Infrastructure 三层）
- [x] 用户认证模块（AuthController - 注册/登录/JWT）
- [x] 文档上传解析（DocumentsController）
- [x] 会话管理（SessionsController）
- [x] 智能问答（MessagesController - SSE流式响应）
- [x] 引导讲解模式（GuideController）
- [x] 群组协作（GroupsController）
- [x] 内容缺失检测（GapsController）
- [x] LLM 集成（Claude/OpenAI 客户端）
- [x] MongoDB 数据库集成
- [x] Redis 缓存集成
- [x] 角色 Prompt 模板管理

### 管理后台 (prd-agent-admin)
- [x] 登录页面
- [x] 仪表盘统计
- [x] 用户管理（AdminUsersController）
- [x] 大模型配置（AdminLLMConfigController）
- [x] Token 统计（AdminStatsController）

### 桌面客户端 (prd-agent-desktop)
- [x] Tauri 项目架构
- [x] 用户登录页面
- [x] 文档上传组件
- [x] 对话界面（ChatContainer/MessageList/ChatInput）
- [x] 角色选择（RoleSelector）
- [x] 模式切换（ModeToggle）
- [x] 引导讲解面板（GuidePanel）
- [x] 群组列表（GroupList）
- [x] Rust IPC 命令（auth/document/session/group）

### CI/CD
- [x] GitHub Actions CI（构建和测试）
- [x] 桌面应用发布工作流（含 macOS 签名公证）
- [x] 后端 Docker 镜像发布工作流

---

## 🔲 第二阶段待开发（v1.5 协作增强）

### 附件/多媒体模块 - P1
- [ ] **AttachmentsController** - 附件上传接口
  - POST /api/v1/attachments（multipart/form-data）
  - 支持图片（PNG/JPG/JPEG/GIF/WebP，≤5MB）
  - 支持文档（PDF/TXT/MD/DOCX，≤10MB）
- [ ] **IFileStorage 接口** - 对象存储抽象
- [ ] **OssFileStorage 实现** - 腾讯云COS/阿里云OSS/AWS S3
- [ ] **客户端附件上传组件**
  - Ctrl+V 粘贴剪贴板截图
  - 拖拽文件上传
  - 缩略图预览
- [ ] **多模态消息发送** - 消息支持附件 ID 列表

### 群组协作增强
- [ ] **群组成员管理** - 移除成员、重新生成邀请链接
- [ ] **成员在线状态** - 实时更新
- [ ] **新消息提醒** - 提示音/角标

---

## 🔲 第三阶段待开发（v2.0 运营管理）

### 管理后台增强 - P1/P2
- [ ] **AdminLogsController** - 请求日志查看
  - GET /api/v1/admin/logs/requests
  - 日志筛选（时间/用户/状态）
  - 日志导出（脱敏）
- [ ] **系统告警配置**
  - 错误率告警
  - 响应时间告警
  - LLM 失败率告警
  - 告警通知（邮件/Webhook）
- [ ] **服务健康监控面板**

### 客户端增强 - P2
- [ ] **版本检测与更新**
  - 启动时检测新版本
  - 更新提示与下载
  - 更新失败回滚
- [ ] **用户本地设置**
  - 默认角色
  - 主题切换（暗/亮）

---

## 📋 GitHub Secrets 配置清单

在仓库 Settings → Secrets and variables → Actions 中添加以下密钥：

### Apple 签名与公证（macOS 应用发布必需）
| 密钥名称 | 说明 |
|---------|------|
| `APPLE_ID` | Apple 开发者账号邮箱 |
| `APPLE_PASSWORD` | App 专用密码（在 appleid.apple.com 生成） |
| `APPLE_TEAM_ID` | Apple Team ID（在开发者中心查看） |
| `APPLE_CERTIFICATE` | P12 证书 Base64 编码 |
| `APPLE_CERTIFICATE_PASSWORD` | 证书导出时设置的密码 |

### Tauri 更新签名（可选，用于自动更新）
| 密钥名称 | 说明 |
|---------|------|
| `TAURI_SIGNING_PRIVATE_KEY` | Tauri 更新签名私钥 |
| `TAURI_SIGNING_PRIVATE_KEY_PASSWORD` | 私钥密码 |

### 获取 APPLE_CERTIFICATE 步骤：
1. 在 macOS 钥匙串访问中，右键点击 "Developer ID Application" 证书
2. 选择"导出..."，保存为 `.p12` 文件
3. 设置密码（与 `APPLE_CERTIFICATE_PASSWORD` 一致）
4. 运行命令生成 Base64：
   ```bash
   base64 -i certificate.p12 | pbcopy
   ```
5. 将剪贴板内容粘贴到 `APPLE_CERTIFICATE` 密钥

---

## 📝 版本发布流程

### 发布桌面客户端
```bash
# 1. 更新版本号
# 编辑 prd-agent-desktop/src-tauri/tauri.conf.json 中的 version
# 编辑 prd-agent-desktop/src-tauri/Cargo.toml 中的 version
# 编辑 prd-agent-desktop/package.json 中的 version

# 2. 提交并打标签
git add .
git commit -m "chore: bump version to v1.0.0"
git tag v1.0.0
git push origin main --tags

# 3. GitHub Actions 自动构建并创建 Draft Release
# 4. 在 GitHub Releases 页面编辑并发布
```

### 发布后端服务
```bash
# 推送到 main 分支自动触发 Docker 镜像构建
git push origin main

# 或发布正式版本
git tag v1.0.0-server
git push origin v1.0.0-server
```

---

## 🔗 相关文档

- [设计背景](1.why.md)
- [软件需求规格](2.srs.md)
- [产品需求文档](3.prd.md)
- [开发文档](4.dev.md)

