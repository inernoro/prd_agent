# 海鲜市场（配置共享）PRD

## 一、功能概述

为文学创作Agent的配置管理弹窗增加「海鲜市场」功能，允许用户：
- 将自己的配置（提示词、风格图、水印）发布到公共市场
- 从市场免费下载（Fork）其他用户的配置
- 管理已发布的配置（查看Fork次数、取消发布）

## 二、UI 布局规范

### 2.1 弹窗标题栏布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 配置管理                        [🔘 我的 | ○ 海鲜市场]              ✕   │
│ 系统提示词、风格图与水印设置    ← 副标题随Tab切换变化                    │
└─────────────────────────────────────────────────────────────────────────┘
```

- Tab切换器位于**标题右侧**（不是内容区顶部）
- 副标题随Tab变化：
  - 我的：`系统提示词、风格图与水印设置`
  - 海鲜市场：`发现优质配置，一键免费下载`

### 2.2 「我的」视图布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 系统提示词        + 新建 │ 风格图设置      + 新增配置 │ 水印设置  + 新增 │
├─────────────────────────┼─────────────────────────────┼─────────────────┤
│ ┌─────────────────────┐ │ ┌─────────────────────────┐ │ ┌─────────────┐ │
│ │ ✨ 标题    [文章配图]│ │ │ 风格名称                │ │ │ 水印名称    │ │
│ │ [已公开] [当前]     │ │ │ [已公开]                │ │ │ [已公开]    │ │
│ │                     │ │ │                         │ │ │             │ │
│ │ 内容预览...         │ │ │ [图片预览] [提示词预览] │ │ │ [预览区]    │ │
│ │                     │ │ │                         │ │ │             │ │
│ │ 🔀 12次下载         │ │ │ 🔀 5次下载              │ │ │ 🔀 3次下载  │ │
│ │ [发布/取消发布]     │ │ │ [发布/取消发布]         │ │ │ [发布/取消] │ │
│ │ [选择] [编辑] [删除]│ │ │ [选择] [编辑] [删除]    │ │ │ [选择]...   │ │
│ └─────────────────────┘ │ └─────────────────────────┘ │ └─────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

**卡片元素**：
1. 标题 + 分类标签（全局/文章配图）
2. 已公开徽章（isPublic=true时显示）
3. 当前选中徽章
4. 内容预览区
5. Fork次数（已发布时显示）
6. 操作按钮：
   - 未发布：`[发布]`
   - 已发布：`[取消发布]`
   - 通用：`[选择] [编辑] [删除]`

### 2.3 「海鲜市场」视图布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 🔍 搜索配置名称...    [全部▼] [提示词] [风格图] [水印]    [🔥热门] [🕐最新] │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐         │
│ │ ✨ 生图刘文波     │ │ 🎨 赛博朋克风格  │ │ 💧 极简水印      │         │
│ │ 📝 提示词        │ │    风格图        │ │    水印          │         │
│ │                  │ │                  │ │                  │         │
│ │ 输入是一篇完整...│ │ [图片缩略图]     │ │ [水印预览]       │         │
│ │                  │ │                  │ │                  │         │
│ │ 👤 张三  1/15    │ │ 👤 李四  1/10    │ │ 👤 王五  1/12    │         │
│ │ 🔀 12次下载      │ │ 🔀 8次下载       │ │ 🔀 5次下载       │         │
│ │ [🤚 免费下载]    │ │ [🤚 免费下载]    │ │ [🤚 免费下载]    │         │
│ └──────────────────┘ └──────────────────┘ └──────────────────┘         │
└─────────────────────────────────────────────────────────────────────────┘
```

**筛选栏**：
- 搜索框：按名称搜索
- 分类筛选：全部 / 提示词 / 风格图 / 水印
- 排序：热门（按Fork次数）/ 最新（按发布时间）

**卡片元素**：
1. 标题
2. 类型标签：📝提示词 / 🎨风格图 / 💧水印
3. 内容预览
4. 作者信息：头像 + 昵称 + 发布日期
5. Fork次数
6. 免费下载按钮（Hand图标）

**布局方式**：混合展示所有类型，按筛选和排序条件显示

## 三、功能清单

### 3.1 「我的」视图功能

| 序号 | 功能 | 描述 | 状态 |
|------|------|------|------|
| M1 | Tab切换移到标题栏 | Tab在标题右侧，不在内容区 | ❌ 待开发 |
| M2 | 提示词卡片-发布按钮 | 未发布显示「发布」，点击后发布到市场 | ❌ 待开发 |
| M3 | 提示词卡片-取消发布按钮 | 已发布显示「取消发布」 | ❌ 待开发 |
| M4 | 提示词卡片-已公开徽章 | isPublic=true时显示绿色「已公开」徽章 | ❌ 待开发 |
| M5 | 提示词卡片-Fork次数 | 已发布时显示「🔀 N次下载」 | ❌ 待开发 |
| M6 | 风格图卡片-发布/取消发布 | 同M2/M3 | ❌ 待开发 |
| M7 | 风格图卡片-已公开徽章 | 同M4 | ❌ 待开发 |
| M8 | 风格图卡片-Fork次数 | 同M5 | ❌ 待开发 |
| M9 | 水印卡片-发布/取消发布 | 需要修改WatermarkSettingsPanel | ❌ 待开发 |
| M10 | 水印卡片-已公开徽章 | 同M4 | ❌ 待开发 |
| M11 | 水印卡片-Fork次数 | 同M5 | ❌ 待开发 |

### 3.2 「海鲜市场」视图功能

| 序号 | 功能 | 描述 | 状态 |
|------|------|------|------|
| K1 | 搜索框 | 按配置名称搜索 | ✅ 已实现 |
| K2 | 分类筛选 | 全部/提示词/风格图/水印 | ❌ 待开发 |
| K3 | 排序切换 | 热门/最新 | ✅ 已实现 |
| K4 | 混合展示 | 所有类型混合在一起展示，不分三栏 | ❌ 待开发 |
| K5 | 卡片-类型标签 | 📝提示词 / 🎨风格图 / 💧水印 | ❌ 待开发 |
| K6 | 卡片-作者信息 | 头像 + 昵称 + 发布日期 | ⚠️ 部分实现（缺日期） |
| K7 | 卡片-Fork次数 | 显示下载次数 | ✅ 已实现 |
| K8 | 卡片-免费下载按钮 | Hand图标 + "免费下载" | ✅ 已实现 |
| K9 | 下载后刷新 | 下载后刷新市场数据和我的数据 | ✅ 已实现 |

### 3.3 后端API（已实现）

| 序号 | API | 描述 | 状态 |
|------|-----|------|------|
| A1 | GET /prompts/marketplace | 获取市场提示词列表 | ✅ |
| A2 | POST /prompts/{id}/publish | 发布提示词 | ✅ |
| A3 | POST /prompts/{id}/unpublish | 取消发布 | ✅ |
| A4 | POST /prompts/{id}/fork | Fork提示词 | ✅ |
| A5 | GET /reference-images/marketplace | 获取市场风格图列表 | ✅ |
| A6 | POST /reference-images/{id}/publish | 发布风格图 | ✅ |
| A7 | POST /reference-images/{id}/unpublish | 取消发布 | ✅ |
| A8 | POST /reference-images/{id}/fork | Fork风格图 | ✅ |
| A9 | GET /watermarks/marketplace | 获取市场水印列表 | ✅ |
| A10 | POST /watermarks/{id}/publish | 发布水印 | ✅ |
| A11 | POST /watermarks/{id}/unpublish | 取消发布 | ✅ |
| A12 | POST /watermarks/{id}/fork | Fork水印 | ✅ |

## 四、开发任务清单

### Phase 1: UI布局调整

- [ ] **T1**: 将Tab切换器移到Dialog标题栏右侧
- [ ] **T2**: 副标题随Tab切换变化

### Phase 2: 「我的」视图功能增强

- [ ] **T3**: 提示词卡片添加「发布/取消发布」按钮
- [ ] **T4**: 提示词卡片添加「已公开」徽章
- [ ] **T5**: 提示词卡片添加Fork次数显示
- [ ] **T6**: 风格图卡片添加「发布/取消发布」按钮
- [ ] **T7**: 风格图卡片添加「已公开」徽章和Fork次数
- [ ] **T8**: 水印面板增加发布功能（需修改WatermarkSettingsPanel）

### Phase 3: 「海鲜市场」视图重构

- [ ] **T9**: 添加分类筛选按钮（全部/提示词/风格图/水印）
- [ ] **T10**: 重构为混合展示布局（不分三栏）
- [ ] **T11**: 卡片添加类型标签（📝/🎨/💧）
- [ ] **T12**: 卡片添加发布日期显示

### Phase 4: 测试验证

- [ ] **T13**: 更新e2e测试脚本
- [ ] **T14**: 手动测试全流程

## 五、数据模型补充

需要确保后端API返回以下字段：

```typescript
// 市场配置项通用字段
interface MarketplaceItem {
  id: string;
  name: string;         // 配置名称
  type: 'prompt' | 'reference-image' | 'watermark';  // 配置类型
  forkCount: number;    // Fork次数
  createdAt: string;    // 发布时间
  ownerUserId: string;
  ownerUserName: string;
  ownerUserAvatar?: string;
}
```
