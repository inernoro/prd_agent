# PRD Agent ä»£ç å®¡è®¡æŠ¥å‘Š

> **å®¡è®¡æ—¥æœŸ**: 2026-02-01
> **å®¡è®¡èŒƒå›´**: prd-apiã€prd-adminã€prd-desktopã€doc
> **å®¡è®¡å·¥å…·**: Claude Opus 4.5 è‡ªåŠ¨åŒ–æ‰«æ

---

## ä¸€ã€å®¡è®¡æ‘˜è¦

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| åç«¯ Controller æ•°é‡ | 63 ä¸ª |
| åç«¯ Worker æ•°é‡ | 2 ä¸ª |
| å‰ç«¯é¡µé¢æ•°é‡ | 19 ä¸ª + 13 ä¸ªå­ç›®å½• |
| å‰ç«¯ Store æ•°é‡ | 6 ä¸ª |
| æ¡Œé¢ç«¯ Tauri å‘½ä»¤ | 12 ç±» |
| æ–‡æ¡£æ–‡ä»¶æ•°é‡ | 31 ä¸ª |
| MongoDB é›†åˆæ•°é‡ | 55 ä¸ª |
| **ä¸¥é‡é—®é¢˜** | ğŸ”´ 5 ä¸ª |
| **ä¸­ç­‰é—®é¢˜** | ğŸŸ¡ 12 ä¸ª |
| **è½»å¾®é—®é¢˜** | ğŸŸ¢ 8 ä¸ª |

---

## äºŒã€ç³»ç»Ÿæ¶æ„å›¾

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PRD Agent ç³»ç»Ÿæ¶æ„                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ prd-desktop â”‚    â”‚  prd-admin  â”‚    â”‚ Open API    â”‚                      â”‚
â”‚  â”‚   (Tauri)   â”‚    â”‚   (React)   â”‚    â”‚  Clients    â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚         â”‚                  â”‚                  â”‚                              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                            â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         prd-api (.NET 8)                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                    Controllers (63ä¸ª)                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ PrdAgent     â”‚ â”‚ VisualAgent  â”‚ â”‚ LiteraryAgentâ”‚ DefectAgent â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ appKeyå›ºå®š   â”‚ â”‚ appKeyå›ºå®š*  â”‚ â”‚ appKeyå›ºå®š   â”‚ appKeyå›ºå®š  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                            â”‚                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚                    ILlmGateway (ç»Ÿä¸€å®ˆé—¨å‘˜)                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ModelResolverâ”‚  â”‚HealthManagerâ”‚  â”‚ LogWriter   â”‚            â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ ä¸‰çº§è°ƒåº¦    â”‚  â”‚ è‡ªåŠ¨é™æƒ    â”‚  â”‚ ç»Ÿä¸€æ—¥å¿—    â”‚            â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                            â”‚                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚                   Workers (Run/Worker æ¨¡å¼)                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ChatRunWorkerâ”‚              â”‚ImageGenRunWorkerâ”‚              â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ SSE æµå¼    â”‚              â”‚ å›¾ç‰‡ç”Ÿæˆé˜Ÿåˆ—  â”‚                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ afterSeqé‡è¿â”‚              â”‚ å¼‚æ­¥å¤„ç†     â”‚                 â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         æ•°æ®å±‚                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚  â”‚
â”‚  â”‚  â”‚  MongoDB    â”‚    â”‚   Redis     â”‚    â”‚ Tencent COS â”‚                â”‚  â”‚
â”‚  â”‚  â”‚  55 é›†åˆ    â”‚    â”‚ é€Ÿç‡é™åˆ¶    â”‚    â”‚ å¯¹è±¡å­˜å‚¨    â”‚                â”‚  â”‚
â”‚  â”‚  â”‚  ä¸šåŠ¡æ•°æ®   â”‚    â”‚ æ»‘åŠ¨çª—å£    â”‚    â”‚ å›¾ç‰‡/å­—ä½“   â”‚                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       LLM å¹³å°é€‚é…å±‚                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ OpenAI   â”‚ â”‚ Claude   â”‚ â”‚ Volcengineâ”‚ â”‚ DeepSeek â”‚ â”‚ å…¶ä»–...  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ Adapter  â”‚ â”‚ Adapter  â”‚ â”‚ Adapter  â”‚ â”‚ Adapter  â”‚ â”‚          â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

* ImageGenController çš„ appKey å­˜åœ¨è¿è§„ï¼ˆä»è¯·æ±‚è¯»å–è€Œéç¡¬ç¼–ç ï¼‰
```

### 2.2 LLM Gateway ä¸‰çº§è°ƒåº¦æµç¨‹

```
è¯·æ±‚åˆ°è¾¾
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä¸“å±æ¨¡å‹æ±  (DedicatedPool)        â”‚
â”‚    AppCallerCode â†’ ModelGroupIds    â”‚
â”‚    å‘½ä¸­ï¼Ÿ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ å¦
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. é»˜è®¤æ¨¡å‹æ±  (DefaultPool)          â”‚
â”‚    ModelType â†’ IsDefaultForType     â”‚
â”‚    å‘½ä¸­ï¼Ÿ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ å¦
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä¼ ç»Ÿé…ç½® (Legacy)                 â”‚
â”‚    IsMain/IsIntent/IsVision æ ‡è®°    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Run/Worker æ¨¡å¼æ—¶åº

```
å®¢æˆ·ç«¯                    API                     Worker                  LLM
   â”‚                       â”‚                        â”‚                      â”‚
   â”‚â”€â”€â”€â”€ POST /runs â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚                      â”‚
   â”‚                       â”‚â”€â”€â”€â”€ åˆ›å»º Run â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚
   â”‚â—€â”€â”€â”€â”€ 202 + runId â”€â”€â”€â”€â”€â”‚                        â”‚                      â”‚
   â”‚                       â”‚                        â”‚                      â”‚
   â”‚â”€â”€â”€â”€ GET /runs/{id}/stream â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
   â”‚                       â”‚                        â”‚â”€â”€â”€â”€ LLM è°ƒç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚â—€â”€â”€â”€â”€ SSE event â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€ æµå¼å“åº” â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚â—€â”€â”€â”€â”€ SSE event â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
   â”‚      ...              â”‚                        â”‚                      â”‚
   â”‚                       â”‚                        â”‚                      â”‚
   â”‚  (æ–­çº¿é‡è¿)            â”‚                        â”‚                      â”‚
   â”‚â”€â”€â”€â”€ GET /stream?afterSeq=N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
   â”‚â—€â”€â”€â”€â”€ ç»­ä¼ å‰©ä½™äº‹ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
   â”‚                       â”‚                        â”‚                      â”‚
```

---

## ä¸‰ã€åºŸå¼ƒä»£ç è¯†åˆ«

### 3.1 Guide æ¦‚å¿µï¼ˆå·²åºŸå¼ƒï¼Œä»£ç æœªæ¸…ç†ï¼‰

| æ–‡ä»¶è·¯å¾„ | é—®é¢˜æè¿° | å»ºè®®å¤„ç† |
|----------|----------|----------|
| `prd-api/src/PrdAgent.Core/Models/GuideOutlineItem.cs` | æ•´ä¸ªæ–‡ä»¶åº”åˆ é™¤ | ğŸ”´ åˆ é™¤ |
| `prd-api/src/PrdAgent.Core/Models/Enums.cs` | å¯èƒ½åŒ…å« Guide ç›¸å…³æšä¸¾ | æ£€æŸ¥å¹¶æ¸…ç† |
| `prd-api/src/PrdAgent.Core/Interfaces/IPromptManager.cs` | `GetGuideOutline()` æ–¹æ³• | ğŸ”´ åˆ é™¤æ–¹æ³• |
| `prd-api/src/PrdAgent.Infrastructure/Prompts/PromptManager.cs` | Guide ç›¸å…³é€»è¾‘ | ğŸ”´ æ¸…ç† |
| `prd-api/src/PrdAgent.Core/Models/Session.cs` | å¯èƒ½æœ‰ GuideStep å­—æ®µ | æ£€æŸ¥å¹¶æ¸…ç† |
| `prd-desktop/src-tauri/src/models/mod.rs:62` | `guide_step: Option<i32>` å­—æ®µ | ğŸ”´ åˆ é™¤å­—æ®µ |
| `prd-admin/src/pages/lab-desktop/DesktopLabTab.tsx` | å¯èƒ½æœ‰ Guide ç›¸å…³ UI | æ£€æŸ¥ |

**åºŸå¼ƒåŸå› **: æ ¹æ® CLAUDE.mdï¼ŒGuide å¼•å¯¼è®²è§£æ¨¡å¼å·²è¢« Prompt Stages æç¤ºè¯é˜¶æ®µå®Œå…¨æ›¿ä»£ã€‚æ–‡æ¡£å·²åˆ é™¤ç›¸å…³æè¿°ï¼Œä½†ä»£ç æ®‹ç•™ã€‚

### 3.2 Provider æ¦‚å¿µï¼ˆå·²åºŸå¼ƒï¼Œä»£ç ä¿ç•™å…¼å®¹ï¼‰

| æ–‡ä»¶è·¯å¾„ | å½“å‰çŠ¶æ€ | å»ºè®®å¤„ç† |
|----------|----------|----------|
| `prd-api/src/PrdAgent.Core/Models/LLMPlatform.cs` | åŒ…å« ProviderId | ğŸŸ¡ ä¿ç•™å…¼å®¹ |
| `prd-api/src/PrdAgent.Core/Models/LlmRequestLog.cs` | åŒ…å« Provider å­—æ®µ | ğŸŸ¡ ä¿ç•™å…¼å®¹ |
| å¤šä¸ª Adapter æ–‡ä»¶ | ä½¿ç”¨ provider å‘½å | ğŸŸ¡ ä¿ç•™å…¼å®¹ |

**åºŸå¼ƒåŸå› **: Provider æ¦‚å¿µå·²è¢« Platform æ¦‚å¿µæ›¿ä»£ã€‚ä»£ç ä¸­ä¿ç•™æ˜¯ä¸ºäº†æ•°æ®å…¼å®¹æ€§ï¼Œä¸éœ€è¦ç«‹å³æ¸…ç†ã€‚

### 3.3 ImageMaster å‘½åï¼ˆä»£ç å±‚ä¿ç•™ï¼‰

| ä½ç½® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| MongoDB é›†åˆå | `image_master_*` | ğŸŸ¢ ä¿ç•™ï¼ˆæ•°æ®å…¼å®¹ï¼‰ |
| ä»£ç ç±»å | `ImageMasterController` | ğŸŸ¡ å¯é‡å‘½åä¸º VisualAgent |
| Model ç±»å | `ImageMaster*` | ğŸŸ¡ å¯é‡å‘½å |

---

## å››ã€ä»£ç ä¸æ–‡æ¡£å·®å¼‚

### 4.1 ä¸¥é‡å·®å¼‚ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

| # | å·®å¼‚æè¿° | æ–‡æ¡£è¦æ±‚ | ä»£ç å®é™… | ä¿®å¤å»ºè®® |
|---|----------|----------|----------|----------|
| 1 | **ImageGenController appKey** | Controller ç¡¬ç¼–ç  appKey | ä»è¯·æ±‚è¯»å– (è¡Œ 1027-1033) | ğŸ”´ ä¿®æ”¹ä¸º `const AppKey = "visual-agent"` |
| 2 | **å‰ç«¯ä¸šåŠ¡æ˜ å°„è¡¨** | åç«¯è¿”å› displayName | `appCallerUtils.ts:199-246` ç¡¬ç¼–ç  | ğŸ”´ åˆ é™¤æ˜ å°„ï¼Œä½¿ç”¨åç«¯æ•°æ® |
| 3 | **å‰ç«¯èœå•æ˜ å°„** | åç«¯è¿”å›èœå•å®šä¹‰ | `authzMenuMapping.ts:16-100` ç¡¬ç¼–ç  | ğŸ”´ æ”¹ç”¨åç«¯ API |

### 4.2 ä¸­ç­‰å·®å¼‚ï¼ˆåº”è¯¥ä¿®å¤ï¼‰

| # | å·®å¼‚æè¿° | æ–‡æ¡£è¦æ±‚ | ä»£ç å®é™… | ä¿®å¤å»ºè®® |
|---|----------|----------|----------|----------|
| 4 | **ç›´æ¥ fetch() è°ƒç”¨** | é€šè¿‡ services å±‚ | `AiChatPage.tsx:818-820` | ğŸŸ¡ å°è£…åˆ° services |
| 5 | **ç›´æ¥ fetch() è°ƒç”¨** | é€šè¿‡ services å±‚ | `PromptStagesPage.tsx:575-576` | ğŸŸ¡ å°è£…åˆ° services |
| 6 | **æ¡Œé¢ç«¯è§’è‰²æ˜ å°„** | åç«¯è¿”å› | `MessageList.tsx` ç¡¬ç¼–ç  roleZh | ğŸŸ¡ æ”¹ç”¨åç«¯æ•°æ® |
| 7 | **localStorage æ¸…ç†** | ç™»å‡ºæ¸…ç†æ‰€æœ‰ | `prd-desktop authStore.ts:40-46` ä¸æ¸…ç† | ğŸŸ¡ æ·»åŠ æ¸…ç†é€»è¾‘ |

### 4.3 æ–‡æ¡£éœ€æ›´æ–°

| # | æ–‡æ¡£ä½ç½® | éœ€æ›´æ–°å†…å®¹ |
|---|----------|------------|
| 8 | `5.step.md` | æ›´æ–°å¹´ä»½ 2024 â†’ 2026 |
| 9 | `2.srs.md` | PRD åŸæ–‡ç•™å­˜å†³ç­–éœ€è½å®šï¼ˆå®é™…å·²è½åº“ï¼‰ |
| 10 | ç¼ºå¤± | ç¼ºå°‘æ•°æ®æµå›¾ã€æ—¶åºå›¾ã€çŠ¶æ€æœºå›¾ |

---

## äº”ã€è§„åˆ™è°ƒæ•´å»ºè®®

### 5.1 æ–°å¢è§„åˆ™å»ºè®®

#### è§„åˆ™ A: SSE/æµå¼æ¥å£å°è£…è§„èŒƒ

```markdown
## SSE æµå¼æ¥å£å°è£…è§„èŒƒ

**åŸåˆ™**ï¼šæ‰€æœ‰ SSE æµå¼è¯·æ±‚å¿…é¡»é€šè¿‡ services å±‚å°è£…ï¼Œç¦æ­¢åœ¨é¡µé¢ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ fetch()ã€‚

### åŸå› 
1. ç»Ÿä¸€å¤„ç† Token åˆ·æ–°ã€é”™è¯¯é‡è¯•
2. ç»Ÿä¸€ç®¡ç† AbortController ç”Ÿå‘½å‘¨æœŸ
3. ä¾¿äºæ—¥å¿—è®°å½•å’Œè°ƒè¯•

### å®ç°æ¨¡å¼
```typescript
// services/real/streaming.ts
export async function* streamChat(params: ChatParams): AsyncGenerator<ChatChunk> {
  const response = await fetchWithAuth('/api/v1/chat/stream', {
    method: 'POST',
    headers: { Accept: 'text/event-stream' },
    body: JSON.stringify(params),
  });
  // ... SSE è§£æé€»è¾‘
}

// é¡µé¢ä¸­ä½¿ç”¨
for await (const chunk of streamChat(params)) {
  // å¤„ç† chunk
}
```
```

#### è§„åˆ™ B: Rust Mutex å®‰å…¨è§„èŒƒ

```markdown
## Rust Mutex å®‰å…¨è§„èŒƒ

**åŸåˆ™**ï¼šç¦æ­¢åœ¨ç”Ÿäº§ä»£ç ä¸­ä½¿ç”¨ `.unwrap()` å¤„ç† Mutex é”ã€‚

### é”™è¯¯ç¤ºä¾‹
```rust
let guard = self.state.lock().unwrap(); // âŒ å¯èƒ½ panic
```

### æ­£ç¡®ç¤ºä¾‹
```rust
let guard = self.state.lock().unwrap_or_else(|e| {
    log::error!("Mutex poisoned: {}", e);
    e.into_inner() // æ¢å¤é”
});
```

### åŸå› 
- Mutex è¢« panic æ±¡æŸ“åï¼Œunwrap ä¼šå¯¼è‡´çº§è” panic
- ç”Ÿäº§ç¯å¢ƒåº”ä¼˜é›…é™çº§è€Œéå´©æºƒ
```

#### è§„åˆ™ C: ç»„ä»¶å¤æ‚åº¦é™åˆ¶

```markdown
## ç»„ä»¶å¤æ‚åº¦é™åˆ¶

**åŸåˆ™**ï¼šå•ä¸ªç»„ä»¶æ–‡ä»¶ä¸åº”è¶…è¿‡ 800 è¡Œã€‚è¶…è¿‡æ—¶å¿…é¡»æ‹†åˆ†ã€‚

### å½“å‰è¿è§„
- `prd-desktop/src/components/Chat/MessageList.tsx` (1,477 è¡Œ)
- `prd-admin/src/pages/LlmLogsPage.tsx` (117KB)

### æ‹†åˆ†ç­–ç•¥
1. æŒ‰èŒè´£æ‹†åˆ†ä¸ºå­ç»„ä»¶
2. æå– hooks åˆ°å•ç‹¬æ–‡ä»¶
3. æå–å·¥å…·å‡½æ•°åˆ° lib/
```

### 5.2 ç°æœ‰è§„åˆ™ä¿®è®¢å»ºè®®

#### ä¿®è®¢ 1: å‰ç«¯æ¶æ„åŸåˆ™è¡¥å……

åœ¨ CLAUDE.md "å‰ç«¯æ¶æ„åŸåˆ™" éƒ¨åˆ†è¡¥å……ï¼š

```markdown
### è¡¥å……ï¼šSSE/æµå¼æ¥å£è§„èŒƒ

**è§„åˆ™**ï¼šæ‰€æœ‰ SSE/æµå¼æ¥å£è°ƒç”¨å¿…é¡»å°è£…åœ¨ `/services/real/*.ts` ä¸­ã€‚

**ç¦æ­¢**ï¼š
```typescript
// âŒ é¡µé¢ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨
const res = await fetch('/api/stream', { headers: { Accept: 'text/event-stream' } });
```

**å…è®¸**ï¼š
```typescript
// âœ… é€šè¿‡ services å±‚è°ƒç”¨
import { streamChat } from '@/services';
for await (const chunk of streamChat(params)) { ... }
```
```

#### ä¿®è®¢ 2: åºŸå¼ƒæ¦‚å¿µæ¸…å•æ›´æ–°

åœ¨ CLAUDE.md "å·²åºŸå¼ƒæ¦‚å¿µ" éƒ¨åˆ†è¡¥å……æ¸…ç†çŠ¶æ€ï¼š

```markdown
### å·²åºŸå¼ƒæ¦‚å¿µ (å‹¿å†å¼•ç”¨)

| åºŸå¼ƒæ¦‚å¿µ | æ›¿ä»£æ–¹æ¡ˆ | æ¸…ç†çŠ¶æ€ |
|----------|----------|----------|
| Guide å¼•å¯¼è®²è§£æ¨¡å¼ | Prompt Stages | âš ï¸ ä»£ç æœªæ¸…ç† |
| Provider ä¾›åº”å•† | Platform å¹³å° | âœ… ä¿ç•™å…¼å®¹ |
| ImageMaster (ä»£ç å±‚) | VisualAgent | âœ… DB é›†åˆåä¿ç•™ |
| ç›´æ¥ SSE æµ | Run/Worker + afterSeq | âœ… å·²è¿ç§» |
| GuideController | å·²åˆ é™¤ | âš ï¸ Model ç±»æœªåˆ  |
```

---

## å…­ã€é—®é¢˜æ¸…å•æ±‡æ€»

### ğŸ”´ ä¸¥é‡é—®é¢˜ (P0 - å¿…é¡»ä¿®å¤)

| # | ç»„ä»¶ | é—®é¢˜ | æ–‡ä»¶ | è¡Œå· |
|---|------|------|------|------|
| 1 | prd-api | ImageGenController appKey æœªç¡¬ç¼–ç  | `Controllers/Api/ImageGenController.cs` | 1027-1033 |
| 2 | prd-admin | ä¸šåŠ¡æ˜ å°„è¡¨ç¡¬ç¼–ç  | `lib/appCallerUtils.ts` | 199-246 |
| 3 | prd-admin | èœå•å®šä¹‰ç¡¬ç¼–ç  | `lib/authzMenuMapping.ts` | 16-100 |
| 4 | prd-api | GuideOutlineItem æœªæ¸…ç† | `Core/Models/GuideOutlineItem.cs` | å…¨æ–‡ä»¶ |
| 5 | prd-desktop | Mutex unwrap å¯èƒ½ panic | `commands/session.rs` | 22-51 |

### ğŸŸ¡ ä¸­ç­‰é—®é¢˜ (P1 - åº”è¯¥ä¿®å¤)

| # | ç»„ä»¶ | é—®é¢˜ | æ–‡ä»¶ | è¡Œå· |
|---|------|------|------|------|
| 6 | prd-admin | SSE ç›´æ¥ fetch | `pages/AiChatPage.tsx` | 818-820 |
| 7 | prd-admin | SSE ç›´æ¥ fetch | `pages/PromptStagesPage.tsx` | 575-576 |
| 8 | prd-desktop | guide_step å­—æ®µæœªåˆ  | `models/mod.rs` | 62 |
| 9 | prd-desktop | è§’è‰²ä¸­æ–‡æ˜ å°„ç¡¬ç¼–ç  | `components/Chat/MessageList.tsx` | 42-78 |
| 10 | prd-desktop | localStorage ç™»å‡ºä¸æ¸…ç† | `stores/authStore.ts` | 40-46 |
| 11 | prd-desktop | MessageList è¿‡å¤§ | `components/Chat/MessageList.tsx` | 1,477è¡Œ |
| 12 | prd-desktop | GitHub æ›´æ–° URL ç¡¬ç¼–ç  | `commands/updater.rs` | 126 |
| 13 | prd-api | IPromptManager.GetGuideOutline æœªåˆ  | `Interfaces/IPromptManager.cs` | - |

### ğŸŸ¢ è½»å¾®é—®é¢˜ (P2 - å¯é€‰ä¿®å¤)

| # | ç»„ä»¶ | é—®é¢˜ | æ–‡ä»¶ |
|---|------|------|------|
| 14 | prd-desktop | TypeScript any ç±»å‹ | `App.tsx:99,162,262` |
| 15 | prd-desktop | send_message å‚æ•°è¿‡å¤š | `commands/session.rs:404-414` |
| 16 | prd-api | Provider å­—æ®µä¿ç•™ | å¤šä¸ªæ–‡ä»¶ï¼ˆå…¼å®¹æ€§ä¿ç•™ï¼‰ |
| 17 | doc | 5.step.md å¹´ä»½è¿‡æ—§ | `doc/5.step.md` |
| 18 | doc | ç¼ºå°‘æ¶æ„å›¾ | éœ€è¡¥å……æ•°æ®æµ/æ—¶åºå›¾ |

---

## ä¸ƒã€ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼šå®‰å…¨ä¸åˆè§„ (1-2 å‘¨)

1. **ImageGenController appKey ç¡¬ç¼–ç ** - ä¿®å¤åº”ç”¨èº«ä»½éš”ç¦»æ¼æ´
2. **Mutex unwrap æ›¿æ¢** - é˜²æ­¢ç”Ÿäº§ç¯å¢ƒ panic
3. **Guide ç›¸å…³ä»£ç æ¸…ç†** - ç§»é™¤åºŸå¼ƒä»£ç 

### ç¬¬äºŒé˜¶æ®µï¼šæ¶æ„ä¸€è‡´æ€§ (2-3 å‘¨)

4. **å‰ç«¯æ˜ å°„è¡¨æ¸…ç†** - å®ç°å•ä¸€æ•°æ®æºåŸåˆ™
5. **SSE æ¥å£å°è£…** - ç»Ÿä¸€ services å±‚
6. **localStorage æ¸…ç†é€»è¾‘** - ä¿®å¤ç™»å‡ºå®‰å…¨

### ç¬¬ä¸‰é˜¶æ®µï¼šä»£ç è´¨é‡ (æŒç»­)

7. **MessageList æ‹†åˆ†** - é™ä½ç»„ä»¶å¤æ‚åº¦
8. **TypeScript ç±»å‹å®‰å…¨** - æ¶ˆé™¤ any ç±»å‹
9. **æ–‡æ¡£æ›´æ–°** - è¡¥å……æ¶æ„å›¾ï¼Œæ›´æ–°å¹´ä»½

---

## å…«ã€åç»­ç»´æŠ¤å»ºè®®

### 8.1 è‡ªåŠ¨åŒ–æ£€æŸ¥é›†æˆ

å»ºè®®åœ¨ CI/CD ä¸­æ·»åŠ ä»¥ä¸‹æ£€æŸ¥ï¼š

```yaml
# .github/workflows/audit.yml
- name: Check for deprecated patterns
  run: |
    # æ£€æŸ¥ Guide ç›¸å…³ä»£ç 
    ! grep -r "GuideOutline\|guide_step" --include="*.cs" --include="*.rs" --include="*.ts"

    # æ£€æŸ¥å‰ç«¯ç¡¬ç¼–ç æ˜ å°„
    ! grep -r "getAppDisplayName\|getFeatureDisplayName" --include="*.ts"

    # æ£€æŸ¥ç›´æ¥ fetch è°ƒç”¨ SSE
    ! grep -r "fetch.*text/event-stream" --include="*.tsx"
```

### 8.2 å®šæœŸå®¡è®¡è®¡åˆ’

| é¢‘ç‡ | å®¡è®¡é¡¹ç›® |
|------|----------|
| æ¯å‘¨ | åºŸå¼ƒä»£ç æ‰«æ |
| æ¯æœˆ | ä»£ç ä¸æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥ |
| æ¯å­£åº¦ | æ¶æ„å›¾æ›´æ–° |
| æ¯åŠå¹´ | å…¨é¢ä»£ç å®¡è®¡ |

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-01
**å®¡è®¡æ‰§è¡Œè€…**: Claude Opus 4.5
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0
