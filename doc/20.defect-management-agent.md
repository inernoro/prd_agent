# ç¼ºé™·ç®¡ç† Agent è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**ï¼šv1.0 | **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-23 | **appKey**ï¼š`defect-agent`
>
> **å®šä½**ï¼šå°†"æ‰¾é—®é¢˜"çš„èŒè´£ä»å¼€å‘è€…ç§»äº¤ç»™äº§å“ã€æµ‹è¯•ã€ä»»ä½•äººã€‚AI è´Ÿè´£åˆå®¡ã€å¤ç°éªŒè¯ã€è‡ªåŠ¨ä¿®å¤ï¼ˆè½»é‡çº§ï¼‰ï¼Œç¨‹åºå‘˜ä»…è´Ÿè´£ Code Review å’Œåˆå¹¶ã€‚

---

## ä¸€ã€äº§å“æ¦‚è¿°

### 1.1 æ ¸å¿ƒç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ä¼ ç»Ÿæ¨¡å¼:  å‘ç°é—®é¢˜ â†’ å¼€å‘è€…æ’æŸ¥ â†’ å¼€å‘è€…ä¿®å¤ â†’ å¼€å‘è€…è‡ªæµ‹ â†’ ä¸Šçº¿      â”‚
â”‚                                                                          â”‚
â”‚   æ–°æ¨¡å¼:    ä»»ä½•äººæäº¤ â†’ AI åˆå®¡ â†’ AI å®šä½ â†’ AI ä¿®å¤ â†’ å¼€å‘è€…åˆå¹¶       â”‚
â”‚              ~~~~~~~~      ~~~~~     ~~~~~     ~~~~~     ~~~~~~~~~~       â”‚
â”‚              äº§å“/æµ‹è¯•      è¿‡æ»¤      åˆ†æ      ç”ŸæˆPR     Code Review    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç”¨æˆ·è§’è‰²

| è§’è‰² | èŒè´£ | æƒé™ |
|------|------|------|
| **æäº¤è€…** (äº§å“/æµ‹è¯•/ä»»ä½•äºº) | æäº¤ç¼ºé™·æŠ¥å‘Šã€æˆªå›¾ã€æè¿° | `defect-agent.use` |
| **AI Agent** | åˆå®¡ã€åˆ†æã€å®šä½ã€ä¿®å¤å»ºè®®/è‡ªåŠ¨ä¿®å¤ | ç³»ç»Ÿå†…ç½® |
| **å¼€å‘è€…** (å®¡æ ¸äºº) | Code Reviewã€åˆå¹¶/æ‹’ç» PR | `defect-agent.review` |
| **ç®¡ç†å‘˜** | é…ç½®è§„åˆ™ã€æŸ¥çœ‹ç»Ÿè®¡ã€ç®¡ç†ä»“åº“æˆæƒ | `defect-agent.manage` |

### 1.3 æ ¸å¿ƒä»·å€¼

- **é™ä½é—¨æ§›**ï¼šä¸æ‡‚ä»£ç ä¹Ÿèƒ½ç²¾ç¡®æè¿°å’Œå®šä½é—®é¢˜
- **AI è¿‡æ»¤**ï¼šæç¤ºè¯é©±åŠ¨çš„åˆå®¡ï¼Œè¿‡æ»¤ 80% æ— æ•ˆ/é‡å¤é—®é¢˜
- **è‡ªåŠ¨ä¿®å¤**ï¼šç®€å• Bug ç”± AI ç›´æ¥ç”Ÿæˆä¿®å¤ PR
- **åä½œé—­ç¯**ï¼šä¸ GitHub æ·±åº¦é›†æˆï¼Œå®Œæ•´çš„çŠ¶æ€æµè½¬

---

## äºŒã€ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç¼ºé™·ç®¡ç† Agent æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æäº¤ç•Œé¢  â”‚â”€â”€â”€â–¶â”‚  DefectAgent  â”‚â”€â”€â”€â–¶â”‚  AI Pipeline  â”‚â”€â”€â”€â–¶â”‚  GitHub  â”‚  â”‚
â”‚  â”‚  (å‰ç«¯)   â”‚    â”‚  Controller  â”‚    â”‚  (Worker)     â”‚    â”‚  Integrationâ”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚                                     â”‚                    â”‚      â”‚
â”‚       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚      â”‚
â”‚       â–¼              â–¼                                           â–¼      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æˆªå›¾ä¸Šä¼   â”‚   â”‚  AI åˆå®¡å¼•æ“   â”‚                          â”‚  PR ç®¡ç†  â”‚ â”‚
â”‚  â”‚ (é™„ä»¶)   â”‚   â”‚  (Prompt)    â”‚                          â”‚  Bot     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚                                        â”‚      â”‚
â”‚                        â–¼                                        â–¼      â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                 â”‚  ä»£ç åˆ†æå¼•æ“  â”‚                          â”‚ çŠ¶æ€é€šçŸ¥  â”‚ â”‚
â”‚                 â”‚  (Vision+Code)â”‚                          â”‚ (Webhook)â”‚ â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| Controller | C# .NET 8 | ç¡¬ç¼–ç  appKey: `defect-agent` |
| Worker | BackgroundService | DefectReviewWorker, DefectFixWorker |
| AI Engine | LLM (Chat + Vision + Code) | å¤šæ¨¡å‹åä½œåˆ†æ |
| å­˜å‚¨ | MongoDB | ç¼ºé™·è®°å½•ã€è¯„å®¡ç»“æœã€ä¿®å¤è®°å½• |
| å¤–éƒ¨é›†æˆ | GitHub REST API + Webhooks | PR åˆ›å»ºã€çŠ¶æ€åŒæ­¥ |
| æ¶ˆæ¯ | SSE (Run/Worker æ¨¡å¼) | å®æ—¶è¿›åº¦æ¨é€ |
| é™„ä»¶ | Attachments ç³»ç»Ÿ | æˆªå›¾/æ—¥å¿—æ–‡ä»¶ä¸Šä¼  |

---

## ä¸‰ã€å·¥ä½œæµè®¾è®¡

### 3.1 ä¸»æµç¨‹çŠ¶æ€æœº

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚              ç¼ºé™·ç”Ÿå‘½å‘¨æœŸ                     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  draft    â”‚â”€â”€â”€â–¶â”‚ submitted â”‚â”€â”€â”€â–¶â”‚ reviewing â”‚â”€â”€â”€â–¶â”‚ analyzed  â”‚â”€â”€â”€â–¶â”‚ fixing   â”‚
â”‚  (è‰ç¨¿)   â”‚    â”‚ (å·²æäº¤)   â”‚    â”‚ (AIå®¡æ ¸ä¸­) â”‚    â”‚ (å·²åˆ†æ)   â”‚    â”‚ (ä¿®å¤ä¸­)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                â”‚                              â”‚
                      â”‚                â–¼                              â–¼
                      â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚ rejected  â”‚                   â”‚ pr_createdâ”‚
                      â”‚         â”‚ (å·²é©³å›)   â”‚                   â”‚ (PRå·²åˆ›å»º)â”‚
                      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                                              â”‚
                      â”‚                                              â–¼
                      â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                                        â”‚ merged   â”‚
                      â”‚                                        â”‚ (å·²åˆå¹¶)  â”‚
                      â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                                              â”‚
                      â–¼                                              â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ closed    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ verified â”‚
               â”‚ (å·²å…³é—­)   â”‚                                    â”‚ (å·²éªŒè¯)  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 çŠ¶æ€å®šä¹‰

| çŠ¶æ€ | è¯´æ˜ | è§¦å‘æ¡ä»¶ | å¯è¿ç§»åˆ° |
|------|------|---------|---------|
| `draft` | è‰ç¨¿ï¼Œæœªæäº¤ | ç”¨æˆ·åˆ›å»º | submitted, closed |
| `submitted` | å·²æäº¤ï¼Œç­‰å¾… AI å¤„ç† | ç”¨æˆ·ç‚¹å‡»æäº¤ | reviewing, closed |
| `reviewing` | AI æ­£åœ¨å®¡æ ¸ | Worker å¼€å§‹å¤„ç† | analyzed, rejected |
| `analyzed` | AI åˆ†æå®Œæˆï¼Œç»™å‡ºç»“è®º | AI å®¡æ ¸å®Œæˆ | fixing, closed |
| `rejected` | AI åˆ¤å®šä¸ºæ— æ•ˆ/é‡å¤/æ— æ³•ä¿®å¤ | AI åˆå®¡é©³å› | submitted (ç”³è¯‰), closed |
| `fixing` | AI æ­£åœ¨ç”Ÿæˆä¿®å¤æ–¹æ¡ˆ | ç”¨æˆ·ç¡®è®¤ä¿®å¤ | pr_created |
| `pr_created` | PR å·²åˆ›å»ºï¼Œç­‰å¾… Review | GitHub PR åˆ›å»ºæˆåŠŸ | merged, closed |
| `merged` | PR å·²åˆå¹¶ | GitHub Webhook | verified, closed |
| `verified` | æäº¤è€…ç¡®è®¤å·²ä¿®å¤ | ç”¨æˆ·éªŒè¯ | closed |
| `closed` | ç»ˆæ€ | ä»»æ„é˜¶æ®µå¯å…³é—­ | â€” |

### 3.3 AI å®¡æ ¸æµæ°´çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI å®¡æ ¸ Pipeline                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Step 1: ä¿¡æ¯å®Œæ•´æ€§æ£€æŸ¥                                               â”‚
â”‚  â”œâ”€ æ ‡é¢˜æ˜¯å¦æ¸…æ™°ï¼Ÿ                                                   â”‚
â”‚  â”œâ”€ é‡ç°æ­¥éª¤æ˜¯å¦å®Œæ•´ï¼Ÿ                                                â”‚
â”‚  â”œâ”€ æˆªå›¾æ˜¯å¦æœ‰æ•ˆï¼Ÿ                                                   â”‚
â”‚  â””â”€ å¦‚ä¸å®Œæ•´ â†’ è¿”å›è¡¥å……æ„è§                                          â”‚
â”‚                                                                     â”‚
â”‚  Step 2: é‡å¤æ£€æµ‹                                                    â”‚
â”‚  â”œâ”€ å‘é‡ç›¸ä¼¼åº¦æœç´¢ (ä¸å†å²ç¼ºé™·æ¯”å¯¹)                                    â”‚
â”‚  â”œâ”€ å…³é”®è¯åŒ¹é…                                                      â”‚
â”‚  â””â”€ å¦‚é‡å¤ â†’ æ ‡è®°ä¸ºé‡å¤ï¼Œé“¾æ¥åŸ Issue                                 â”‚
â”‚                                                                     â”‚
â”‚  Step 3: å¤ç°æ€§è¯„ä¼°                                                   â”‚
â”‚  â”œâ”€ ç¯å¢ƒä¿¡æ¯æ˜¯å¦å……åˆ†ï¼Ÿ                                                â”‚
â”‚  â”œâ”€ æ­¥éª¤æ˜¯å¦å¯æ‰§è¡Œï¼Ÿ                                                  â”‚
â”‚  â””â”€ ç»™å‡ºå¤ç°ç½®ä¿¡åº¦ï¼šé«˜/ä¸­/ä½/æ— æ³•åˆ¤æ–­                                   â”‚
â”‚                                                                     â”‚
â”‚  Step 4: å½±å“è¯„ä¼°                                                    â”‚
â”‚  â”œâ”€ å½±å“èŒƒå›´ï¼šæ ¸å¿ƒåŠŸèƒ½/è¾¹ç¼˜åŠŸèƒ½/UIç¾åŒ–                                  â”‚
â”‚  â”œâ”€ ä¼˜å…ˆçº§å»ºè®®ï¼šP0(é˜»å¡)/P1(é‡è¦)/P2(ä¸€èˆ¬)/P3(ä¼˜åŒ–)                    â”‚
â”‚  â””â”€ æ”¹åŠ¨è§„æ¨¡ï¼šå¾®å°/å°/ä¸­/å¤§/é‡æ„                                      â”‚
â”‚                                                                     â”‚
â”‚  Step 5: ä»£ç å®šä½ (Vision + Code Analysis)                           â”‚
â”‚  â”œâ”€ æˆªå›¾ â†’ Vision æ¨¡å‹è¯†åˆ« UI å…ƒç´                                     â”‚
â”‚  â”œâ”€ UI å…ƒç´  â†’ ä»£ç æœç´¢å®šä½ç»„ä»¶                                        â”‚
â”‚  â”œâ”€ ç»„ä»¶ â†’ è¿½è¸ªæ•°æ®æµ/é€»è¾‘é“¾                                          â”‚
â”‚  â””â”€ è¾“å‡ºï¼šå¯ç–‘æ–‡ä»¶åˆ—è¡¨ + è¡Œå· + åˆ†æç†ç”±                               â”‚
â”‚                                                                     â”‚
â”‚  Step 6: ä¿®å¤å»ºè®®                                                    â”‚
â”‚  â”œâ”€ è½»é‡çº§ (å¯è‡ªåŠ¨ä¿®å¤)ï¼šç›´æ¥ç”Ÿæˆ Patch                                â”‚
â”‚  â”œâ”€ ä¸­ç­‰ (éœ€äººå·¥ç¡®è®¤)ï¼šç»™å‡ºä¿®å¤æ–¹æ¡ˆ + ä¼ªä»£ç                             â”‚
â”‚  â””â”€ é‡å¤§ (éœ€è®¨è®º)ï¼šç»™å‡ºåˆ†ææŠ¥å‘Š + é£é™©è¯„ä¼°                              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 æç¤ºè¯é˜¶æ®µè®¾è®¡

| é˜¶æ®µ | Prompt åç§° | è¾“å…¥ | è¾“å‡º |
|------|------------|------|------|
| åˆå®¡ | `defect-triage` | æ ‡é¢˜+æè¿°+æˆªå›¾ | å®Œæ•´æ€§åˆ¤æ–­+é‡å¤æ£€æµ‹ç»“æœ |
| åˆ†æ | `defect-analysis` | ç¼ºé™·è¯¦æƒ…+ä»£ç åº“ä¸Šä¸‹æ–‡ | å®šä½ç»“æœ+å½±å“è¯„ä¼° |
| ä¿®å¤ | `defect-fix` | å®šä½ç»“æœ+ç›¸å…³ä»£ç  | ä¿®å¤ Patch / æ–¹æ¡ˆ |
| éªŒè¯ | `defect-verify` | ä¿®å¤å‰åå¯¹æ¯” | éªŒè¯ç»“è®º |

---

## å››ã€GitHub é›†æˆ

### 4.1 æˆæƒæ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GitHub æˆæƒæ¶æ„                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  æ–¹å¼ 1: GitHub App (æ¨è)                                    â”‚
â”‚  â”œâ”€ å®‰è£…åˆ°ç›®æ ‡ä»“åº“                                            â”‚
â”‚  â”œâ”€ è‡ªåŠ¨è·å–ä»“åº“è¯»å†™æƒé™                                       â”‚
â”‚  â”œâ”€ Webhook è‡ªåŠ¨é…ç½®                                         â”‚
â”‚  â””â”€ æ”¯æŒå¤šä»“åº“ç®¡ç†                                            â”‚
â”‚                                                              â”‚
â”‚  æ–¹å¼ 2: Personal Access Token (ç®€æ˜“)                         â”‚
â”‚  â”œâ”€ ç”¨æˆ·æä¾› PAT                                             â”‚
â”‚  â”œâ”€ ç³»ç»ŸåŠ å¯†å­˜å‚¨                                              â”‚
â”‚  â”œâ”€ é€‚åˆä¸ªäºº/å°å›¢é˜Ÿ                                           â”‚
â”‚  â””â”€ éœ€è¦æ‰‹åŠ¨ç»´æŠ¤                                              â”‚
â”‚                                                              â”‚
â”‚  æ–¹å¼ 3: OAuth App (å›¢é˜Ÿ)                                     â”‚
â”‚  â”œâ”€ ç”¨æˆ· OAuth ç™»å½•æˆæƒ                                       â”‚
â”‚  â”œâ”€ è·å–ç”¨æˆ·çº§åˆ«æƒé™                                           â”‚
â”‚  â””â”€ æ“ä½œä»¥ç”¨æˆ·èº«ä»½æ‰§è¡Œ                                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ä»“åº“é…ç½®

```json
{
  "repoConfig": {
    "owner": "org-name",
    "repo": "repo-name",
    "defaultBranch": "main",
    "prBranchPrefix": "defect-agent/fix-",
    "reviewers": ["dev1", "dev2"],
    "labels": ["bug", "ai-fix"],
    "authMethod": "github-app",        // github-app | pat | oauth
    "installationId": "12345678"
  }
}
```

### 4.3 PR åˆ›å»ºæµç¨‹

```
1. AI ç”Ÿæˆä¿®å¤ Patch
       â†“
2. åˆ›å»ºåˆ†æ”¯: defect-agent/fix-{defectId}-{shortDesc}
       â†“
3. åº”ç”¨ Patch â†’ Commit
       â†“
4. åˆ›å»º PR:
   - Title: [Defect-{id}] {title}
   - Body: ç¼ºé™·æè¿° + AI åˆ†æ + ä¿®å¤è¯´æ˜ + æµ‹è¯•å»ºè®®
   - Labels: bug, ai-fix, priority-{P0-P3}
   - Reviewers: é…ç½®çš„å®¡æ ¸äºº
   - Linked Issue: (å¦‚æœ‰)
       â†“
5. é€šçŸ¥å®¡æ ¸äºº
       â†“
6. Webhook ç›‘å¬åˆå¹¶/å…³é—­äº‹ä»¶ â†’ æ›´æ–°ç¼ºé™·çŠ¶æ€
```

### 4.4 Bug Bot åä½œæ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Bug Bot å·¥ä½œæ¨¡å¼                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  ä¸Šæ¸¸ (Defect Agent):                                      â”‚
â”‚  â”œâ”€ æ¥æ”¶ç¼ºé™·æŠ¥å‘Š                                           â”‚
â”‚  â”œâ”€ AI åˆå®¡é€šè¿‡                                            â”‚
â”‚  â”œâ”€ åˆ†æå®šä½å®Œæˆ                                            â”‚
â”‚  â””â”€ è§¦å‘ä¿®å¤ä»»åŠ¡ â†’ ä¼ é€’ç»™ Bug Bot                           â”‚
â”‚                                                            â”‚
â”‚  ä¸‹æ¸¸ (Bug Bot):                                           â”‚
â”‚  â”œâ”€ æ¥æ”¶ä¿®å¤ä»»åŠ¡ (æ–‡ä»¶åˆ—è¡¨ + åˆ†æç»“è®º)                       â”‚
â”‚  â”œâ”€ æ‹‰å–ä»£ç  + ç†è§£ä¸Šä¸‹æ–‡                                   â”‚
â”‚  â”œâ”€ ç”Ÿæˆä¿®å¤ä»£ç                                             â”‚
â”‚  â”œâ”€ æœ¬åœ°éªŒè¯ (lint + test)                                  â”‚
â”‚  â”œâ”€ åˆ›å»º PR                                                â”‚
â”‚  â””â”€ å›æŠ¥ç»“æœç»™ Defect Agent                                â”‚
â”‚                                                            â”‚
â”‚  è°ƒåº¦ç­–ç•¥:                                                  â”‚
â”‚  â”œâ”€ æœ¬åœ°æ¨¡å¼ï¼šç›´æ¥åœ¨ç³»ç»Ÿå†…æ‰§è¡Œä¿®å¤                            â”‚
â”‚  â”œâ”€ PR æ¨¡å¼ï¼šFork â†’ Branch â†’ PR (å¤–éƒ¨ä»“åº“)                 â”‚
â”‚  â””â”€ Hybridï¼šç®€å•é—®é¢˜æœ¬åœ°ï¼Œå¤æ‚é—®é¢˜ PR                       â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€æ•°æ®æ¨¡å‹

### 5.1 MongoDB é›†åˆè®¾è®¡

| é›†åˆå | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|
| `defect_reports` | ç¼ºé™·æŠ¥å‘Šä¸»è¡¨ | ownerUserId, status, createdAt |
| `defect_reviews` | AI å®¡æ ¸è®°å½• | defectId, phase, createdAt |
| `defect_fixes` | ä¿®å¤è®°å½• | defectId, status |
| `defect_repo_configs` | ä»“åº“é…ç½® | ownerId |
| `defect_github_tokens` | GitHub æˆæƒå‡­æ® (åŠ å¯†) | userId |

### 5.2 æ ¸å¿ƒæ•°æ®æ¨¡å‹

```csharp
/// <summary>
/// ç¼ºé™·æŠ¥å‘Š
/// </summary>
public class DefectReport
{
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; } = null!;

    /// <summary>æäº¤è€… UserId</summary>
    public string OwnerUserId { get; set; } = null!;

    /// <summary>ç¼ºé™·æ ‡é¢˜</summary>
    public string Title { get; set; } = null!;

    /// <summary>ç¼ºé™·æè¿° (Markdown)</summary>
    public string Description { get; set; } = string.Empty;

    /// <summary>é‡ç°æ­¥éª¤</summary>
    public List<string> ReproSteps { get; set; } = new();

    /// <summary>æœŸæœ›è¡Œä¸º</summary>
    public string? ExpectedBehavior { get; set; }

    /// <summary>å®é™…è¡Œä¸º</summary>
    public string? ActualBehavior { get; set; }

    /// <summary>ç¯å¢ƒä¿¡æ¯</summary>
    public DefectEnvironment? Environment { get; set; }

    /// <summary>é™„ä»¶ ID åˆ—è¡¨ï¼ˆæˆªå›¾/æ—¥å¿—ï¼‰</summary>
    public List<string> AttachmentIds { get; set; } = new();

    /// <summary>å½“å‰çŠ¶æ€</summary>
    public DefectStatus Status { get; set; } = DefectStatus.Draft;

    /// <summary>ä¼˜å…ˆçº§ï¼ˆAI è¯„ä¼°ï¼‰</summary>
    public DefectPriority? Priority { get; set; }

    /// <summary>å½±å“èŒƒå›´ï¼ˆAI è¯„ä¼°ï¼‰</summary>
    public DefectImpact? Impact { get; set; }

    /// <summary>AI å¤ç°ç½®ä¿¡åº¦</summary>
    public ReproConfidence? ReproConfidence { get; set; }

    /// <summary>å…³è”ä»“åº“é…ç½® ID</summary>
    public string? RepoConfigId { get; set; }

    /// <summary>å…³è” GitHub Issue ç¼–å·</summary>
    public int? GithubIssueNumber { get; set; }

    /// <summary>å…³è” GitHub PR ç¼–å·</summary>
    public int? GithubPrNumber { get; set; }

    /// <summary>æŒ‡æ´¾çš„å®¡æ ¸äºº UserId</summary>
    public string? AssigneeUserId { get; set; }

    /// <summary>æ ‡ç­¾</summary>
    public List<string> Tags { get; set; } = new();

    /// <summary>é‡å¤ç¼ºé™· IDï¼ˆå¦‚è¢«æ ‡è®°ä¸ºé‡å¤ï¼‰</summary>
    public string? DuplicateOfId { get; set; }

    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
    public DateTime? ClosedAt { get; set; }
}

/// <summary>
/// ç¼ºé™·çŠ¶æ€æšä¸¾
/// </summary>
public enum DefectStatus
{
    Draft,          // è‰ç¨¿
    Submitted,      // å·²æäº¤
    Reviewing,      // AI å®¡æ ¸ä¸­
    Analyzed,       // å·²åˆ†æ
    Rejected,       // å·²é©³å›
    Fixing,         // ä¿®å¤ä¸­
    PrCreated,      // PR å·²åˆ›å»º
    Merged,         // å·²åˆå¹¶
    Verified,       // å·²éªŒè¯
    Closed          // å·²å…³é—­
}

/// <summary>
/// ä¼˜å…ˆçº§
/// </summary>
public enum DefectPriority
{
    P0_Blocker,     // é˜»å¡æ€§é—®é¢˜
    P1_Critical,    // é‡è¦é—®é¢˜
    P2_Normal,      // ä¸€èˆ¬é—®é¢˜
    P3_Minor        // ä¼˜åŒ–å»ºè®®
}

/// <summary>
/// å½±å“èŒƒå›´
/// </summary>
public enum DefectImpact
{
    CoreFunction,   // æ ¸å¿ƒåŠŸèƒ½
    EdgeFunction,   // è¾¹ç¼˜åŠŸèƒ½
    UiCosmetic,     // UI ç¾åŒ–
    Performance,    // æ€§èƒ½é—®é¢˜
    Security        // å®‰å…¨é—®é¢˜
}

/// <summary>
/// å¤ç°ç½®ä¿¡åº¦
/// </summary>
public enum ReproConfidence
{
    High,           // é«˜ï¼ˆæ­¥éª¤æ˜ç¡®ï¼Œç¯å¢ƒæ¸…æ™°ï¼‰
    Medium,         // ä¸­ï¼ˆæ­¥éª¤åŸºæœ¬æ¸…æ¥šï¼‰
    Low,            // ä½ï¼ˆä¿¡æ¯ä¸å®Œæ•´ï¼‰
    Unknown         // æ— æ³•åˆ¤æ–­
}

/// <summary>
/// ç¯å¢ƒä¿¡æ¯
/// </summary>
public class DefectEnvironment
{
    public string? Browser { get; set; }
    public string? Os { get; set; }
    public string? AppVersion { get; set; }
    public string? ScreenResolution { get; set; }
    public Dictionary<string, string>? CustomFields { get; set; }
}

/// <summary>
/// AI å®¡æ ¸è®°å½•
/// </summary>
public class DefectReview
{
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; } = null!;

    public string DefectId { get; set; } = null!;

    /// <summary>å®¡æ ¸é˜¶æ®µ</summary>
    public ReviewPhase Phase { get; set; }

    /// <summary>å®¡æ ¸ç»“è®º</summary>
    public ReviewVerdict Verdict { get; set; }

    /// <summary>AI åˆ†æå†…å®¹ (Markdown)</summary>
    public string Content { get; set; } = string.Empty;

    /// <summary>å®šä½åˆ°çš„æ–‡ä»¶åˆ—è¡¨</summary>
    public List<CodeLocation>? LocatedFiles { get; set; }

    /// <summary>ä¿®å¤å»ºè®®</summary>
    public FixSuggestion? Suggestion { get; set; }

    /// <summary>LLM è¯·æ±‚ ID (ç”¨äºè¿½è¸ª)</summary>
    public string? LlmRequestId { get; set; }

    public DateTime CreatedAt { get; set; }
}

public enum ReviewPhase { Triage, Analysis, Fix, Verify }

public enum ReviewVerdict { Pass, NeedInfo, Duplicate, Invalid, CanAutoFix, NeedManualFix, MajorChange }

/// <summary>
/// ä»£ç å®šä½ç»“æœ
/// </summary>
public class CodeLocation
{
    public string FilePath { get; set; } = null!;
    public int? StartLine { get; set; }
    public int? EndLine { get; set; }
    public string? Reason { get; set; }
    public double Confidence { get; set; }  // 0.0 ~ 1.0
}

/// <summary>
/// ä¿®å¤å»ºè®®
/// </summary>
public class FixSuggestion
{
    public FixLevel Level { get; set; }
    public string? PatchContent { get; set; }        // è½»é‡çº§ï¼šç›´æ¥ Patch
    public string? PseudoCode { get; set; }          // ä¸­ç­‰ï¼šä¼ªä»£ç æ–¹æ¡ˆ
    public string? AnalysisReport { get; set; }      // é‡å¤§ï¼šåˆ†ææŠ¥å‘Š
    public List<string>? AffectedFiles { get; set; }
    public string? RiskAssessment { get; set; }
}

public enum FixLevel { Auto, SemiAuto, Manual }

/// <summary>
/// ä¿®å¤è®°å½•
/// </summary>
public class DefectFix
{
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; } = null!;

    public string DefectId { get; set; } = null!;
    public string? ReviewId { get; set; }

    /// <summary>ä¿®å¤åˆ†æ”¯å</summary>
    public string? BranchName { get; set; }

    /// <summary>PR URL</summary>
    public string? PrUrl { get; set; }

    /// <summary>PR ç¼–å·</summary>
    public int? PrNumber { get; set; }

    /// <summary>ä¿®å¤çŠ¶æ€</summary>
    public FixStatus Status { get; set; }

    /// <summary>Commit SHA</summary>
    public string? CommitSha { get; set; }

    /// <summary>å˜æ›´çš„æ–‡ä»¶åˆ—è¡¨</summary>
    public List<FileChange>? Changes { get; set; }

    public DateTime CreatedAt { get; set; }
    public DateTime? MergedAt { get; set; }
}

public enum FixStatus { Pending, InProgress, PrCreated, Merged, Rejected, Failed }

public class FileChange
{
    public string FilePath { get; set; } = null!;
    public string ChangeType { get; set; } = null!;  // add, modify, delete
    public int LinesAdded { get; set; }
    public int LinesRemoved { get; set; }
}

/// <summary>
/// ä»“åº“é…ç½®
/// </summary>
public class DefectRepoConfig
{
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; } = null!;

    public string OwnerUserId { get; set; } = null!;
    public string RepoOwner { get; set; } = null!;
    public string RepoName { get; set; } = null!;
    public string DefaultBranch { get; set; } = "main";
    public string PrBranchPrefix { get; set; } = "defect-agent/fix-";
    public List<string> DefaultReviewers { get; set; } = new();
    public List<string> DefaultLabels { get; set; } = new() { "bug", "ai-fix" };
    public GitHubAuthMethod AuthMethod { get; set; }
    public string? InstallationId { get; set; }
    public bool IsActive { get; set; } = true;

    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
}

public enum GitHubAuthMethod { GitHubApp, PersonalAccessToken, OAuth }
```

---

## å…­ã€API è®¾è®¡

### 6.1 API ç«¯ç‚¹æ¸…å•

```
POST   /api/defect-agent/defects                    # åˆ›å»ºç¼ºé™·
GET    /api/defect-agent/defects                    # åˆ—è¡¨æŸ¥è¯¢
GET    /api/defect-agent/defects/:id                # è·å–è¯¦æƒ…
PUT    /api/defect-agent/defects/:id                # æ›´æ–°ç¼ºé™·
DELETE /api/defect-agent/defects/:id                # åˆ é™¤è‰ç¨¿

POST   /api/defect-agent/defects/:id/submit         # æäº¤å®¡æ ¸
POST   /api/defect-agent/defects/:id/fix            # è§¦å‘ä¿®å¤
POST   /api/defect-agent/defects/:id/verify         # ç¡®è®¤ä¿®å¤
POST   /api/defect-agent/defects/:id/close          # å…³é—­ç¼ºé™·
POST   /api/defect-agent/defects/:id/reopen         # é‡æ–°æ‰“å¼€/ç”³è¯‰

GET    /api/defect-agent/defects/:id/reviews         # è·å–å®¡æ ¸è®°å½•
GET    /api/defect-agent/defects/:id/fixes           # è·å–ä¿®å¤è®°å½•

POST   /api/defect-agent/defects/:id/runs            # åˆ›å»º AI å¤„ç†ä»»åŠ¡
GET    /api/defect-agent/runs/:runId/stream           # SSE å®æ—¶æµ

POST   /api/defect-agent/repos                       # æ·»åŠ ä»“åº“é…ç½®
GET    /api/defect-agent/repos                       # åˆ—è¡¨ä»“åº“é…ç½®
PUT    /api/defect-agent/repos/:id                   # æ›´æ–°ä»“åº“é…ç½®
DELETE /api/defect-agent/repos/:id                   # åˆ é™¤ä»“åº“é…ç½®

POST   /api/defect-agent/github/webhook              # GitHub Webhook æ¥æ”¶
GET    /api/defect-agent/github/auth-url             # è·å– OAuth æˆæƒ URL
POST   /api/defect-agent/github/callback             # OAuth å›è°ƒ

GET    /api/defect-agent/stats                       # ç»Ÿè®¡æ¦‚è§ˆ
GET    /api/defect-agent/stats/trends                # è¶‹åŠ¿æ•°æ®
```

### 6.2 è¯·æ±‚/å“åº”ç¤ºä¾‹

#### åˆ›å»ºç¼ºé™·

```json
// POST /api/defect-agent/defects
{
  "title": "ç™»å½•é¡µé¢éªŒè¯ç è¾“å…¥æ¡†æ— æ³•èšç„¦",
  "description": "åœ¨ Chrome æµè§ˆå™¨ä¸­ï¼Œç‚¹å‡»éªŒè¯ç è¾“å…¥æ¡†æ—¶å…‰æ ‡ä¸å‡ºç°...",
  "reproSteps": [
    "1. æ‰“å¼€ç™»å½•é¡µé¢",
    "2. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ",
    "3. ç‚¹å‡»éªŒè¯ç è¾“å…¥æ¡†",
    "4. è§‚å¯Ÿï¼šå…‰æ ‡ä¸å‡ºç°ï¼Œæ— æ³•è¾“å…¥"
  ],
  "expectedBehavior": "ç‚¹å‡»åè¾“å…¥æ¡†åº”è·å–ç„¦ç‚¹ï¼Œå…‰æ ‡é—ªçƒ",
  "actualBehavior": "ç‚¹å‡»æ— ååº”ï¼Œè¾“å…¥æ¡†ä¸èšç„¦",
  "environment": {
    "browser": "Chrome 121.0",
    "os": "macOS 14.3",
    "appVersion": "v2.1.0",
    "screenResolution": "2560x1440"
  },
  "attachmentIds": ["att_screenshot_001", "att_console_log_002"],
  "repoConfigId": "repo_config_001",
  "tags": ["login", "input", "focus"]
}
```

#### AI å®¡æ ¸ç»“æœ

```json
// GET /api/defect-agent/defects/:id/reviews
{
  "reviews": [
    {
      "id": "review_001",
      "phase": "Triage",
      "verdict": "Pass",
      "content": "## åˆå®¡ç»“è®º\n\n**ä¿¡æ¯å®Œæ•´æ€§**ï¼šâœ… é€šè¿‡...\n\n**å¤ç°ç½®ä¿¡åº¦**ï¼šé«˜...",
      "createdAt": "2025-01-23T10:00:00Z"
    },
    {
      "id": "review_002",
      "phase": "Analysis",
      "verdict": "CanAutoFix",
      "content": "## ä»£ç åˆ†æ\n\nå®šä½åˆ°é—®é¢˜æºäº...",
      "locatedFiles": [
        {
          "filePath": "src/pages/login/LoginForm.tsx",
          "startLine": 45,
          "endLine": 52,
          "reason": "éªŒè¯ç  Input ç»„ä»¶ç¼ºå°‘ tabIndex å±æ€§",
          "confidence": 0.92
        }
      ],
      "suggestion": {
        "level": "Auto",
        "patchContent": "--- a/src/pages/login/LoginForm.tsx\n+++ b/...",
        "affectedFiles": ["src/pages/login/LoginForm.tsx"],
        "riskAssessment": "ä½é£é™©ï¼šä»…æ·»åŠ  HTML å±æ€§ï¼Œä¸å½±å“é€»è¾‘"
      },
      "createdAt": "2025-01-23T10:01:00Z"
    }
  ]
}
```

---

## ä¸ƒã€å‰ç«¯è®¾è®¡

### 7.1 é¡µé¢ç»“æ„

```
prd-admin/src/pages/defect-agent/
â”œâ”€â”€ index.ts
â”œâ”€â”€ DefectListPage.tsx              # ç¼ºé™·åˆ—è¡¨ï¼ˆçœ‹æ¿/åˆ—è¡¨è§†å›¾ï¼‰
â”œâ”€â”€ DefectDetailPage.tsx            # ç¼ºé™·è¯¦æƒ… + AI å®¡æ ¸æ—¶é—´çº¿
â”œâ”€â”€ DefectSubmitPage.tsx            # æäº¤æ–°ç¼ºé™·ï¼ˆè¡¨å•ï¼‰
â”œâ”€â”€ DefectRepoSettingsPage.tsx      # ä»“åº“é…ç½®ç®¡ç†
â”œâ”€â”€ DefectStatsPage.tsx             # ç»Ÿè®¡çœ‹æ¿
â””â”€â”€ components/
    â”œâ”€â”€ DefectCard.tsx              # ç¼ºé™·å¡ç‰‡ç»„ä»¶
    â”œâ”€â”€ DefectStatusBadge.tsx       # çŠ¶æ€æ ‡ç­¾
    â”œâ”€â”€ DefectTimeline.tsx          # AI å®¡æ ¸æ—¶é—´çº¿
    â”œâ”€â”€ DefectForm.tsx              # ç¼ºé™·æäº¤è¡¨å•
    â”œâ”€â”€ DefectScreenshotUploader.tsx # æˆªå›¾ä¸Šä¼ ç»„ä»¶
    â”œâ”€â”€ DefectCodeLocator.tsx       # ä»£ç å®šä½å±•ç¤º
    â”œâ”€â”€ DefectPrViewer.tsx          # PR é¢„è§ˆç»„ä»¶
    â”œâ”€â”€ DefectKanban.tsx            # çœ‹æ¿è§†å›¾
    â””â”€â”€ DefectFilterBar.tsx         # ç­›é€‰æ 
```

### 7.2 ç•Œé¢å¸ƒå±€

#### åˆ—è¡¨é¡µ (çœ‹æ¿æ¨¡å¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¼ºé™·ç®¡ç† Agent                              [+ æ–°å»ºç¼ºé™·] [ç»Ÿè®¡] [è®¾ç½®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ç­›é€‰: çŠ¶æ€â–¼] [ä¼˜å…ˆçº§â–¼] [æ ‡ç­¾â–¼] [æœç´¢...]                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¾…å®¡æ ¸(3) â”‚ å®¡æ ¸ä¸­(1) â”‚ å·²åˆ†æ(2) â”‚ ä¿®å¤ä¸­(1) â”‚ PR(2)   â”‚ å·²åˆå¹¶(5)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚â”‚ #12    â”‚â”‚ #15    â”‚â”‚â”‚ #10    â”‚â”‚â”‚ #8     â”‚â”‚â”‚ #11    â”‚â”‚â”‚ #7         â”‚ â”‚
â”‚â”‚ P1 ğŸ”´  â”‚â”‚ P2 ğŸŸ¡  â”‚â”‚â”‚ P1 ğŸ”´  â”‚â”‚â”‚ P0 ğŸŸ£  â”‚â”‚â”‚ P2 ğŸŸ¡  â”‚â”‚â”‚ P2 ğŸŸ¡ âœ…   â”‚ â”‚
â”‚â”‚ ç™»å½•å¼‚å¸¸ â”‚â”‚ æ ·å¼é”™ä½ â”‚â”‚â”‚ æ•°æ®ä¸¢å¤± â”‚â”‚â”‚ å´©æºƒBug â”‚â”‚â”‚ APIå¼‚å¸¸ â”‚â”‚â”‚ æ’åºä¿®å¤    â”‚ â”‚
â”‚â”‚ @å¼ ä¸‰  â”‚â”‚ @æå››  â”‚â”‚â”‚ @ç‹äº”  â”‚â”‚â”‚ @èµµå…­  â”‚â”‚â”‚ @é’±ä¸ƒ  â”‚â”‚â”‚ @å­™å…«      â”‚ â”‚
â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚          â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚          â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚â”‚ #13    â”‚â”‚          â”‚â”‚ #9     â”‚â”‚          â”‚â”‚ #14    â”‚â”‚â”‚ #6         â”‚ â”‚
â”‚â”‚ ...    â”‚â”‚          â”‚â”‚ ...    â”‚â”‚          â”‚â”‚ ...    â”‚â”‚â”‚ ...        â”‚ â”‚
â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚          â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚          â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¯¦æƒ…é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† è¿”å›  #12 ç™»å½•é¡µé¢éªŒè¯ç è¾“å…¥æ¡†æ— æ³•èšç„¦         [P1 ğŸ”´] [å·²åˆ†æ]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç¼ºé™·ä¿¡æ¯                         â”‚  â”‚ AI å®¡æ ¸æ—¶é—´çº¿                 â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                 â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ æè¿°ï¼šåœ¨ Chrome æµè§ˆå™¨ä¸­...      â”‚  â”‚ â— 10:00 åˆå®¡é€šè¿‡              â”‚ â”‚
â”‚  â”‚                                 â”‚  â”‚   ä¿¡æ¯å®Œæ•´ï¼Œå¤ç°ç½®ä¿¡åº¦: é«˜     â”‚ â”‚
â”‚  â”‚ é‡ç°æ­¥éª¤ï¼š                       â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ 1. æ‰“å¼€ç™»å½•é¡µé¢                  â”‚  â”‚ â— 10:01 ä»£ç åˆ†æå®Œæˆ          â”‚ â”‚
â”‚  â”‚ 2. è¾“å…¥ç”¨æˆ·åå¯†ç                 â”‚  â”‚   å®šä½: LoginForm.tsx:45-52  â”‚ â”‚
â”‚  â”‚ 3. ç‚¹å‡»éªŒè¯ç è¾“å…¥æ¡†              â”‚  â”‚   ç»“è®º: å¯è‡ªåŠ¨ä¿®å¤            â”‚ â”‚
â”‚  â”‚ 4. å…‰æ ‡ä¸å‡ºç°                    â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚                                 â”‚  â”‚ â—‹ ç­‰å¾…ç¡®è®¤ä¿®å¤...             â”‚ â”‚
â”‚  â”‚ æˆªå›¾ï¼š                           â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ â”‚ ğŸ“· #1   â”‚ â”‚ ğŸ“· #2   â”‚        â”‚  â”‚ [ç¡®è®¤ä¿®å¤] [å…³é—­]            â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚                                 â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ ç¯å¢ƒï¼šChrome 121 / macOS 14.3   â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚                                 â”‚  â”‚                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ ä»£ç å®šä½                                                            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚  ğŸ“ src/pages/login/LoginForm.tsx  (ç½®ä¿¡åº¦: 92%)                    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â”‚ 45 â”‚  <Input                                                â”‚   â”‚
â”‚  â”‚  â”‚ 46 â”‚    type="text"                                         â”‚   â”‚
â”‚  â”‚  â”‚ 47 â”‚    placeholder="è¯·è¾“å…¥éªŒè¯ç "                            â”‚   â”‚
â”‚  â”‚  â”‚ 48 â”‚    // â† ç¼ºå°‘ tabIndex å’Œ autoFocus å¤„ç†                 â”‚   â”‚
â”‚  â”‚  â”‚ 49 â”‚    value={captcha}                                     â”‚   â”‚
â”‚  â”‚  â”‚ 50 â”‚    onChange={handleCaptchaChange}                      â”‚   â”‚
â”‚  â”‚  â”‚ 51 â”‚  />                                                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æäº¤é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æäº¤æ–°ç¼ºé™·                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  æ ‡é¢˜ *                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç®€è¦æè¿°é—®é¢˜ç°è±¡...                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  é—®é¢˜æè¿° *                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ (Markdown ç¼–è¾‘å™¨)                                                 â”‚  â”‚
â”‚  â”‚ è¯¦ç»†æè¿°ä½ é‡åˆ°çš„é—®é¢˜...                                            â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  é‡ç°æ­¥éª¤ *                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. [æ­¥éª¤è¾“å…¥æ¡†]                                        [+ æ·»åŠ ]  â”‚  â”‚
â”‚  â”‚ 2. [æ­¥éª¤è¾“å…¥æ¡†]                                        [- åˆ é™¤]  â”‚  â”‚
â”‚  â”‚ 3. [æ­¥éª¤è¾“å…¥æ¡†]                                        [- åˆ é™¤]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  æˆªå›¾/é™„ä»¶                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“ æ‹–æ‹½ä¸Šä¼ æˆ–ç‚¹å‡»é€‰æ‹©  (æ”¯æŒ: PNG, JPG, GIF, MP4, LOG)           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                                       â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ“·1 â”‚ â”‚ ğŸ“·2 â”‚ â”‚  +  â”‚                                       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  ç¯å¢ƒä¿¡æ¯                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ æµè§ˆå™¨    â”‚  â”‚ æ“ä½œç³»ç»Ÿ   â”‚  â”‚ åº”ç”¨ç‰ˆæœ¬   â”‚  â”‚ åˆ†è¾¨ç‡    â”‚             â”‚
â”‚  â”‚ [è‡ªåŠ¨æ£€æµ‹]â”‚  â”‚ [è‡ªåŠ¨æ£€æµ‹]â”‚  â”‚ [v2.1.0] â”‚  â”‚ [2560x..] â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                        â”‚
â”‚  å…³è”ä»“åº“                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [é€‰æ‹©å·²é…ç½®çš„ä»“åº“ â–¼]                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  æ ‡ç­¾                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [login] [input] [focus] [+ æ·»åŠ æ ‡ç­¾]                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚                                    [ä¿å­˜è‰ç¨¿]  [æäº¤å®¡æ ¸ â†’]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 Store è®¾è®¡ (Zustand)

```typescript
interface DefectAgentStore {
  // åˆ—è¡¨
  defects: DefectReport[];
  loading: boolean;
  filter: DefectFilter;
  viewMode: 'kanban' | 'list';

  // å½“å‰è¯¦æƒ…
  currentDefect: DefectReport | null;
  currentReviews: DefectReview[];
  currentFixes: DefectFix[];

  // å®æ—¶å¤„ç†
  activeRunId: string | null;
  streamEvents: StreamEvent[];

  // Actions
  fetchDefects: () => Promise<void>;
  fetchDefectDetail: (id: string) => Promise<void>;
  createDefect: (input: CreateDefectInput) => Promise<string>;
  submitDefect: (id: string) => Promise<void>;
  triggerFix: (id: string) => Promise<void>;
  verifyFix: (id: string) => Promise<void>;
  closeDefect: (id: string) => Promise<void>;

  // SSE
  subscribeToRun: (runId: string) => void;
  unsubscribeFromRun: () => void;
}
```

---

## å…«ã€AppCaller æ³¨å†Œ

### 8.1 LLM è°ƒç”¨æ ‡è¯†

```csharp
public static class DefectAgent
{
    public const string AppName = "Defect Agent";

    public static class Triage
    {
        [AppCallerMetadata(
            "ç¼ºé™·åˆå®¡",
            "æ£€æŸ¥ä¿¡æ¯å®Œæ•´æ€§ã€é‡å¤æ£€æµ‹ã€å¤ç°æ€§è¯„ä¼°",
            ModelTypes = new[] { ModelTypes.Chat, ModelTypes.Vision },
            Category = "Triage"
        )]
        public const string Review = "defect-agent.triage::chat";

        [AppCallerMetadata(
            "æˆªå›¾åˆ†æ",
            "åˆ†æç¼ºé™·æˆªå›¾ä¸­çš„ UI å…ƒç´ ",
            ModelTypes = new[] { ModelTypes.Vision },
            Category = "Triage"
        )]
        public const string ScreenshotAnalysis = "defect-agent.triage::vision";
    }

    public static class Analysis
    {
        [AppCallerMetadata(
            "ä»£ç å®šä½",
            "æ ¹æ®ç¼ºé™·æè¿°å®šä½ç›¸å…³ä»£ç ",
            ModelTypes = new[] { ModelTypes.Code },
            Category = "Analysis"
        )]
        public const string CodeLocate = "defect-agent.analysis::code";

        [AppCallerMetadata(
            "å½±å“åˆ†æ",
            "è¯„ä¼°ç¼ºé™·å½±å“èŒƒå›´å’Œä¿®å¤ä»£ä»·",
            ModelTypes = new[] { ModelTypes.Chat },
            Category = "Analysis"
        )]
        public const string ImpactAssess = "defect-agent.analysis::chat";
    }

    public static class Fix
    {
        [AppCallerMetadata(
            "ç”Ÿæˆä¿®å¤",
            "ç”Ÿæˆä¿®å¤ä»£ç  Patch",
            ModelTypes = new[] { ModelTypes.Code },
            Category = "Fix"
        )]
        public const string Generate = "defect-agent.fix::code";

        [AppCallerMetadata(
            "ä¿®å¤éªŒè¯",
            "éªŒè¯ä¿®å¤åçš„ä»£ç æ­£ç¡®æ€§",
            ModelTypes = new[] { ModelTypes.Code },
            Category = "Fix"
        )]
        public const string Verify = "defect-agent.fix.verify::code";
    }
}
```

### 8.2 æ¨¡å‹éœ€æ±‚æ€»ç»“

| App Caller Key | è¯´æ˜ | æ¨¡å‹ç±»å‹ |
|---------------|------|---------|
| `defect-agent.triage::chat` | ç¼ºé™·åˆå®¡ | chat |
| `defect-agent.triage::vision` | æˆªå›¾åˆ†æ | vision |
| `defect-agent.analysis::code` | ä»£ç å®šä½ | code |
| `defect-agent.analysis::chat` | å½±å“åˆ†æ | chat |
| `defect-agent.fix::code` | ç”Ÿæˆä¿®å¤ | code |
| `defect-agent.fix.verify::code` | ä¿®å¤éªŒè¯ | code |

---

## ä¹ã€æƒé™è®¾è®¡

### 9.1 æƒé™ç‚¹

```csharp
// AdminPermissionCatalog.cs
public const string DefectAgentUse = "defect-agent.use";
public const string DefectAgentReview = "defect-agent.review";
public const string DefectAgentManage = "defect-agent.manage";
```

### 9.2 æƒé™çŸ©é˜µ

| æ“ä½œ | use | review | manage |
|------|-----|--------|--------|
| æŸ¥çœ‹ç¼ºé™·åˆ—è¡¨ | âœ… | âœ… | âœ… |
| æäº¤ç¼ºé™· | âœ… | âœ… | âœ… |
| æŸ¥çœ‹ AI å®¡æ ¸ç»“æœ | âœ… | âœ… | âœ… |
| è§¦å‘è‡ªåŠ¨ä¿®å¤ | âŒ | âœ… | âœ… |
| åˆå¹¶/æ‹’ç» PR | âŒ | âœ… | âœ… |
| ç®¡ç†ä»“åº“é…ç½® | âŒ | âŒ | âœ… |
| ç®¡ç† GitHub æˆæƒ | âŒ | âŒ | âœ… |
| æŸ¥çœ‹ç»Ÿè®¡æ•°æ® | âŒ | âœ… | âœ… |

### 9.3 èœå•å®šä¹‰

```csharp
// AdminMenuCatalog.cs
new("defect-agent", "/defect-agent", "ç¼ºé™·ç®¡ç† Agent", "AI é©±åŠ¨çš„ç¼ºé™·æ£€æµ‹ä¸ä¿®å¤", "Bug", 85),
```

---

## åã€Worker è®¾è®¡

### 10.1 DefectReviewWorker

```csharp
/// <summary>
/// AI å®¡æ ¸ Workerï¼šæ‰§è¡Œåˆå®¡ â†’ åˆ†æ â†’ å®šä½ Pipeline
/// </summary>
public sealed class DefectReviewWorker : BackgroundService
{
    // é˜Ÿåˆ—ï¼šRunKinds.DefectReview
    // å¤„ç†æµç¨‹ï¼š
    // 1. Dequeue defectId
    // 2. åŠ è½½ç¼ºé™·è¯¦æƒ… + é™„ä»¶
    // 3. Step 1: ä¿¡æ¯å®Œæ•´æ€§ (chat)
    // 4. Step 2: é‡å¤æ£€æµ‹ (embedding ç›¸ä¼¼åº¦)
    // 5. Step 3: æˆªå›¾åˆ†æ (vision)
    // 6. Step 4: ä»£ç å®šä½ (code)
    // 7. Step 5: å½±å“è¯„ä¼° (chat)
    // 8. Step 6: ä¿®å¤å»ºè®®ç”Ÿæˆ (code)
    // 9. å­˜å‚¨ Review è®°å½•
    // 10. æ›´æ–°ç¼ºé™·çŠ¶æ€ â†’ Analyzed / Rejected
    // 11. é€šè¿‡ IRunEventStore å‘é€ SSE äº‹ä»¶
}
```

### 10.2 DefectFixWorker

```csharp
/// <summary>
/// ä¿®å¤ Workerï¼šç”Ÿæˆ Patch â†’ åˆ›å»º PR
/// </summary>
public sealed class DefectFixWorker : BackgroundService
{
    // é˜Ÿåˆ—ï¼šRunKinds.DefectFix
    // å¤„ç†æµç¨‹ï¼š
    // 1. Dequeue defectId
    // 2. åŠ è½½åˆ†æç»“æœ (CodeLocation + FixSuggestion)
    // 3. æ‹‰å–ç›®æ ‡ä»“åº“ä»£ç  (git clone / GitHub API)
    // 4. ç”Ÿæˆä¿®å¤ä»£ç  (code æ¨¡å‹)
    // 5. æœ¬åœ°éªŒè¯ (lint, type check)
    // 6. åˆ›å»ºåˆ†æ”¯ + Commit
    // 7. Push + åˆ›å»º PR (GitHub API)
    // 8. å­˜å‚¨ Fix è®°å½•
    // 9. æ›´æ–°ç¼ºé™·çŠ¶æ€ â†’ PrCreated
    // 10. é€šçŸ¥å®¡æ ¸äºº
}
```

---

## åä¸€ã€åŸºç¡€è®¾æ–½éœ€æ±‚

### 11.1 ä»£ç ç´¢å¼•æœåŠ¡

ä¸ºäº†è®© AI èƒ½å®šä½ä»£ç ï¼Œéœ€è¦ä»£ç åº“ç´¢å¼•åŸºç¡€è®¾æ–½ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ä»£ç ç´¢å¼•åŸºç¡€è®¾æ–½                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ–¹æ¡ˆ A: GitHub API å®æ—¶æŸ¥è¯¢ (MVP)                           â”‚
â”‚  â”œâ”€ ä½¿ç”¨ GitHub Search API æœç´¢ä»£ç                           â”‚
â”‚  â”œâ”€ ä½¿ç”¨ Contents API è¯»å–æ–‡ä»¶                               â”‚
â”‚  â”œâ”€ ä¼˜ç‚¹ï¼šæ— éœ€æœ¬åœ°å­˜å‚¨ï¼Œå®æ—¶æ€§å¥½                              â”‚
â”‚  â””â”€ ç¼ºç‚¹ï¼šAPI é™æµï¼Œå“åº”æ…¢                                   â”‚
â”‚                                                             â”‚
â”‚  æ–¹æ¡ˆ B: æœ¬åœ° Clone + ç´¢å¼• (æ¨è)                            â”‚
â”‚  â”œâ”€ å®šæ—¶ git pull ä¿æŒåŒæ­¥                                   â”‚
â”‚  â”œâ”€ ä½¿ç”¨ tree-sitter è§£æ AST                               â”‚
â”‚  â”œâ”€ æ„å»ºå€’æ’ç´¢å¼• (ç¬¦å·â†’æ–‡ä»¶ä½ç½®)                              â”‚
â”‚  â”œâ”€ ä¼˜ç‚¹ï¼šæŸ¥è¯¢å¿«ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢                                â”‚
â”‚  â””â”€ ç¼ºç‚¹ï¼šéœ€è¦å­˜å‚¨ç©ºé—´å’ŒåŒæ­¥æœºåˆ¶                              â”‚
â”‚                                                             â”‚
â”‚  æ–¹æ¡ˆ C: Embedding + å‘é‡æ•°æ®åº“ (é«˜çº§)                       â”‚
â”‚  â”œâ”€ ä»£ç å— embedding å­˜å…¥å‘é‡åº“                              â”‚
â”‚  â”œâ”€ ç¼ºé™·æè¿° â†’ å‘é‡ç›¸ä¼¼æœç´¢                                  â”‚
â”‚  â”œâ”€ ä¼˜ç‚¹ï¼šè¯­ä¹‰åŒ¹é…å¼º                                         â”‚
â”‚  â””â”€ ç¼ºç‚¹ï¼šå‡†ç¡®æ€§ä¾èµ– embedding è´¨é‡                          â”‚
â”‚                                                             â”‚
â”‚  æ¨èè·¯å¾„: A (MVP) â†’ B (v1.5) â†’ C (v2.0)                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 è°ƒåº¦ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¿®å¤æ‰§è¡Œè°ƒåº¦                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å†³ç­–æ ‘:                                                     â”‚
â”‚                                                             â”‚
â”‚  ä¿®å¤ä»»åŠ¡åˆ°è¾¾                                                â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€ æ”¹åŠ¨ â‰¤ 3 ä¸ªæ–‡ä»¶ ä¸” â‰¤ 20 è¡Œ?                         â”‚
â”‚       â”‚   â””â”€ YES â†’ æœ¬åœ°æ¨¡å¼ (ç³»ç»Ÿå†…ç›´æ¥ç”Ÿæˆ Patch)            â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€ æ”¹åŠ¨ â‰¤ 10 ä¸ªæ–‡ä»¶?                                   â”‚
â”‚       â”‚   â””â”€ YES â†’ PR æ¨¡å¼ (åˆ›å»º Branch + PR)               â”‚
â”‚       â”‚                                                     â”‚
â”‚       â””â”€ æ”¹åŠ¨ > 10 ä¸ªæ–‡ä»¶?                                   â”‚
â”‚           â””â”€ æ ‡è®°ä¸º Manualï¼Œä»…ç»™å‡ºåˆ†ææŠ¥å‘Š                    â”‚
â”‚                                                             â”‚
â”‚  æœ¬åœ°æ¨¡å¼æ‰§è¡Œ:                                               â”‚
â”‚  1. è¯»å–ç›®æ ‡æ–‡ä»¶ (GitHub Contents API)                       â”‚
â”‚  2. LLM ç”Ÿæˆä¿®å¤ä»£ç                                          â”‚
â”‚  3. éªŒè¯ diff åˆç†æ€§                                         â”‚
â”‚  4. é€šè¿‡ GitHub API åˆ›å»º Commit                              â”‚
â”‚  5. åˆ›å»º PR                                                 â”‚
â”‚                                                             â”‚
â”‚  PR æ¨¡å¼æ‰§è¡Œ:                                                â”‚
â”‚  1. Clone ä»“åº“åˆ°ä¸´æ—¶ç›®å½•                                      â”‚
â”‚  2. åˆ›å»ºä¿®å¤åˆ†æ”¯                                              â”‚
â”‚  3. LLM ç”Ÿæˆä¿®å¤ä»£ç                                          â”‚
â”‚  4. æœ¬åœ° lint + test                                         â”‚
â”‚  5. Push + åˆ›å»º PR                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åäºŒã€åä½œå¹³å°é›†æˆ

### 12.1 é€šçŸ¥æœºåˆ¶

| äº‹ä»¶ | é€šçŸ¥å¯¹è±¡ | é€šçŸ¥æ–¹å¼ |
|------|---------|---------|
| ç¼ºé™·æäº¤ | ç®¡ç†å‘˜ | ç³»ç»Ÿé€šçŸ¥ (AdminNotification) |
| AI å®¡æ ¸å®Œæˆ | æäº¤è€… | ç³»ç»Ÿé€šçŸ¥ |
| AI é©³å› | æäº¤è€… | ç³»ç»Ÿé€šçŸ¥ + é©³å›ç†ç”± |
| PR åˆ›å»º | å®¡æ ¸äºº | ç³»ç»Ÿé€šçŸ¥ + GitHub Notification |
| PR åˆå¹¶ | æäº¤è€… | ç³»ç»Ÿé€šçŸ¥ |
| éœ€è¦ä¿¡æ¯è¡¥å…… | æäº¤è€… | ç³»ç»Ÿé€šçŸ¥ |

### 12.2 æŒ‡æ´¾ä¸çŠ¶æ€æµè½¬

```
æäº¤è€…æäº¤ â†’ ç³»ç»Ÿè‡ªåŠ¨æŒ‡æ´¾ (è½®è¯¢/è´Ÿè½½å‡è¡¡) â†’ å®¡æ ¸äººæ”¶åˆ°é€šçŸ¥
                              â†“
              å®¡æ ¸äººå¯ä»¥ï¼šæ¥å— / è½¬æ´¾ / æ‹’ç»
                              â†“
              æ¥å—åè¿›å…¥ AI ä¿®å¤æµç¨‹
                              â†“
              PR åˆ›å»º â†’ å®¡æ ¸äºº Code Review
                              â†“
              åˆå¹¶å â†’ é€šçŸ¥æäº¤è€…éªŒè¯
```

### 12.3 GitHub Webhook äº‹ä»¶å¤„ç†

| GitHub äº‹ä»¶ | ç³»ç»ŸåŠ¨ä½œ |
|------------|---------|
| `pull_request.merged` | æ›´æ–°ç¼ºé™·çŠ¶æ€ä¸º Merged |
| `pull_request.closed` (æœªåˆå¹¶) | æ›´æ–°ä¿®å¤çŠ¶æ€ä¸º Rejected |
| `issue_comment.created` | åŒæ­¥è¯„è®ºåˆ°ç¼ºé™·æ—¶é—´çº¿ |
| `pull_request_review.submitted` | åŒæ­¥ Review çŠ¶æ€ |

---

## åä¸‰ã€Debugger Skill

### 13.1 æ—¥å¿—è§„èŒƒ

```csharp
// Controller å±‚
_logger.LogInformation("[defect-agent] Create defect by {UserId}: {Title}", userId, title);
_logger.LogInformation("[defect-agent] Submit defect {DefectId} for review", defectId);

// Worker å±‚
_logger.LogInformation("[defect-agent:review] Run {RunId} started for defect {DefectId}", runId, defectId);
_logger.LogInformation("[defect-agent:review] Step {Step} completed: {Verdict}", step, verdict);
_logger.LogWarning("[defect-agent:review] Run {RunId} step {Step} timeout, retrying", runId, step);
_logger.LogError(ex, "[defect-agent:fix] PR creation failed for defect {DefectId}", defectId);

// GitHub é›†æˆå±‚
_logger.LogInformation("[defect-agent:github] PR #{PrNumber} created for defect {DefectId}", prNumber, defectId);
_logger.LogInformation("[defect-agent:github] Webhook received: {Event}", eventType);
```

### 13.2 è°ƒè¯•è·¯å¾„

```
é—®é¢˜æ’æŸ¥è·¯å¾„ï¼š

1. ç¼ºé™·æäº¤å¤±è´¥
   â†’ Controller æ—¥å¿— â†’ æƒé™ä¸­é—´ä»¶æ—¥å¿— â†’ MongoDB å†™å…¥æ—¥å¿—

2. AI å®¡æ ¸å¡ä½
   â†’ Worker æ—¥å¿— â†’ RunEventStore äº‹ä»¶ â†’ LLM è¯·æ±‚æ—¥å¿— (llm_request_logs)
   â†’ SmartModelScheduler æ—¥å¿—ï¼ˆæ¨¡å‹å¯ç”¨æ€§ï¼‰

3. PR åˆ›å»ºå¤±è´¥
   â†’ DefectFixWorker æ—¥å¿— â†’ GitHub API å“åº”æ—¥å¿—
   â†’ æ£€æŸ¥ Token æœ‰æ•ˆæ€§ â†’ æ£€æŸ¥ä»“åº“æƒé™

4. Webhook æœªè§¦å‘
   â†’ GitHub Webhook æŠ•é€’è®°å½• â†’ /api/defect-agent/github/webhook æ—¥å¿—
   â†’ Webhook Secret éªŒè¯æ—¥å¿—

5. SSE æ–­è¿
   â†’ RunEventStore äº‹ä»¶åºåˆ— â†’ afterSeq å¯¹æ¯”
   â†’ å®¢æˆ·ç«¯é‡è¿æ—¥å¿—
```

### 13.3 è°ƒè¯•æ£€æŸ¥æ¸…å•

- [ ] æƒé™æ‹’ç»è¿”å› 403 ä¸”æœ‰æ—¥å¿—
- [ ] Worker å•æ¡ä»»åŠ¡å¼‚å¸¸ä¸å½±å“åç»­ä»»åŠ¡å¤„ç†
- [ ] GitHub Token è¿‡æœŸè‡ªåŠ¨æç¤ºç”¨æˆ·é‡æ–°æˆæƒ
- [ ] LLM è°ƒç”¨è¶…æ—¶ (30s) æœ‰åˆç†å›é€€å’Œé‡è¯•
- [ ] å¤§æ–‡ä»¶ (>100KB) æˆªå›¾ä¸Šä¼ æœ‰å¤§å°é™åˆ¶æç¤º
- [ ] å¹¶å‘æäº¤åŒä¸€ç¼ºé™·æœ‰å¹‚ç­‰å¤„ç†
- [ ] Webhook éªŒè¯å¤±è´¥è¿”å› 401 ä¸”è®°å½•æ¥æº IP

---

## åå››ã€æµ‹è¯•æ–¹æ¡ˆ

### 14.1 åç«¯æµ‹è¯•

```
Tests/
â”œâ”€â”€ DefectAgent.Controller.Tests.cs
â”‚   â”œâ”€â”€ CreateDefect_ValidInput_ReturnsCreated
â”‚   â”œâ”€â”€ CreateDefect_MissingTitle_ReturnsBadRequest
â”‚   â”œâ”€â”€ SubmitDefect_DraftStatus_MovesToSubmitted
â”‚   â”œâ”€â”€ SubmitDefect_AlreadySubmitted_ReturnsBadRequest
â”‚   â”œâ”€â”€ TriggerFix_NoReviewPermission_ReturnsForbidden
â”‚   â””â”€â”€ GithubWebhook_InvalidSignature_ReturnsUnauthorized
â”‚
â”œâ”€â”€ DefectAgent.ReviewWorker.Tests.cs
â”‚   â”œâ”€â”€ Process_CompleteInfo_PassesTriage
â”‚   â”œâ”€â”€ Process_IncompleteInfo_ReturnsNeedInfo
â”‚   â”œâ”€â”€ Process_DuplicateDefect_MarksDuplicate
â”‚   â”œâ”€â”€ Process_LlmTimeout_RetriesWithBackoff
â”‚   â””â”€â”€ Process_VisionAnalysis_LocatesFiles
â”‚
â”œâ”€â”€ DefectAgent.FixWorker.Tests.cs
â”‚   â”œâ”€â”€ Process_SimpleFixAutoMode_CreatesPR
â”‚   â”œâ”€â”€ Process_ComplexFix_MarksManual
â”‚   â”œâ”€â”€ Process_GithubApiError_RecordsFailure
â”‚   â””â”€â”€ Process_BranchConflict_ReportsToUser
â”‚
â””â”€â”€ DefectAgent.GithubIntegration.Tests.cs
    â”œâ”€â”€ CreatePR_ValidPatch_ReturnsUrl
    â”œâ”€â”€ HandleWebhook_MergeEvent_UpdatesStatus
    â”œâ”€â”€ RefreshToken_Expired_ThrowsAuthException
    â””â”€â”€ ValidateSignature_ValidPayload_ReturnsTrue
```

### 14.2 å‰ç«¯æµ‹è¯•

```
__tests__/
â”œâ”€â”€ DefectListPage.test.tsx
â”‚   â”œâ”€â”€ renders_kanban_view_by_default
â”‚   â”œâ”€â”€ filters_by_status
â”‚   â”œâ”€â”€ switches_to_list_view
â”‚   â””â”€â”€ shows_empty_state_when_no_defects
â”‚
â”œâ”€â”€ DefectSubmitPage.test.tsx
â”‚   â”œâ”€â”€ validates_required_fields
â”‚   â”œâ”€â”€ uploads_screenshots
â”‚   â”œâ”€â”€ saves_draft
â”‚   â””â”€â”€ submits_for_review
â”‚
â”œâ”€â”€ DefectDetailPage.test.tsx
â”‚   â”œâ”€â”€ shows_timeline
â”‚   â”œâ”€â”€ shows_code_location
â”‚   â”œâ”€â”€ handles_sse_stream
â”‚   â””â”€â”€ triggers_fix_action
â”‚
â”œâ”€â”€ defectAgentStore.test.ts
â”‚   â”œâ”€â”€ creates_defect
â”‚   â”œâ”€â”€ updates_status_on_submit
â”‚   â”œâ”€â”€ handles_sse_events
â”‚   â””â”€â”€ clears_state_on_close
â”‚
â””â”€â”€ defectAgentService.test.ts
    â”œâ”€â”€ calls_correct_endpoints
    â”œâ”€â”€ handles_api_errors
    â””â”€â”€ serializes_environment_info
```

---

## åäº”ã€å¼€å‘é‡Œç¨‹ç¢‘

### Phase 1: MVP (æ ¸å¿ƒé—­ç¯)

- [ ] ç¼ºé™· CRUD + çŠ¶æ€æµè½¬
- [ ] æˆªå›¾ä¸Šä¼ 
- [ ] AI åˆå®¡ (ä¿¡æ¯å®Œæ•´æ€§ + å¤ç°æ€§è¯„ä¼°)
- [ ] åŸºæœ¬çš„ä»£ç å®šä½ (GitHub Search API)
- [ ] ç®€å•ä¿®å¤å»ºè®® (æ–‡æœ¬æŠ¥å‘Š)
- [ ] å‰ç«¯ï¼šæäº¤è¡¨å• + åˆ—è¡¨ + è¯¦æƒ…é¡µ

### Phase 2: GitHub é›†æˆ

- [ ] GitHub App / PAT æˆæƒ
- [ ] è‡ªåŠ¨åˆ›å»º PR
- [ ] Webhook çŠ¶æ€åŒæ­¥
- [ ] PR é¢„è§ˆç»„ä»¶
- [ ] å®¡æ ¸äººæŒ‡æ´¾ä¸é€šçŸ¥

### Phase 3: æ™ºèƒ½å¢å¼º

- [ ] é‡å¤æ£€æµ‹ (Embedding ç›¸ä¼¼åº¦)
- [ ] ä»£ç ç´¢å¼•æœåŠ¡ (æœ¬åœ° Clone + ç´¢å¼•)
- [ ] å¤šæ­¥éª¤ä¿®å¤ (å¤æ‚ Bug)
- [ ] ä¿®å¤éªŒè¯ (è‡ªåŠ¨è¿è¡Œæµ‹è¯•)
- [ ] ç»Ÿè®¡çœ‹æ¿

### Phase 4: åä½œæ·±åŒ–

- [ ] çœ‹æ¿è§†å›¾ (æ‹–æ‹½)
- [ ] å›¢é˜Ÿåä½œ (æŒ‡æ´¾/è½¬æ´¾)
- [ ] è¯„è®ºç³»ç»Ÿ
- [ ] SLA å‘Šè­¦ (è¶…æ—¶æœªå¤„ç†)
- [ ] ä¸å¤–éƒ¨ Issue Tracker é›†æˆ (Jira/Linear)

---

## åå…­ã€é£é™©ä¸çº¦æŸ

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| LLM å¹»è§‰å¯¼è‡´é”™è¯¯å®šä½ | ä¿®å¤æ— æ•ˆä»£ç  | ç½®ä¿¡åº¦é˜ˆå€¼ + äººå·¥ç¡®è®¤ |
| GitHub API é™æµ | æ‰¹é‡æ“ä½œé˜»å¡ | è¯·æ±‚é˜Ÿåˆ— + æŒ‡æ•°é€€é¿ |
| å¤§å‹ä»“åº“ä»£ç é‡å¤§ | åˆ†æè¶…æ—¶ | å¢é‡ç´¢å¼• + èŒƒå›´é™å®š |
| Token æ³„éœ² | å®‰å…¨é£é™© | åŠ å¯†å­˜å‚¨ + æœ€å°æƒé™ + å®šæœŸè½®æ¢ |
| å¹¶å‘ä¿®å¤å†²çª | PR åˆå¹¶å†²çª | ä¸²è¡Œå¤„ç† + å†²çªæ£€æµ‹ |
| AI ä¿®å¤å¼•å…¥æ–° Bug | ä»£ç è´¨é‡ | å¼ºåˆ¶ Review + CI é—¨ç¦ |

---

## åä¸ƒã€å…³é”®å†³ç­–ä¸å›°éš¾ç‚¹æ·±åº¦åˆ†æ

> æœ¬èŠ‚ä»è´¨ç–‘è§†è§’é€ä¸€æ‹†è§£ç³»ç»Ÿä¸­æœ€ä¸ç¡®å®šçš„éƒ¨åˆ†ï¼Œæ˜ç¡®æ¯ä¸ªå†³ç­–çš„ä¸Šä¸‹æ–‡ã€å¤‡é€‰æ–¹æ¡ˆå’Œæ¨èè·¯å¾„ã€‚

---

### 17.1 é—®é¢˜ä¸€ï¼šæäº¤è€…æçš„æ˜¯å“ªä¸ªäº§å“çš„ Bugï¼Ÿ

#### é—®é¢˜æœ¬è´¨

ç¼ºé™·æŠ¥å‘Šä¸æ˜¯å­¤ç«‹çš„â€”â€”å®ƒå¿…é¡»å…³è”åˆ°ä¸€ä¸ª**äº§å“ä¸Šä¸‹æ–‡**ã€‚æ²¡æœ‰è¿™ä¸ªä¸Šä¸‹æ–‡ï¼ŒAI æ— ä»åˆ†æï¼Œä¹Ÿæ— æ³•å®šä½ä»£ç ã€‚

```
"ç™»å½•é¡µéªŒè¯ç ä¸èƒ½ç‚¹"
  â†’ è¿™æ˜¯å“ªä¸ªäº§å“ï¼ŸMapï¼ŸAdminï¼ŸDesktopï¼ŸMobileï¼Ÿ
  â†’ æ˜¯å“ªä¸ªç¯å¢ƒï¼Ÿæµ‹è¯•ç¯å¢ƒï¼Ÿç”Ÿäº§ï¼Ÿ
  â†’ å±äºå“ªä¸ªå­æ¨¡å—ï¼Ÿç”¨æˆ·è®¤è¯ï¼ŸéªŒè¯ç æœåŠ¡ï¼Ÿ
```

#### è´¨ç–‘

1. å¦‚æœä¸ç»´æŠ¤äº§å“åˆ—è¡¨ï¼ŒAI å¦‚ä½•çŸ¥é“å»å“ªä¸ªä»£ç åº“åˆ†æï¼Ÿ
2. é™é»˜åŒ¹é…ï¼ˆAI çŒœï¼‰çš„å‡†ç¡®ç‡èƒ½æœ‰å¤šé«˜ï¼ŸçŒœé”™äº†æ€ä¹ˆåŠï¼Ÿ
3. ä¸åŒå›¢é˜Ÿçš„äº§å“åˆ†ç±»é€»è¾‘ä¸åŒï¼Œå¦‚ä½•é€‚é…ï¼Ÿ

#### è§£å†³æ–¹æ¡ˆï¼šäº§å“ç›®å½• + åˆ†å±‚åŒ¹é…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    äº§å“ç›®å½•ç»“æ„ (Product Catalog)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  å±‚çº§æ¨¡å‹:                                                           â”‚
â”‚                                                                     â”‚
â”‚  äº§å“ç©ºé—´ (Workspace)         â† ä¸€ä¸ªå›¢é˜Ÿ/å…¬å¸çš„é¡¶çº§å®¹å™¨               â”‚
â”‚  â””â”€â”€ äº§å“ (Product)           â† å¤§ç±» (ä½ çš„ "map")                   â”‚
â”‚      â””â”€â”€ æ¨¡å— (Module)        â† å°ç±» (ä½ çš„ "å­åº”ç”¨")                 â”‚
â”‚          â””â”€â”€ å…³è”ä»“åº“ (Repos)  â† 1ä¸ªæ¨¡å—å¯å…³è” N ä¸ªä»“åº“              â”‚
â”‚                                                                     â”‚
â”‚  ç¤ºä¾‹:                                                               â”‚
â”‚                                                                     â”‚
â”‚  PRD Agent Workspace                                                â”‚
â”‚  â”œâ”€â”€ äº§å“: PRD Admin (ç®¡ç†åå°)                                      â”‚
â”‚  â”‚   â”œâ”€â”€ æ¨¡å—: ç”¨æˆ·è®¤è¯        â†’ repo: prd-admin (å‰ç«¯)             â”‚
â”‚  â”‚   â”œâ”€â”€ æ¨¡å—: å¯¹è¯ç³»ç»Ÿ        â†’ repo: prd-api (åç«¯)               â”‚
â”‚  â”‚   â”œâ”€â”€ æ¨¡å—: è§†è§‰åˆ›ä½œ        â†’ repo: prd-admin + prd-api          â”‚
â”‚  â”‚   â””â”€â”€ æ¨¡å—: æ•°æ®ç®¡ç†        â†’ repo: prd-admin                    â”‚
â”‚  â”œâ”€â”€ äº§å“: PRD Desktop (æ¡Œé¢ç«¯)                                      â”‚
â”‚  â”‚   â”œâ”€â”€ æ¨¡å—: æ›´æ–°ç³»ç»Ÿ        â†’ repo: prd-desktop                  â”‚
â”‚  â”‚   â””â”€â”€ æ¨¡å—: æœ¬åœ°å­˜å‚¨        â†’ repo: prd-desktop                  â”‚
â”‚  â””â”€â”€ äº§å“: PRD API (æœåŠ¡ç«¯)                                          â”‚
â”‚      â”œâ”€â”€ æ¨¡å—: LLM è°ƒåº¦        â†’ repo: prd-api                     â”‚
â”‚      â””â”€â”€ æ¨¡å—: æƒé™ç³»ç»Ÿ        â†’ repo: prd-api                     â”‚
â”‚                                                                     â”‚
â”‚  åˆ«çš„å›¢é˜Ÿå¯èƒ½è¿™æ ·:                                                    â”‚
â”‚                                                                     â”‚
â”‚  Map Team Workspace                                                 â”‚
â”‚  â”œâ”€â”€ äº§å“: åœ°å›¾å¼•æ“                                                  â”‚
â”‚  â”‚   â”œâ”€â”€ æ¨¡å—: æ¸²æŸ“å±‚         â†’ repo: map-renderer                 â”‚
â”‚  â”‚   â””â”€â”€ æ¨¡å—: æ•°æ®å±‚         â†’ repo: map-data-service             â”‚
â”‚  â””â”€â”€ äº§å“: å¯¼èˆª APP                                                  â”‚
â”‚      â”œâ”€â”€ æ¨¡å—: è·¯å¾„è§„åˆ’        â†’ repo: nav-routing                  â”‚
â”‚      â””â”€â”€ æ¨¡å—: UI              â†’ repo: nav-app                     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŒ¹é…ç­–ç•¥ï¼šä¸‰çº§é€’è¿›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     äº§å“åŒ¹é…å†³ç­–æ ‘                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Step 1: ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹© (ä¼˜å…ˆçº§æœ€é«˜)                                    â”‚
â”‚  â”œâ”€ æäº¤è¡¨å•æ˜¾ç¤º [äº§å“ â–¼] â†’ [æ¨¡å— â–¼] çº§è”é€‰æ‹©                        â”‚
â”‚  â”œâ”€ å¸¸ç”¨äº§å“ç½®é¡¶ (åŸºäºç”¨æˆ·å†å²æäº¤é¢‘ç‡)                                â”‚
â”‚  â””â”€ å¦‚æœç”¨æˆ·é€‰äº† â†’ ç›´æ¥ä½¿ç”¨ï¼Œè·³åˆ°ä»£ç åº“åŒ¹é…                           â”‚
â”‚                                                                     â”‚
â”‚  Step 2: AI æ™ºèƒ½å»ºè®® (è¾…åŠ©)                                          â”‚
â”‚  â”œâ”€ æˆªå›¾ â†’ Vision è¯†åˆ« UI ç‰¹å¾ â†’ åŒ¹é…äº§å“                            â”‚
â”‚  â”‚   ä¾‹: çœ‹åˆ°åœ°å›¾ç»„ä»¶ â†’ å»ºè®® "åœ°å›¾å¼•æ“"                              â”‚
â”‚  â”‚   ä¾‹: çœ‹åˆ°åå°ç®¡ç†è¡¨æ ¼ â†’ å»ºè®® "PRD Admin"                         â”‚
â”‚  â”œâ”€ æè¿°æ–‡æœ¬ â†’ å…³é”®è¯åŒ¹é…æ¨¡å—                                        â”‚
â”‚  â”‚   ä¾‹: "éªŒè¯ç " â†’ å»ºè®® "ç”¨æˆ·è®¤è¯" æ¨¡å—                             â”‚
â”‚  â”œâ”€ URL/é¡µé¢è·¯å¾„ â†’ ç›´æ¥åŒ¹é…è·¯ç”±                                      â”‚
â”‚  â”‚   ä¾‹: "/visual-agent/..." â†’ å»ºè®® "è§†è§‰åˆ›ä½œ" æ¨¡å—                 â”‚
â”‚  â””â”€ AI å»ºè®®ç½®ä¿¡åº¦ < 0.7 æ—¶ â†’ å¼¹çª—è®©ç”¨æˆ·ç¡®è®¤                          â”‚
â”‚                                                                     â”‚
â”‚  Step 3: é»˜è®¤å›é€€                                                    â”‚
â”‚  â”œâ”€ è¯¥ç”¨æˆ·æœ€å¸¸æäº¤çš„äº§å“                                              â”‚
â”‚  â”œâ”€ æˆ–æ‰€åœ¨å›¢é˜Ÿçš„é»˜è®¤äº§å“                                              â”‚
â”‚  â””â”€ æˆ–æ ‡è®°ä¸º "å¾…åˆ†ç±»" â†’ ç®¡ç†å‘˜/AI åç»­åˆ†ç±»                           â”‚
â”‚                                                                     â”‚
â”‚  æ ¸å¿ƒåŸåˆ™: ç”¨æˆ·æ˜¾å¼é€‰æ‹© > AI å»ºè®®ç¡®è®¤ > æ™ºèƒ½é»˜è®¤                      â”‚
â”‚  ç»ä¸é™é»˜åŒ¹é…åç›´æ¥ä¿®ä»£ç ï¼å¿…é¡»æœ‰äººç±»ç¡®è®¤ç¯èŠ‚ã€‚                        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®æ¨¡å‹è¡¥å……

```csharp
/// <summary>
/// äº§å“ç›®å½•
/// </summary>
public class DefectProduct
{
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; } = null!;

    /// <summary>æ‰€å±å·¥ä½œç©ºé—´</summary>
    public string WorkspaceId { get; set; } = null!;

    /// <summary>äº§å“åç§° (å¤§ç±»)</summary>
    public string Name { get; set; } = null!;

    /// <summary>äº§å“æ ‡è¯† (slug)</summary>
    public string Slug { get; set; } = null!;

    /// <summary>æè¿°</summary>
    public string? Description { get; set; }

    /// <summary>å›¾æ ‡</summary>
    public string? Icon { get; set; }

    /// <summary>æ¨¡å—åˆ—è¡¨</summary>
    public List<DefectModule> Modules { get; set; } = new();

    /// <summary>AI è¯†åˆ«å…³é”®è¯ (ç”¨äºæ™ºèƒ½åŒ¹é…)</summary>
    public List<string> AiKeywords { get; set; } = new();

    /// <summary>AI è¯†åˆ« URL æ¨¡å¼ (æ­£åˆ™)</summary>
    public List<string> UrlPatterns { get; set; } = new();

    public DateTime CreatedAt { get; set; }
}

/// <summary>
/// äº§å“æ¨¡å— (å°ç±»/å­åº”ç”¨)
/// </summary>
public class DefectModule
{
    public string Id { get; set; } = ObjectId.GenerateNewId().ToString();

    /// <summary>æ¨¡å—åç§°</summary>
    public string Name { get; set; } = null!;

    /// <summary>å…³è”çš„ä»“åº“é…ç½® ID åˆ—è¡¨</summary>
    public List<string> RepoConfigIds { get; set; } = new();

    /// <summary>AI è¯†åˆ«å…³é”®è¯</summary>
    public List<string> AiKeywords { get; set; } = new();

    /// <summary>ä»£ç è·¯å¾„å‰ç¼€ (å¸®åŠ© AI ç¼©å°æœç´¢èŒƒå›´)</summary>
    public List<string> CodePathPrefixes { get; set; } = new();

    /// <summary>è´Ÿè´£äºº UserId åˆ—è¡¨</summary>
    public List<string> OwnerUserIds { get; set; } = new();
}
```

#### åˆå§‹åŒ–éœ€æ±‚

ç®¡ç†å‘˜é¦–æ¬¡ä½¿ç”¨éœ€è¦å®Œæˆï¼š
1. åˆ›å»ºäº§å“ç›®å½•ï¼ˆå¤§ç±»ï¼‰
2. å®šä¹‰æ¨¡å—ï¼ˆå°ç±»ï¼‰
3. å…³è”ä»“åº“é…ç½®
4. (å¯é€‰) é…ç½® AI å…³é”®è¯å’Œ URL æ¨¡å¼

---

### 17.2 é—®é¢˜äºŒï¼šå¦‚ä½•åŒ¹é…ä»£ç åº“ï¼Ÿ

#### é—®é¢˜æœ¬è´¨

çŸ¥é“äº†"å“ªä¸ªäº§å“çš„ Bug"ä¹‹åï¼Œè¿˜éœ€è¦çŸ¥é“"å»å“ªä¸ªä»£ç åº“çš„å“ªä¸ªç›®å½•æ‰¾"ã€‚

```
å›°éš¾ç‚¹ï¼š
1. ä¸€ä¸ªäº§å“å¯èƒ½è·¨å¤šä¸ªä»“åº“ (å‰ç«¯ repo + åç«¯ repo + å…±äº«åº“ repo)
2. ä¸€ä¸ª monorepo å¯èƒ½åŒ…å«å¤šä¸ªäº§å“
3. AI éœ€è¦çŸ¥é“æœç´¢èŒƒå›´ï¼Œå¦åˆ™å…¨åº“æ‰«æå¤ªæ…¢
4. ä»£ç åº“åœ¨ä¸æ–­å˜åŒ–ï¼Œç´¢å¼•å¯èƒ½è¿‡æœŸ
```

#### è´¨ç–‘

1. å†™æ­»æ˜ å°„ â†’ æ¯æ¬¡åŠ æ¨¡å—éƒ½è¦æ”¹é…ç½®ï¼Œç»´æŠ¤æˆæœ¬é«˜
2. å…¨æ™ºèƒ½åˆ¤å®š â†’ AI å¯èƒ½æœé”™ repoï¼Œæµªè´¹ token ä¸”ç»“æœä¸å¯é 
3. æœ¬åœ° clone â†’ ç£ç›˜å ç”¨å¤§ï¼ŒåŒæ­¥å»¶è¿Ÿå¯èƒ½å¯¼è‡´åˆ†æè¿‡æœŸä»£ç 

#### è§£å†³æ–¹æ¡ˆï¼šé…ç½®é©±åŠ¨ + æ™ºèƒ½ç¼©çª„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä»£ç åº“åŒ¹é…ç­–ç•¥                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  è¾“å…¥: DefectReport.ProductId + DefectReport.ModuleId                â”‚
â”‚                                                                     â”‚
â”‚  Step 1: ä»äº§å“ç›®å½•è·å–å…³è”ä»“åº“                                       â”‚
â”‚  â”œâ”€ Module.RepoConfigIds â†’ å¯èƒ½æœ‰å¤šä¸ª repo                          â”‚
â”‚  â””â”€ å¦‚æœæ¨¡å—æœªæŒ‡å®š â†’ ä½¿ç”¨äº§å“ä¸‹æ‰€æœ‰æ¨¡å—çš„ repo å¹¶é›†                   â”‚
â”‚                                                                     â”‚
â”‚  Step 2: ç¡®å®šæœç´¢èŒƒå›´ (ç¼©çª„)                                         â”‚
â”‚  â”œâ”€ Module.CodePathPrefixes â†’ é™å®šæœç´¢ç›®å½•                           â”‚
â”‚  â”‚   ä¾‹: ["src/pages/login/", "src/services/auth/"]                 â”‚
â”‚  â”œâ”€ å¦‚æœæ— å‰ç¼€é…ç½® â†’ AI æ ¹æ®ç¼ºé™·ç±»å‹æ¨æ–­                              â”‚
â”‚  â”‚   â”œâ”€ UI Bug â†’ æœç´¢ src/pages/, src/components/                   â”‚
â”‚  â”‚   â”œâ”€ API Bug â†’ æœç´¢ Controllers/, Services/                      â”‚
â”‚  â”‚   â””â”€ æ•°æ® Bug â†’ æœç´¢ Models/, Infrastructure/                    â”‚
â”‚  â””â”€ æˆªå›¾ä¸­çš„ URL è·¯å¾„ â†’ åæ¨å‰ç«¯è·¯ç”± â†’ å®šä½é¡µé¢æ–‡ä»¶                   â”‚
â”‚                                                                     â”‚
â”‚  Step 3: å¤šä»“åº“æœç´¢ä¼˜å…ˆçº§                                            â”‚
â”‚  â”œâ”€ å‰ç«¯ Bug (UI/äº¤äº’) â†’ å…ˆæœå‰ç«¯ repo â†’ å†æœåç«¯                   â”‚
â”‚  â”œâ”€ åç«¯ Bug (API/æ•°æ®) â†’ å…ˆæœåç«¯ repo â†’ å†æœå‰ç«¯                   â”‚
â”‚  â””â”€ åˆ¤æ–­ä¾æ®: ç¼ºé™·æè¿°å…³é”®è¯ + æˆªå›¾å†…å®¹                              â”‚
â”‚                                                                     â”‚
â”‚  Step 4: æœç´¢æ‰§è¡Œ                                                    â”‚
â”‚  â”œâ”€ MVP: GitHub Code Search API (scope: repo + path)                â”‚
â”‚  â”œâ”€ v1.5: æœ¬åœ°ç´¢å¼• (tree-sitter AST + å€’æ’ç´¢å¼•)                     â”‚
â”‚  â””â”€ æœç´¢ç»“æœ â†’ å– Top-N æ–‡ä»¶ â†’ è¯»å–å†…å®¹ â†’ LLM åˆ†æ                  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é…ç½®ç¤ºä¾‹

```json
{
  "product": "PRD Admin",
  "module": "ç”¨æˆ·è®¤è¯",
  "repos": [
    {
      "repoConfigId": "repo_001",
      "repo": "inernoro/prd_agent",
      "pathPrefixes": [
        "prd-admin/src/pages/login/",
        "prd-admin/src/stores/authStore.ts",
        "prd-api/src/PrdAgent.Api/Controllers/Api/AuthController.cs",
        "prd-api/src/PrdAgent.Core/Security/"
      ],
      "role": "monorepo",
      "note": "å‰åç«¯éƒ½åœ¨åŒä¸€ repoï¼Œé€šè¿‡è·¯å¾„åŒºåˆ†"
    }
  ]
}
```

#### æœªè§£å†³çš„é—®é¢˜

| å›°éš¾ | ç°çŠ¶ | ä¸´æ—¶æ–¹æ¡ˆ | é•¿æœŸæ–¹æ¡ˆ |
|------|------|---------|---------|
| monorepo è·¯å¾„å¤æ‚ | æ‰‹åŠ¨é…ç½®å‰ç¼€ | åˆå§‹åŒ–å‘å¯¼ + AI å»ºè®® | è‡ªåŠ¨å­¦ä¹ å¸¸ç”¨è·¯å¾„ |
| å¤š repo æœç´¢ä¼˜å…ˆçº§ | é™æ€è§„åˆ™ | æŒ‰ç¼ºé™·ç±»å‹æ’åº | åŸºäºå†å²å‘½ä¸­ç‡æ’åº |
| ä»£ç ç´¢å¼•è¿‡æœŸ | æ¯æ¬¡å®æ—¶æŸ¥ API | å¯æ¥å—ï¼ˆMVPï¼‰ | Webhook è§¦å‘å¢é‡ç´¢å¼• |
| æ–°å¢æ¨¡å—å¿˜è®°é…ç½® | æœç´¢å…¨ repo | AI æé†’ç®¡ç†å‘˜è¡¥å……é…ç½® | CI æ£€æŸ¥é…ç½®è¦†ç›–ç‡ |

---

### 17.3 é—®é¢˜ä¸‰ï¼šä»£ç åº“çš„ä¿®æ­£å»ºè®®åŒ…å«å“ªäº›ï¼Ÿ

#### é—®é¢˜æœ¬è´¨

"ä¿®å¤å»ºè®®"ä¸æ˜¯ä¸€ä¸ªç®€å•çš„ diffâ€”â€”å®ƒéœ€è¦è®©å¼€å‘è€…èƒ½å¿«é€Ÿåˆ¤æ–­ AI çš„åˆ†ææ˜¯å¦æ­£ç¡®ï¼Œä¿®å¤æ˜¯å¦å®‰å…¨ã€‚

#### è´¨ç–‘

1. åªç»™ Patch å¤Ÿå—ï¼Ÿå¼€å‘è€…å¦‚ä½•åˆ¤æ–­ AI ç†è§£å¯¹äº†ï¼Ÿ
2. ç»™å¤ªå¤šä¿¡æ¯ä¼šä¸ä¼šå™ªå£°å¤ªå¤§ï¼Œåè€Œé™ä½æ•ˆç‡ï¼Ÿ
3. AI çš„"ç½®ä¿¡åº¦"æ˜¯è‡ªè¯„çš„ï¼Œå¯ä¿¡å—ï¼Ÿ

#### è§£å†³æ–¹æ¡ˆï¼šåˆ†å±‚ä¿®å¤å»ºè®®ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¿®å¤å»ºè®®ä¸‰å±‚ç»“æ„                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Layer 1: é—®é¢˜ç†è§£è¯æ˜ (è®©å¼€å‘è€…åˆ¤æ–­ AI æ˜¯å¦ç†è§£å¯¹äº†)                  â”‚
â”‚  â”œâ”€ AI çš„é—®é¢˜å¤è¿° (ç”¨è‡ªå·±çš„è¯æ€»ç»“é—®é¢˜)                                â”‚
â”‚  â”œâ”€ æ ¹å› æ¨æ–­ (ä¸ºä»€ä¹ˆä¼šå‡ºè¿™ä¸ª Bug)                                    â”‚
â”‚  â”œâ”€ å½±å“èŒƒå›´åˆ†æ (ä¿®äº†ä¹‹åè¿˜ä¼šå½±å“å“ªé‡Œ)                                â”‚
â”‚  â””â”€ å¼€å‘è€…çœ‹åˆ°è¿™ä¸€å±‚å°±èƒ½åˆ¤æ–­: AI ç†è§£å¯¹äº†å—ï¼Ÿ                          â”‚
â”‚      â†’ å¦‚æœç†è§£é”™äº† â†’ é©³å›ï¼Œæ ‡æ³¨æ­£ç¡®æ–¹å‘                              â”‚
â”‚      â†’ å¦‚æœç†è§£å¯¹äº† â†’ çœ‹ Layer 2                                     â”‚
â”‚                                                                     â”‚
â”‚  Layer 2: å®šä½è¯æ® (AI ä¸ºä»€ä¹ˆè®¤ä¸ºé—®é¢˜åœ¨è¿™é‡Œ)                          â”‚
â”‚  â”œâ”€ å®šä½çš„æ–‡ä»¶åˆ—è¡¨ + è¡Œå·                                            â”‚
â”‚  â”œâ”€ æ¯ä¸ªæ–‡ä»¶çš„å…³è”ç†ç”± (ä¸æ˜¯éšä¾¿æœåˆ°çš„ï¼Œæ˜¯æœ‰é€»è¾‘é“¾çš„)                   â”‚
â”‚  â”‚   ä¾‹: "æˆªå›¾ä¸­çš„éªŒè¯ç è¾“å…¥æ¡† â†’ è·¯ç”± /login                         â”‚
â”‚  â”‚        â†’ LoginPage.tsx â†’ ç¬¬45è¡Œ CaptchaInput ç»„ä»¶                 â”‚
â”‚  â”‚        â†’ è¯¥ç»„ä»¶ç¼ºå°‘ tabIndex å±æ€§å¯¼è‡´æ— æ³•èšç„¦"                     â”‚
â”‚  â”œâ”€ ä»£ç ç‰‡æ®µå±•ç¤º (é—®é¢˜ä»£ç é«˜äº®)                                      â”‚
â”‚  â””â”€ ç½®ä¿¡åº¦è¯„åˆ† (AI å¯¹è‡ªå·±å®šä½çš„ç¡®ä¿¡ç¨‹åº¦)                              â”‚
â”‚      â†’ ç½®ä¿¡åº¦ > 0.8: æ¨èè‡ªåŠ¨ä¿®å¤                                   â”‚
â”‚      â†’ ç½®ä¿¡åº¦ 0.5-0.8: å»ºè®®äººå·¥ç¡®è®¤åä¿®å¤                            â”‚
â”‚      â†’ ç½®ä¿¡åº¦ < 0.5: ä»…ä½œå‚è€ƒï¼Œéœ€äººå·¥æ’æŸ¥                            â”‚
â”‚                                                                     â”‚
â”‚  Layer 3: ä¿®å¤æ–¹æ¡ˆ (å…·ä½“æ€ä¹ˆæ”¹)                                       â”‚
â”‚  â”œâ”€ æ–¹æ¡ˆç­‰çº§åˆ¤å®š:                                                    â”‚
â”‚  â”‚   â”œâ”€ Auto (è‡ªåŠ¨ä¿®å¤):                                            â”‚
â”‚  â”‚   â”‚   â”œâ”€ å®Œæ•´çš„ unified diff                                     â”‚
â”‚  â”‚   â”‚   â”œâ”€ ä¿®æ”¹åçš„å®Œæ•´æ–‡ä»¶é¢„è§ˆ                                     â”‚
â”‚  â”‚   â”‚   â”œâ”€ å˜æ›´è¯´æ˜ (æ¯å¤„æ”¹åŠ¨çš„ç›®çš„)                                â”‚
â”‚  â”‚   â”‚   â””â”€ å¯èƒ½çš„å‰¯ä½œç”¨è¯´æ˜                                        â”‚
â”‚  â”‚   â”‚                                                              â”‚
â”‚  â”‚   â”œâ”€ SemiAuto (åŠè‡ªåŠ¨):                                          â”‚
â”‚  â”‚   â”‚   â”œâ”€ ä¿®å¤æ€è·¯ (æ­¥éª¤åŒ–)                                       â”‚
â”‚  â”‚   â”‚   â”œâ”€ å…³é”®ä»£ç å»ºè®® (éå®Œæ•´ diff)                               â”‚
â”‚  â”‚   â”‚   â”œâ”€ éœ€è¦å¼€å‘è€…ç¡®è®¤çš„å†³ç­–ç‚¹                                   â”‚
â”‚  â”‚   â”‚   â””â”€ å¤‡é€‰æ–¹æ¡ˆå¯¹æ¯”                                            â”‚
â”‚  â”‚   â”‚                                                              â”‚
â”‚  â”‚   â””â”€ Manual (äººå·¥):                                              â”‚
â”‚  â”‚       â”œâ”€ é—®é¢˜åˆ†ææŠ¥å‘Š                                            â”‚
â”‚  â”‚       â”œâ”€ å¯èƒ½çš„ä¿®å¤æ–¹å‘ (2-3 ä¸ª)                                  â”‚
â”‚  â”‚       â”œâ”€ é£é™©è¯„ä¼°                                                â”‚
â”‚  â”‚       â””â”€ éœ€è¦è®¨è®ºçš„æ¶æ„å†³ç­–                                      â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”œâ”€ æµ‹è¯•å»ºè®®:                                                       â”‚
â”‚  â”‚   â”œâ”€ åº”è¯¥æ·»åŠ /ä¿®æ”¹çš„æµ‹è¯•ç”¨ä¾‹                                      â”‚
â”‚  â”‚   â”œâ”€ æ‰‹åŠ¨éªŒè¯æ­¥éª¤                                                â”‚
â”‚  â”‚   â””â”€ å›å½’é£é™©ç‚¹                                                  â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ PR ä¿¡æ¯ (å¦‚æœæ˜¯ Auto/SemiAuto):                                 â”‚
â”‚      â”œâ”€ å»ºè®®çš„ commit message                                       â”‚
â”‚      â”œâ”€ å»ºè®®çš„ PR title + description                               â”‚
â”‚      â””â”€ å»ºè®®çš„ reviewer                                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä¿®å¤æ–¹æ¡ˆåˆ¤å®šè§„åˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¿®å¤ç­‰çº§åˆ¤å®šå†³ç­–æ ‘                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  AI åˆ†æå®Œæˆå:                                                   â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€ å®šä½ç½®ä¿¡åº¦ â‰¥ 0.85?                                      â”‚
â”‚       â”‚   â””â”€ NO â†’ Manual (ä»…æŠ¥å‘Š)                               â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€ æ”¹åŠ¨ â‰¤ 1 ä¸ªæ–‡ä»¶ ä¸” â‰¤ 10 è¡Œ?                             â”‚
â”‚       â”‚   â””â”€ YES â†’ Auto (å¯è‡ªåŠ¨ä¿®å¤)                             â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€ æ”¹åŠ¨ â‰¤ 5 ä¸ªæ–‡ä»¶ ä¸” æ—  API æ¥å£å˜æ›´?                      â”‚
â”‚       â”‚   â””â”€ YES â†’ SemiAuto (åŠè‡ªåŠ¨)                             â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€ æ¶‰åŠæ•°æ®åº“ Schema å˜æ›´?                                  â”‚
â”‚       â”‚   â””â”€ YES â†’ Manual (éœ€è®¨è®º)                               â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€ æ¶‰åŠå®‰å…¨ç›¸å…³ä»£ç  (auth, crypto, permission)?             â”‚
â”‚       â”‚   â””â”€ YES â†’ Manual (éœ€ä¸“å®¶å®¡æ ¸)                           â”‚
â”‚       â”‚                                                          â”‚
â”‚       â””â”€ å…¶ä»– â†’ SemiAuto                                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 17.4 é—®é¢˜å››ï¼šä»£ç åº“åŒ¹é…å»ºè®®æ˜¯è°å†³å®šçš„ï¼Ÿ

#### é—®é¢˜æœ¬è´¨

æ•´ä¸ªæµç¨‹ä¸­æœ‰å¤šä¸ª"å†³ç­–ç‚¹"ï¼Œæ¯ä¸ªå†³ç­–ç‚¹çš„æƒå½’å±ä¸åŒï¼š

```
è°æ¥å†³å®šè¿™äº›é—®é¢˜ï¼Ÿ
1. è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆ Bugï¼Ÿ     â†’ AI åˆåˆ¤ + æäº¤è€…å¯ç”³è¯‰
2. Bug å±äºå“ªä¸ªäº§å“/æ¨¡å—ï¼Ÿ    â†’ æäº¤è€…é€‰æ‹© + AI å»ºè®®
3. å»å“ªä¸ªä»£ç åº“æ‰¾ï¼Ÿ           â†’ ç³»ç»Ÿé…ç½® (äº§å“â†’ä»“åº“æ˜ å°„)
4. é—®é¢˜ä»£ç åœ¨å“ªä¸ªæ–‡ä»¶ï¼Ÿ       â†’ AI åˆ†æ (å¼€å‘è€…ç¡®è®¤)
5. ç”¨ä»€ä¹ˆæ–¹å¼ä¿®ï¼Ÿ            â†’ AI åˆ¤å®šç­‰çº§ (å¼€å‘è€…å¯å‡é™çº§)
6. ä¿®å¤ä»£ç æ˜¯å¦æ­£ç¡®ï¼Ÿ         â†’ å¼€å‘è€… Code Review
7. æ˜¯å¦åˆå¹¶åˆ°ä¸»åˆ†æ”¯ï¼Ÿ         â†’ å¼€å‘è€…æœ€ç»ˆå†³ç­–
```

#### å†³ç­–æƒè´£çŸ©é˜µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å†³ç­–æƒè´£çŸ©é˜µ                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å†³ç­–ç‚¹             â”‚ æäº¤è€…    â”‚ AI       â”‚ å¼€å‘è€…    â”‚ ç³»ç»Ÿé…ç½®        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‰æ‹©äº§å“/æ¨¡å—      â”‚ âœ… ä¸»å¯¼   â”‚ ğŸ” å»ºè®®  â”‚          â”‚ ğŸ“‹ æä¾›é€‰é¡¹     â”‚
â”‚ å…³è”ä»“åº“          â”‚          â”‚ ğŸ” å»ºè®®  â”‚          â”‚ âœ… é…ç½®å†³å®š      â”‚
â”‚ æ˜¯å¦æœ‰æ•ˆ Bug      â”‚ ğŸ“ æä¾›ä¿¡æ¯â”‚ âœ… åˆ¤å®š  â”‚ âš–ï¸ ä»²è£  â”‚                 â”‚
â”‚ å®šä½é—®é¢˜ä»£ç       â”‚          â”‚ âœ… åˆ†æ  â”‚ ğŸ‘ï¸ ç¡®è®¤  â”‚ ğŸ“‹ ç¼©çª„èŒƒå›´     â”‚
â”‚ ä¿®å¤ç­‰çº§ (Auto?)  â”‚          â”‚ âœ… åˆ¤å®š  â”‚ â¬†ï¸â¬‡ï¸ è°ƒæ•´ â”‚                 â”‚
â”‚ ä¿®å¤ä»£ç å†…å®¹      â”‚          â”‚ âœ… ç”Ÿæˆ  â”‚ âœ… å®¡æ ¸   â”‚                 â”‚
â”‚ æ˜¯å¦åˆ›å»º PR       â”‚          â”‚ ğŸ”„ æ‰§è¡Œ  â”‚ âœ… è§¦å‘   â”‚                 â”‚
â”‚ æ˜¯å¦åˆå¹¶ PR       â”‚          â”‚          â”‚ âœ… æœ€ç»ˆ   â”‚                 â”‚
â”‚ éªŒè¯ä¿®å¤æ˜¯å¦ç”Ÿæ•ˆ   â”‚ âœ… ç¡®è®¤   â”‚ ğŸ” è¾…åŠ©  â”‚          â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  å›¾ä¾‹: âœ… ä¸»è¦å†³ç­–è€…  ğŸ” å»ºè®®/è¾…åŠ©  ğŸ“‹ æä¾›ä¿¡æ¯  âš–ï¸ ä»²è£              â”‚
â”‚        â¬†ï¸â¬‡ï¸ å¯è°ƒæ•´   ğŸ”„ è‡ªåŠ¨æ‰§è¡Œ   ğŸ‘ï¸ ç¡®è®¤/å¦å†³                       â”‚
â”‚                                                                        â”‚
â”‚  æ ¸å¿ƒåŸåˆ™:                                                              â”‚
â”‚  1. AI ä¸èƒ½ç‹¬è‡ªå†³å®šä¿®æ”¹ä»£ç å¹¶åˆå¹¶â€”â€”äººç±»å¿…é¡»åœ¨"ä¿®å¤ä»£ç "åæœ‰å®¡æ ¸æƒ        â”‚
â”‚  2. æäº¤è€…ä¸éœ€è¦æ‡‚ä»£ç ï¼Œä½†éœ€è¦æ˜ç¡®æè¿°é—®é¢˜                               â”‚
â”‚  3. å¼€å‘è€…æ˜¯æœ€ç»ˆé—¨æ§›ï¼Œä»»ä½•ä»£ç å˜æ›´å¿…é¡»ç»è¿‡ Code Review                    â”‚
â”‚  4. ç³»ç»Ÿé…ç½®æ˜¯åŸºç¡€è®¾æ–½ï¼Œå‡å°‘é‡å¤äººå·¥å†³ç­–                                  â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### äº‰è®®åœºæ™¯å¤„ç†

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| AI åˆ¤å®šæ— æ•ˆ but æäº¤è€…ä¸è®¤åŒ | æäº¤è€…å¯"ç”³è¯‰" â†’ æ ‡è®°äº‰è®® â†’ ç®¡ç†å‘˜ä»²è£ |
| AI å®šä½äº†æ–‡ä»¶ but å¼€å‘è€…è®¤ä¸ºä¸å¯¹ | å¼€å‘è€…æ ‡æ³¨æ­£ç¡®æ–‡ä»¶ â†’ åé¦ˆç»™ AI å­¦ä¹  |
| AI è¯´èƒ½è‡ªåŠ¨ä¿® but å¼€å‘è€…è®¤ä¸ºé£é™©é«˜ | å¼€å‘è€…å¯å‡çº§ä¸º Manual â†’ æ‰‹åŠ¨å¤„ç† |
| å¤šä¸ªå¼€å‘è€…å¯¹ä¿®å¤æ–¹æ¡ˆæœ‰åˆ†æ­§ | èµ° PR Review æµç¨‹ â†’ GitHub ä¸Šè®¨è®º |
| AI ä¿®å¤é€šè¿‡äº† CI but å¼€å‘è€…æ‹’ç»åˆå¹¶ | æ ‡è®°åŸå›  â†’ å…³é—­ PR â†’ æ›´æ–°ç¼ºé™·çŠ¶æ€ |

---

### 17.5 é—®é¢˜äº”ï¼šä»£ç æ‹‰å–ç­–ç•¥ä¸ GitHub æƒé™

#### é—®é¢˜æœ¬è´¨

è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­**ä¸ç¡®å®šæ€§æœ€é«˜**çš„éƒ¨åˆ†ã€‚GitHub æˆæƒå’Œä»£ç è®¿é—®æ¶‰åŠå¤šä¸ªå±‚é¢çš„é™åˆ¶ã€‚

#### è´¨ç–‘ï¼šå“ªäº›ç¯èŠ‚å¯èƒ½å¤±è´¥ï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GitHub äº¤äº’å…¨é“¾è·¯é£é™©ç‚¹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  1. æˆæƒè·å–é˜¶æ®µ                                                     â”‚
â”‚  â”œâ”€ â“ ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å®‰è£… GitHub App åˆ° org?                         â”‚
â”‚  â”‚   â†’ å¾ˆå¤š org éœ€è¦ org admin æ‰¹å‡† App å®‰è£…                        â”‚
â”‚  â”‚   â†’ è§£å†³: PAT ä½œä¸ºå¤‡é€‰ (ä¸ªäººæƒé™å³å¯)                             â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”œâ”€ â“ PAT çš„ scope æ˜¯å¦è¶³å¤Ÿï¼Ÿ                                      â”‚
â”‚  â”‚   â†’ éœ€è¦: repo (è¯»å†™), pull_request (åˆ›å»ºPR)                     â”‚
â”‚  â”‚   â†’ Fine-grained PAT å¯ç²¾ç¡®åˆ°ç‰¹å®š repo                           â”‚
â”‚  â”‚   â†’ è§£å†³: é¦–æ¬¡é…ç½®æ—¶éªŒè¯ scope æ˜¯å¦æ»¡è¶³                           â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ â“ SSO ç»„ç»‡æ˜¯å¦é˜»æ­¢ PATï¼Ÿ                                       â”‚
â”‚      â†’ å¯ç”¨ SAML SSO çš„ org éœ€è¦ PAT é¢å¤–æˆæƒ                       â”‚
â”‚      â†’ è§£å†³: å¼•å¯¼ç”¨æˆ·åˆ° org è®¾ç½®é¡µé¢å¯ç”¨ PAT                         â”‚
â”‚                                                                     â”‚
â”‚  2. ä»£ç è¯»å–é˜¶æ®µ                                                     â”‚
â”‚  â”œâ”€ â“ ä»“åº“æ˜¯å¦ä¸º Privateï¼Ÿ                                         â”‚
â”‚  â”‚   â†’ Public repo: æ— éœ€é¢å¤–æƒé™                                    â”‚
â”‚  â”‚   â†’ Private repo: éœ€è¦ repo scope + æˆå‘˜èº«ä»½                     â”‚
â”‚  â”‚   â†’ è§£å†³: é…ç½®æ—¶éªŒè¯ä»“åº“å¯è®¿é—®æ€§                                  â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”œâ”€ â“ GitHub API é™æµ?                                             â”‚
â”‚  â”‚   â†’ è®¤è¯ç”¨æˆ·: 5000 req/hr                                        â”‚
â”‚  â”‚   â†’ Search API: 30 req/min (æ›´ä¸¥æ ¼!)                             â”‚
â”‚  â”‚   â†’ Contents API: å•æ–‡ä»¶ â‰¤ 100MB                                 â”‚
â”‚  â”‚   â†’ è§£å†³: è¯·æ±‚é˜Ÿåˆ— + æŒ‡æ•°é€€é¿ + æœ¬åœ°ç¼“å­˜                          â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”œâ”€ â“ å¤§ä»“åº“æ–‡ä»¶æ ‘å¤ªæ·±ï¼Ÿ                                            â”‚
â”‚  â”‚   â†’ Git Trees API å•æ¬¡æœ€å¤šè¿”å› 100,000 entries (æˆªæ–­)             â”‚
â”‚  â”‚   â†’ è§£å†³: ä½¿ç”¨ pathPrefixes ç¼©çª„èŒƒå›´ï¼Œä¸å…¨é‡éå†                   â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ â“ äºŒè¿›åˆ¶æ–‡ä»¶/å¤§æ–‡ä»¶ï¼Ÿ                                           â”‚
â”‚      â†’ Contents API å¯¹ base64 å¤§æ–‡ä»¶è¶…æ—¶                             â”‚
â”‚      â†’ è§£å†³: è·³è¿‡éæ–‡æœ¬æ–‡ä»¶ (é€šè¿‡ .gitattributes åˆ¤æ–­)               â”‚
â”‚                                                                     â”‚
â”‚  3. ä»£ç ä¿®æ”¹/PR åˆ›å»ºé˜¶æ®µ                                             â”‚
â”‚  â”œâ”€ â“ ç›®æ ‡åˆ†æ”¯æœ‰ Branch Protection?                                 â”‚
â”‚  â”‚   â†’ å¯èƒ½è¦æ±‚: review approval, status checks pass, signed commitsâ”‚
â”‚  â”‚   â†’ è§£å†³: åˆ›å»º feature branch (ä¸ç›´æ¥ push main)                 â”‚
â”‚  â”‚          PR èµ°æ­£å¸¸ review æµç¨‹                                    â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”œâ”€ â“ éœ€è¦ Signed Commits?                                         â”‚
â”‚  â”‚   â†’ æŸäº› org è¦æ±‚ GPG/SSH signed commits                         â”‚
â”‚  â”‚   â†’ è§£å†³: GitHub App çš„ commit è‡ªå¸¦ verified æ ‡è®°                 â”‚
â”‚  â”‚          PAT æ–¹å¼éœ€é…ç½® GPG key (å¤æ‚åº¦é«˜)                        â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”œâ”€ â“ CI/CD æ£€æŸ¥æœªé€šè¿‡?                                            â”‚
â”‚  â”‚   â†’ PR åˆ›å»ºå CI å¯èƒ½å¤±è´¥ (lint/test/build)                      â”‚
â”‚  â”‚   â†’ è§£å†³: æœ¬åœ°é¢„æ£€ (å¦‚æœæ˜¯ clone æ¨¡å¼)                            â”‚
â”‚  â”‚          æˆ–æ¥å— CI å¤±è´¥ â†’ é€šçŸ¥å¼€å‘è€…ä»‹å…¥                          â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”œâ”€ â“ åˆ†æ”¯åå†²çª?                                                  â”‚
â”‚  â”‚   â†’ defect-agent/fix-123 å·²å­˜åœ¨                                  â”‚
â”‚  â”‚   â†’ è§£å†³: åŠ æ—¶é—´æˆ³åç¼€ defect-agent/fix-123-{timestamp}          â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ â“ PR åˆ›å»ºæƒé™ä¸è¶³?                                             â”‚
â”‚      â†’ Fork æ¨¡å¼ vs åŒ repo branch æ¨¡å¼                             â”‚
â”‚      â†’ å¤–éƒ¨è´¡çŒ®è€…åªèƒ½ Fork â†’ PR                                     â”‚
â”‚      â†’ è§£å†³: æ£€æµ‹æƒé™çº§åˆ« â†’ é€‰æ‹©åˆé€‚æ¨¡å¼                             â”‚
â”‚                                                                     â”‚
â”‚  4. Webhook é˜¶æ®µ                                                    â”‚
â”‚  â”œâ”€ â“ Webhook æŠ•é€’å¤±è´¥?                                            â”‚
â”‚  â”‚   â†’ GitHub é‡è¯• 3 æ¬¡ (10s, 60s, 360s)                            â”‚
â”‚  â”‚   â†’ ä¹‹åæ”¾å¼ƒ                                                     â”‚
â”‚  â”‚   â†’ è§£å†³: å®šæ—¶è½®è¯¢ä½œä¸ºå…œåº• (æ¯ 5 åˆ†é’ŸæŸ¥ä¸€æ¬¡ PR çŠ¶æ€)              â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”œâ”€ â“ Webhook Secret æ³„éœ²?                                         â”‚
â”‚  â”‚   â†’ æ”»å‡»è€…ä¼ªé€  webhook æ”¹å˜ç¼ºé™·çŠ¶æ€                               â”‚
â”‚  â”‚   â†’ è§£å†³: HMAC-SHA256 ç­¾åéªŒè¯ + IP ç™½åå•                       â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ â“ ç³»ç»Ÿé‡å¯æœŸé—´ä¸¢å¤± Webhook?                                    â”‚
â”‚      â†’ è§£å†³: å¯åŠ¨æ—¶ "å¯¹è´¦" (æ¯”å¯¹æ‰€æœ‰ PrCreated çŠ¶æ€çš„ç¼ºé™· PR)        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä»£ç æ‹‰å–ç­–ç•¥å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä»£ç æ‹‰å–ç­–ç•¥å†³ç­–çŸ©é˜µ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­–ç•¥        â”‚ GitHub API æ¨¡å¼   â”‚ Shallow Clone    â”‚ Full Clone       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è·å–æ–¹å¼    â”‚ REST API æŒ‰éœ€è¯»   â”‚ git clone --depth=1â”‚ git clone      â”‚
â”‚ ç£ç›˜å ç”¨    â”‚ 0 (æ— æœ¬åœ°å­˜å‚¨)    â”‚ å° (ä»…æœ€æ–°å¿«ç…§)   â”‚ å¤§ (å®Œæ•´å†å²)    â”‚
â”‚ è¯»å–é€Ÿåº¦    â”‚ æ…¢ (æ¯ä¸ªæ–‡ä»¶1è¯·æ±‚)â”‚ å¿« (æœ¬åœ°æ–‡ä»¶)     â”‚ å¿«              â”‚
â”‚ ä¿®æ”¹èƒ½åŠ›    â”‚ Contents API å†™  â”‚ commit + push    â”‚ commit + push   â”‚
â”‚ é™åˆ¶        â”‚ é™æµä¸¥æ ¼          â”‚ æ—  git log       â”‚ æ— é™åˆ¶          â”‚
â”‚ é€‚ç”¨åœºæ™¯    â”‚ è¯» â‰¤ 10 ä¸ªæ–‡ä»¶   â”‚ ç”Ÿæˆ Patch       â”‚ è¿è¡Œæµ‹è¯•/lint   â”‚
â”‚ MVP æ¨è    â”‚ âœ… ä¼˜å…ˆä½¿ç”¨       â”‚ âœ… ä¿®å¤æ—¶ç”¨       â”‚ âŒ æš‚ä¸éœ€è¦     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  æ¨èç­–ç•¥: åˆ†æé˜¶æ®µç”¨ API æ¨¡å¼ï¼Œä¿®å¤é˜¶æ®µç”¨ Shallow Clone             â”‚
â”‚                                                                      â”‚
â”‚  å®Œæ•´æµç¨‹:                                                           â”‚
â”‚  1. ä»£ç å®šä½: GitHub Search API + Contents API (åªè¯»å‡ ä¸ªæ–‡ä»¶)        â”‚
â”‚  2. ç”Ÿæˆä¿®å¤: LLM åŸºäºè¯»å–çš„ä»£ç ç”Ÿæˆ diff                            â”‚
â”‚  3. åº”ç”¨ä¿®å¤:                                                        â”‚
â”‚     â”œâ”€ ç®€å• (â‰¤ 3 æ–‡ä»¶): GitHub Contents API ç›´æ¥ commit             â”‚
â”‚     â””â”€ å¤æ‚ (> 3 æ–‡ä»¶): shallow clone â†’ apply diff â†’ push          â”‚
â”‚  4. åˆ›å»º PR: GitHub Pull Requests API                               â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### GitHub Token å®‰å…¨å­˜å‚¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Token å®‰å…¨æ–¹æ¡ˆ                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  å­˜å‚¨:                                                               â”‚
â”‚  â”œâ”€ AES-256-GCM åŠ å¯†å­˜å‚¨åˆ° MongoDB (defect_github_tokens)           â”‚
â”‚  â”œâ”€ åŠ å¯†å¯†é’¥ä»ç¯å¢ƒå˜é‡è¯»å– (ä¸å…¥åº“)                                   â”‚
â”‚  â”œâ”€ æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ Token (ä¸å…±äº«)                                      â”‚
â”‚  â””â”€ Token åªåœ¨ Worker å†…è§£å¯†ä½¿ç”¨ï¼Œä¸ç»è¿‡ Controller å±‚               â”‚
â”‚                                                                     â”‚
â”‚  éªŒè¯:                                                               â”‚
â”‚  â”œâ”€ é¦–æ¬¡é…ç½®: è°ƒç”¨ GET /user éªŒè¯ Token æœ‰æ•ˆ                        â”‚
â”‚  â”œâ”€ é¦–æ¬¡é…ç½®: è°ƒç”¨ GET /repos/:owner/:repo éªŒè¯ä»“åº“æƒé™              â”‚
â”‚  â”œâ”€ ä½¿ç”¨å‰: æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸ (GitHub App Token 1å°æ—¶è¿‡æœŸ)         â”‚
â”‚  â””â”€ ä½¿ç”¨ä¸­: 401 å“åº” â†’ æ ‡è®° Token å¤±æ•ˆ â†’ é€šçŸ¥ç”¨æˆ·é‡æ–°æˆæƒ            â”‚
â”‚                                                                     â”‚
â”‚  æœ€å°æƒé™:                                                           â”‚
â”‚  â”œâ”€ GitHub App: ä»…è¯·æ±‚ contents:write + pull_requests:write          â”‚
â”‚  â”œâ”€ PAT (fine-grained): ä»…æˆæƒç‰¹å®šä»“åº“                              â”‚
â”‚  â””â”€ PAT (classic): æœ€å°‘éœ€è¦ repo scope (èŒƒå›´è¾ƒå¤§ï¼Œä¸æ¨è)            â”‚
â”‚                                                                     â”‚
â”‚  å®¡è®¡:                                                               â”‚
â”‚  â”œâ”€ æ‰€æœ‰ GitHub API è°ƒç”¨è®°å½•åˆ° llm_request_logs (å¤ç”¨ç°æœ‰æ—¥å¿—)       â”‚
â”‚  â”œâ”€ Token å¢åˆ æ”¹è®°å½•åˆ° admin_notifications                          â”‚
â”‚  â””â”€ å¼‚å¸¸è®¿é—® (é¢‘ç‡çªå¢) è§¦å‘å‘Šè­¦                                     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 17.6 é—®é¢˜æ±‡æ€»ï¼šæœªè§£å†³çš„å¼€æ”¾é—®é¢˜

| # | é—®é¢˜ | å†³ç­–çŠ¶æ€ | æ¨è¿Ÿåˆ° |
|---|------|---------|--------|
| 1 | äº§å“ç›®å½•è°æ¥åˆå§‹åŒ–ï¼Ÿç®¡ç†å‘˜æ‰‹åŠ¨è¿˜æ˜¯ä» GitHub repo è‡ªåŠ¨ç”Ÿæˆï¼Ÿ | å¾…å®š | MVP æ‰‹åŠ¨ï¼Œv1.5 è‡ªåŠ¨å»ºè®® |
| 2 | AI å»ºè®®çš„ç½®ä¿¡åº¦å¦‚ä½•æ ¡å‡†ï¼ŸåˆæœŸæ•°æ®ä¸è¶³æ€ä¹ˆåŠï¼Ÿ | å¾…å®š | å…ˆç”¨å›ºå®šé˜ˆå€¼ 0.7ï¼Œç§¯ç´¯æ•°æ®ååŠ¨æ€è°ƒæ•´ |
| 3 | å¤šä¸ªæ¨¡å—å…³è”åŒä¸€ repo æ—¶ï¼Œå¦‚ä½•é¿å…é‡å¤æœç´¢ï¼Ÿ | å¾…å®š | æœç´¢ç»“æœç¼“å­˜ + å»é‡ |
| 4 | ä¿®å¤å CI å¤±è´¥äº†æ€ä¹ˆåŠï¼ŸAI èƒ½çœ‹åˆ° CI log å¹¶äºŒæ¬¡ä¿®å¤å—ï¼Ÿ | å¾…å®š | MVP ä¸å¤„ç†ï¼Œé€šçŸ¥å¼€å‘è€…ï¼›v2.0 AI è¯» CI log |
| 5 | GitHub Enterprise (é github.com) æ”¯æŒï¼Ÿ | å¾…å®š | MVP ä»… github.comï¼›v2.0 æ”¯æŒè‡ªå®šä¹‰ endpoint |
| 6 | ä»£ç å®¡æ ¸æ„è§ AI èƒ½ç†è§£å¹¶è‡ªåŠ¨æ”¹å—ï¼Ÿ | å¾…å®š | MVP ä»…åŒæ­¥æ˜¾ç¤ºï¼›v2.0 AI è§£è¯» review comments |
| 7 | å¹¶å‘ç¼ºé™·ä¿®å¤åŒä¸€æ–‡ä»¶å¯¼è‡´çš„åˆå¹¶å†²çªï¼Ÿ | å¾…å®š | ä¸²è¡Œå¤„ç†é˜Ÿåˆ—ï¼›æ£€æµ‹åˆ°å†²çªæ ‡è®°ä¸º Manual |
| 8 | æäº¤è€…æˆªå›¾ä¸­åŒ…å«æ•æ„Ÿæ•°æ® (å¯†ç /token) æ€ä¹ˆåŠï¼Ÿ | å¾…å®š | ä¸Šä¼ å‰ AI æ‰«æ â†’ æ•æ„ŸåŒºåŸŸæ¨¡ç³ŠåŒ–æé†’ |

---

### 17.7 æ›´æ–°çš„ MongoDB é›†åˆ (+1)

åŸºäºäº§å“ç›®å½•éœ€æ±‚ï¼Œæ–°å¢é›†åˆï¼š

```
defect_products    # äº§å“ç›®å½• (äº§å“ + æ¨¡å— + ä»“åº“å…³è”)
```

æ€»è®¡ PLANNED é›†åˆï¼š6 ä¸ª (`defect_reports`, `defect_reviews`, `defect_fixes`, `defect_repo_configs`, `defect_github_tokens`, `defect_products`)

---

### 17.8 æ›´æ–°çš„æäº¤è¡¨å• (å«äº§å“é€‰æ‹©)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æäº¤æ–°ç¼ºé™·                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  æ‰€å±äº§å“ *                              æ‰€å±æ¨¡å—                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [PRD Admin â–¼]               â”‚        â”‚ [ç”¨æˆ·è®¤è¯ â–¼]            â”‚   â”‚
â”‚  â”‚  â”œ PRD Admin (ç®¡ç†åå°)      â”‚        â”‚  â”œ ç”¨æˆ·è®¤è¯              â”‚   â”‚
â”‚  â”‚  â”œ PRD Desktop (æ¡Œé¢ç«¯)     â”‚        â”‚  â”œ å¯¹è¯ç³»ç»Ÿ              â”‚   â”‚
â”‚  â”‚  â”” PRD API (æœåŠ¡ç«¯)         â”‚        â”‚  â”œ è§†è§‰åˆ›ä½œ              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”” (AIå»ºè®®: ç”¨æˆ·è®¤è¯ 87%)â”‚   â”‚
â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ğŸ’¡ AI æ ¹æ®æˆªå›¾å†…å®¹å»ºè®®: "ç”¨æˆ·è®¤è¯" æ¨¡å— (ç½®ä¿¡åº¦ 87%)                    â”‚
â”‚                                                                        â”‚
â”‚  æ ‡é¢˜ *                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç™»å½•é¡µéªŒè¯ç è¾“å…¥æ¡†æ— æ³•èšç„¦                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  ... (å…¶ä½™å­—æ®µåŒä¹‹å‰è®¾è®¡) ...                                           â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åå…«ã€AI å®¡æ ¸å¼•æ“æ ¸å¿ƒè®¾è®¡ï¼ˆæœ€å…³é”®éƒ¨åˆ†ï¼‰

> æœ¬èŠ‚å›ç­”ï¼šAI åœ¨å“ªå®¡æ ¸ï¼Ÿæ€ä¹ˆè¯»ä»£ç ï¼Ÿç”¨ä»€ä¹ˆå·¥å…·ï¼Ÿæç¤ºè¯æ€ä¹ˆè®¾è®¡ï¼ŸBug Bot æ˜¯è‡ªå»ºè¿˜æ˜¯å¯¹æ¥ï¼Ÿ

---

### 18.1 æ ¸å¿ƒé—®é¢˜æ‹†è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     "AI å®¡æ ¸" åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ä¸€å¥è¯: AI å®¡æ ¸ = LLM + ä»£ç ä¸Šä¸‹æ–‡ + ç»“æ„åŒ–è¾“å‡º                         â”‚
â”‚                                                                         â”‚
â”‚  æœ¬è´¨ä¸Šåšçš„äº‹æƒ…:                                                         â”‚
â”‚                                                                         â”‚
â”‚  è¾“å…¥:                                                                   â”‚
â”‚  â”œâ”€ ç¼ºé™·æè¿° (æ–‡æœ¬)                                                     â”‚
â”‚  â”œâ”€ æˆªå›¾ (å›¾ç‰‡)                                                         â”‚
â”‚  â”œâ”€ é‡ç°æ­¥éª¤ (æ–‡æœ¬)                                                     â”‚
â”‚  â””â”€ ä»£ç åº“ (éœ€è¦ä»æŸå¤„è·å–)  â† è¿™æ˜¯éš¾ç‚¹                                  â”‚
â”‚                                                                         â”‚
â”‚  å¤„ç†:                                                                   â”‚
â”‚  â”œâ”€ LLM ç†è§£é—®é¢˜                                                        â”‚
â”‚  â”œâ”€ LLM åœ¨ä»£ç ä¸­æœç´¢ç›¸å…³æ–‡ä»¶                                             â”‚
â”‚  â”œâ”€ LLM åˆ†ææ ¹å›                                                         â”‚
â”‚  â””â”€ LLM ç”Ÿæˆä¿®å¤                                                        â”‚
â”‚                                                                         â”‚
â”‚  è¾“å‡º:                                                                   â”‚
â”‚  â”œâ”€ å®šä½ç»“æœ (æ–‡ä»¶ + è¡Œå·)                                               â”‚
â”‚  â”œâ”€ åˆ†ææŠ¥å‘Š (æ ¹å›  + å½±å“)                                               â”‚
â”‚  â””â”€ ä¿®å¤ Patch (ä»£ç å˜æ›´)                                                â”‚
â”‚                                                                         â”‚
â”‚  æ ¸å¿ƒçŸ›ç›¾:                                                               â”‚
â”‚  LLM ä¸èƒ½ç›´æ¥ "çœ‹åˆ°" ä»£ç åº“ã€‚å®ƒéœ€è¦æœ‰äººæŠŠä»£ç å–‚ç»™å®ƒã€‚                     â”‚
â”‚  ä½†ä»£ç åº“å¯èƒ½æœ‰ 10ä¸‡+ æ–‡ä»¶ï¼ŒContext Window æ”¾ä¸ä¸‹ã€‚                       â”‚
â”‚  â†’ å¿…é¡»æœ‰ä¸€ä¸ª "ä»£ç æµè§ˆ Agent" å¸® LLM é€æ­¥æ¢ç´¢ä»£ç åº“ã€‚                   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 18.2 ä¸‰ç§æ¶æ„æ–¹æ¡ˆå¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Bug Bot æ¶æ„æ–¹æ¡ˆå¯¹æ¯”                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  æ–¹æ¡ˆ A: çº¯ API è°ƒç”¨ (Simple Pipeline)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Our Worker                                             â”‚            â”‚
â”‚  â”‚  1. GitHub API æœç´¢å…³é”®è¯                                â”‚            â”‚
â”‚  â”‚  2. GitHub API è¯»å– Top-5 æ–‡ä»¶å†…å®¹                       â”‚            â”‚
â”‚  â”‚  3. æ‹¼æ¥ prompt: ç¼ºé™·æè¿° + ä»£ç ç‰‡æ®µ                     â”‚            â”‚
â”‚  â”‚  4. è°ƒç”¨ LLM API (å•æ¬¡ chat completion)                  â”‚            â”‚
â”‚  â”‚  5. è§£æ LLM è¾“å‡ºä¸ºç»“æ„åŒ–ç»“æœ                            â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  ä¼˜ç‚¹: å®ç°ç®€å•ï¼Œå¯æ§æ€§å¼º                                                â”‚
â”‚  ç¼ºç‚¹: æœç´¢èƒ½åŠ›å¼±ï¼Œåªèƒ½åˆ†æé¢„é€‰æ–‡ä»¶ï¼Œmiss rate é«˜                        â”‚
â”‚  é€‚ç”¨: ä¿¡æ¯å®Œæ•´ + é—®é¢˜ç®€å• + æ˜ç¡®çŸ¥é“åœ¨å“ªä¸ªæ–‡ä»¶çš„åœºæ™¯                    â”‚
â”‚                                                                         â”‚
â”‚  æ–¹æ¡ˆ B: è‡ªå»º Coding Agent (Tool-Use Agent)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Our Worker (Agent Loop)                                â”‚            â”‚
â”‚  â”‚  1. ç»™ LLM æä¾›å·¥å…·: read_file, search_code, list_dir   â”‚            â”‚
â”‚  â”‚  2. LLM è‡ªä¸»å†³å®šè°ƒç”¨å“ªäº›å·¥å…·                             â”‚            â”‚
â”‚  â”‚  3. å¤šè½®å¯¹è¯: æœç´¢ â†’ è¯»å– â†’ åˆ†æ â†’ å†æœç´¢ â†’ ...        â”‚            â”‚
â”‚  â”‚  4. LLM è‡ªå·±å†³å®šä½•æ—¶"å¤Ÿäº†"                               â”‚            â”‚
â”‚  â”‚  5. è¾“å‡ºæœ€ç»ˆåˆ†æç»“æœ                                     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  ä¼˜ç‚¹: åˆ†æèƒ½åŠ›å¼ºï¼Œå¯ä»¥æ·±å…¥è¿½è¸ªè°ƒç”¨é“¾                                    â”‚
â”‚  ç¼ºç‚¹: å®ç°å¤æ‚ï¼Œtoken æ¶ˆè€—å¤§ï¼Œæ‰§è¡Œæ—¶é—´ä¸å¯æ§                            â”‚
â”‚  é€‚ç”¨: å¤æ‚ Bugï¼Œéœ€è¦è·¨æ–‡ä»¶è¿½è¸ªçš„åœºæ™¯                                    â”‚
â”‚                                                                         â”‚
â”‚  æ–¹æ¡ˆ C: å¯¹æ¥å¤–éƒ¨ Coding Agent (Claude Code / Cursor)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Our Worker                                             â”‚            â”‚
â”‚  â”‚  1. Clone ä»“åº“åˆ°æœ¬åœ°                                     â”‚            â”‚
â”‚  â”‚  2. å¯åŠ¨ Claude Code å­è¿›ç¨‹                              â”‚            â”‚
â”‚  â”‚     claude -p "{prompt}" --output-format json            â”‚            â”‚
â”‚  â”‚  3. Claude Code è‡ªä¸»æ¢ç´¢ä»£ç åº“                           â”‚            â”‚
â”‚  â”‚  4. æ¥æ”¶ Claude Code çš„åˆ†æç»“æœ                          â”‚            â”‚
â”‚  â”‚  5. è§£æä¸ºæˆ‘ä»¬çš„æ•°æ®ç»“æ„                                 â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  ä¼˜ç‚¹: æœ€å¼ºçš„ä»£ç ç†è§£èƒ½åŠ›ï¼Œç°æˆçš„å·¥å…·é“¾                                  â”‚
â”‚  ç¼ºç‚¹: ä¾èµ–å¤–éƒ¨å·¥å…·ï¼Œéœ€è¦æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œéƒ¨ç½²å¤æ‚                          â”‚
â”‚  é€‚ç”¨: é‡åº¦ä»£ç åˆ†æ + è‡ªåŠ¨ä¿®å¤åœºæ™¯                                       â”‚
â”‚                                                                         â”‚
â”‚  â˜… æ¨èè·¯å¾„: A (MVP) â†’ B (v1.5) â†’ C (v2.0 å¯é€‰)                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 18.3 æ–¹æ¡ˆ B è¯¦ç»†è®¾è®¡ï¼šè‡ªå»º Coding Agentï¼ˆæ ¸å¿ƒæ¨èï¼‰

#### 18.3.1 Agent å·¥å…·å®šä¹‰

```csharp
/// <summary>
/// ä»£ç åˆ†æ Agent å¯ç”¨çš„å·¥å…·é›†
/// è¿™äº›å·¥å…·ç”± DefectReviewWorker å®ç°ï¼Œé€šè¿‡ LLM Tool-Use åè®®æš´éœ²ç»™æ¨¡å‹
/// </summary>
public static class CodeAgentTools
{
    /// <summary>
    /// å·¥å…· 1: æœç´¢ä»£ç  (åŸºäºå…³é”®è¯/æ­£åˆ™)
    /// </summary>
    public static readonly ToolDefinition SearchCode = new()
    {
        Name = "search_code",
        Description = "åœ¨ä»£ç åº“ä¸­æœç´¢åŒ¹é…çš„ä»£ç ã€‚æ”¯æŒå…³é”®è¯å’Œæ­£åˆ™è¡¨è¾¾å¼ã€‚è¿”å›åŒ¹é…çš„æ–‡ä»¶è·¯å¾„å’Œè¡Œå†…å®¹ã€‚",
        Parameters = new
        {
            query = "æœç´¢å…³é”®è¯æˆ–æ­£åˆ™è¡¨è¾¾å¼",
            path_prefix = "(å¯é€‰) é™å®šæœç´¢ç›®å½•ï¼Œå¦‚ 'src/pages/'",
            file_extension = "(å¯é€‰) é™å®šæ–‡ä»¶ç±»å‹ï¼Œå¦‚ '.tsx'",
            max_results = "(å¯é€‰) æœ€å¤§è¿”å›ç»“æœæ•°ï¼Œé»˜è®¤ 20"
        }
    };

    /// <summary>
    /// å·¥å…· 2: è¯»å–æ–‡ä»¶å†…å®¹
    /// </summary>
    public static readonly ToolDefinition ReadFile = new()
    {
        Name = "read_file",
        Description = "è¯»å–æŒ‡å®šæ–‡ä»¶çš„å†…å®¹ã€‚å¯ä»¥æŒ‡å®šè¡ŒèŒƒå›´ä»¥èŠ‚çœ tokenã€‚",
        Parameters = new
        {
            path = "æ–‡ä»¶ç›¸å¯¹è·¯å¾„",
            start_line = "(å¯é€‰) èµ·å§‹è¡Œå·",
            end_line = "(å¯é€‰) ç»“æŸè¡Œå·"
        }
    };

    /// <summary>
    /// å·¥å…· 3: åˆ—å‡ºç›®å½•ç»“æ„
    /// </summary>
    public static readonly ToolDefinition ListDirectory = new()
    {
        Name = "list_directory",
        Description = "åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•ã€‚ç”¨äºäº†è§£é¡¹ç›®ç»“æ„ã€‚",
        Parameters = new
        {
            path = "ç›®å½•ç›¸å¯¹è·¯å¾„",
            depth = "(å¯é€‰) é€’å½’æ·±åº¦ï¼Œé»˜è®¤ 2",
            pattern = "(å¯é€‰) æ–‡ä»¶ååŒ¹é…æ¨¡å¼ï¼Œå¦‚ '*.tsx'"
        }
    };

    /// <summary>
    /// å·¥å…· 4: æŸ¥æ‰¾å¼•ç”¨ (è°è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°/ç»„ä»¶)
    /// </summary>
    public static readonly ToolDefinition FindReferences = new()
    {
        Name = "find_references",
        Description = "æŸ¥æ‰¾ä»£ç ä¸­å¯¹æŒ‡å®šç¬¦å·(å‡½æ•°å/ç±»å/å˜é‡å)çš„æ‰€æœ‰å¼•ç”¨ã€‚",
        Parameters = new
        {
            symbol = "è¦æŸ¥æ‰¾çš„ç¬¦å·åç§°",
            path_prefix = "(å¯é€‰) é™å®šæœç´¢èŒƒå›´"
        }
    };

    /// <summary>
    /// å·¥å…· 5: è·å–æ–‡ä»¶çš„ Git å†å²
    /// </summary>
    public static readonly ToolDefinition GitLog = new()
    {
        Name = "git_log",
        Description = "è·å–æŒ‡å®šæ–‡ä»¶çš„æœ€è¿‘ Git æäº¤è®°å½•ã€‚ç”¨äºäº†è§£æœ€è¿‘çš„å˜æ›´ã€‚",
        Parameters = new
        {
            path = "æ–‡ä»¶ç›¸å¯¹è·¯å¾„",
            count = "(å¯é€‰) è¿”å›æ¡æ•°ï¼Œé»˜è®¤ 5"
        }
    };

    /// <summary>
    /// å·¥å…· 6: æäº¤åˆ†æç»“è®º (ç»ˆæ­¢å·¥å…·)
    /// </summary>
    public static readonly ToolDefinition SubmitAnalysis = new()
    {
        Name = "submit_analysis",
        Description = "æäº¤æœ€ç»ˆçš„åˆ†æç»“è®ºã€‚è°ƒç”¨æ­¤å·¥å…·å Agent åœæ­¢æ‰§è¡Œã€‚",
        Parameters = new
        {
            verdict = "ç»“è®º: pass | need_info | duplicate | invalid | can_auto_fix | need_manual_fix | major_change",
            root_cause = "æ ¹å› åˆ†æ (markdown)",
            located_files = "å®šä½çš„æ–‡ä»¶åˆ—è¡¨ [{path, startLine, endLine, reason, confidence}]",
            fix_suggestion = "ä¿®å¤å»ºè®® {level, description, patch?}",
            priority = "ä¼˜å…ˆçº§å»ºè®®: P0 | P1 | P2 | P3",
            impact = "å½±å“èŒƒå›´: core | edge | ui | performance | security"
        }
    };
}
```

#### 18.3.2 Agent æ‰§è¡Œå¾ªç¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Coding Agent æ‰§è¡Œå¾ªç¯                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  DefectReviewWorker å†…éƒ¨:                                                â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ 1. å‡†å¤‡ä¸Šä¸‹æ–‡ â”‚                                                        â”‚
â”‚  â”‚  - ç¼ºé™·æè¿°   â”‚                                                        â”‚
â”‚  â”‚  - æˆªå›¾(base64)â”‚                                                       â”‚
â”‚  â”‚  - äº§å“/æ¨¡å—   â”‚                                                        â”‚
â”‚  â”‚  - ç³»ç»Ÿæç¤ºè¯  â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ 2. LLM è°ƒç”¨  â”‚â”€â”€â”€â”€â–¶â”‚ 3. å·¥å…·è°ƒç”¨?  â”‚â”€â”€â”€â”€â–¶â”‚ 4. æ‰§è¡Œå·¥å…·   â”‚             â”‚
â”‚  â”‚  (with tools)â”‚     â”‚  YES â†’ æ‰§è¡Œ   â”‚     â”‚  search_code  â”‚             â”‚
â”‚  â”‚              â”‚     â”‚  NO â†’ å®Œæˆ    â”‚     â”‚  read_file    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  list_dir     â”‚             â”‚
â”‚         â–²                                   â”‚  ...          â”‚             â”‚
â”‚         â”‚                                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                                          â”‚                     â”‚
â”‚         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”‚ 5. å·¥å…·ç»“æœ   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚               â”‚  append to    â”‚                                           â”‚
â”‚               â”‚  conversation â”‚                                           â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                                         â”‚
â”‚  å¾ªç¯ç»ˆæ­¢æ¡ä»¶:                                                            â”‚
â”‚  â”œâ”€ LLM è°ƒç”¨ submit_analysis å·¥å…· â†’ æ­£å¸¸ç»“æŸ                             â”‚
â”‚  â”œâ”€ è¾¾åˆ° max_iterations (é»˜è®¤ 15) â†’ è¶…æ—¶ç»“æŸ                             â”‚
â”‚  â”œâ”€ è¾¾åˆ° max_tokens é¢„ç®— (é»˜è®¤ 100k) â†’ é¢„ç®—ç»“æŸ                          â”‚
â”‚  â””â”€ å·¥å…·æ‰§è¡Œå‡ºé”™ 3 æ¬¡ â†’ å¼‚å¸¸ç»“æŸ                                         â”‚
â”‚                                                                         â”‚
â”‚  æ¯ä¸€è½®éƒ½é€šè¿‡ SSE å‘å‰ç«¯æ¨é€è¿›åº¦:                                          â”‚
â”‚  â”œâ”€ "æ­£åœ¨æœç´¢å…³é”®è¯ 'CaptchaInput'..."                                   â”‚
â”‚  â”œâ”€ "æ‰¾åˆ° 3 ä¸ªåŒ¹é…æ–‡ä»¶ï¼Œæ­£åœ¨è¯»å–..."                                      â”‚
â”‚  â”œâ”€ "åˆ†æ LoginForm.tsx ç¬¬ 45-60 è¡Œ..."                                  â”‚
â”‚  â””â”€ "å®šä½å®Œæˆï¼Œç”Ÿæˆä¿®å¤å»ºè®®..."                                           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 18.3.3 å·¥å…·å®ç°å±‚ï¼šä»£ç ä»å“ªæ¥ï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä»£ç è·å–å±‚ (Code Provider)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ICodeProvider æ¥å£:                                                     â”‚
â”‚  â”œâ”€ SearchAsync(query, options) â†’ List<SearchResult>                     â”‚
â”‚  â”œâ”€ ReadFileAsync(path, range?) â†’ FileContent                           â”‚
â”‚  â”œâ”€ ListDirectoryAsync(path, depth) â†’ DirectoryTree                     â”‚
â”‚  â”œâ”€ FindReferencesAsync(symbol) â†’ List<Reference>                       â”‚
â”‚  â””â”€ GetGitLogAsync(path, count) â†’ List<CommitInfo>                      â”‚
â”‚                                                                         â”‚
â”‚  å®ç° A: GitHubCodeProvider (MVP)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  search_code â†’ GitHub Code Search API                      â”‚         â”‚
â”‚  â”‚    GET /search/code?q={query}+repo:{owner/repo}+path:{dir} â”‚         â”‚
â”‚  â”‚    é™åˆ¶: 30 req/min, ä»…æœç´¢é»˜è®¤åˆ†æ”¯                         â”‚         â”‚
â”‚  â”‚                                                            â”‚         â”‚
â”‚  â”‚  read_file â†’ GitHub Contents API                           â”‚         â”‚
â”‚  â”‚    GET /repos/{owner}/{repo}/contents/{path}               â”‚         â”‚
â”‚  â”‚    é™åˆ¶: æ–‡ä»¶ â‰¤ 100MB, base64 ç¼–ç                          â”‚         â”‚
â”‚  â”‚                                                            â”‚         â”‚
â”‚  â”‚  list_directory â†’ GitHub Trees API                         â”‚         â”‚
â”‚  â”‚    GET /repos/{owner}/{repo}/git/trees/{sha}?recursive=1   â”‚         â”‚
â”‚  â”‚    é™åˆ¶: â‰¤ 100,000 entries                                 â”‚         â”‚
â”‚  â”‚                                                            â”‚         â”‚
â”‚  â”‚  find_references â†’ GitHub Code Search (å˜ä½“æŸ¥è¯¢)            â”‚         â”‚
â”‚  â”‚    æ¨¡æ‹Ÿ: æœç´¢ç¬¦å·åï¼Œè¿‡æ»¤ import/å®šä¹‰                       â”‚         â”‚
â”‚  â”‚                                                            â”‚         â”‚
â”‚  â”‚  git_log â†’ GitHub Commits API                              â”‚         â”‚
â”‚  â”‚    GET /repos/{owner}/{repo}/commits?path={path}           â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                         â”‚
â”‚  å®ç° B: LocalCloneCodeProvider (v1.5)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  å‰ç½®: git clone --depth=1 â†’ æœ¬åœ°ä¸´æ—¶ç›®å½•                   â”‚         â”‚
â”‚  â”‚                                                            â”‚         â”‚
â”‚  â”‚  search_code â†’ ripgrep (rg) å‘½ä»¤                           â”‚         â”‚
â”‚  â”‚    é€Ÿåº¦å¿«, æ— é™æµ, æ”¯æŒæ­£åˆ™                                  â”‚         â”‚
â”‚  â”‚                                                            â”‚         â”‚
â”‚  â”‚  read_file â†’ ç›´æ¥è¯»æ–‡ä»¶ç³»ç»Ÿ                                 â”‚         â”‚
â”‚  â”‚    æ— å¤§å°é™åˆ¶, æ— ç½‘ç»œå»¶è¿Ÿ                                    â”‚         â”‚
â”‚  â”‚                                                            â”‚         â”‚
â”‚  â”‚  list_directory â†’ ç›´æ¥ ls / Directory.GetFiles             â”‚         â”‚
â”‚  â”‚    é€’å½’æ— é™åˆ¶                                               â”‚         â”‚
â”‚  â”‚                                                            â”‚         â”‚
â”‚  â”‚  find_references â†’ ripgrep + tree-sitter (ç²¾ç¡®å®šä¹‰/å¼•ç”¨)    â”‚         â”‚
â”‚  â”‚    æ¯”çº¯æ–‡æœ¬æœç´¢å‡†ç¡®: åŒºåˆ†å®šä¹‰ vs ä½¿ç”¨                        â”‚         â”‚
â”‚  â”‚                                                            â”‚         â”‚
â”‚  â”‚  git_log â†’ git log --follow {path}                         â”‚         â”‚
â”‚  â”‚    éœ€è¦ full clone (depth=1 æ— å†å²)                         â”‚         â”‚
â”‚  â”‚    æˆ–ç”¨ GitHub Commits API å…œåº•                             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                         â”‚
â”‚  â˜… æ¨èç­–ç•¥:                                                            â”‚
â”‚  â”œâ”€ åˆå®¡é˜¶æ®µ: GitHubCodeProvider (è½»é‡, åªæœç´¢)                          â”‚
â”‚  â”œâ”€ æ·±åº¦åˆ†æ: LocalCloneCodeProvider (éœ€è¦å¤šè½®è¯»å–)                      â”‚
â”‚  â””â”€ ä¿®å¤ç”Ÿæˆ: LocalCloneCodeProvider (éœ€è¦å®Œæ•´æ–‡ä»¶ä¸Šä¸‹æ–‡)                 â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 18.3.4 Worker ä¼ªä»£ç å®ç°

```csharp
public sealed class DefectReviewWorker : BackgroundService
{
    private readonly ILlmClient _llm;
    private readonly ICodeProviderFactory _codeProviderFactory;
    private readonly IRunEventStore _eventStore;
    private const int MaxIterations = 15;
    private const int MaxTokenBudget = 100_000;

    private async Task ProcessDefectAsync(DefectReport defect, string runId)
    {
        // 1. åˆ›å»ºä»£ç æä¾›è€… (æ ¹æ®ä»“åº“é…ç½®é€‰æ‹©å®ç°)
        var repoConfig = await _repoConfigRepo.GetByIdAsync(defect.RepoConfigId);
        var codeProvider = _codeProviderFactory.Create(repoConfig);

        // 2. æ„å»ºåˆå§‹æ¶ˆæ¯ (ç³»ç»Ÿæç¤ºè¯ + ç¼ºé™·ä¸Šä¸‹æ–‡)
        var messages = new List<Message>
        {
            BuildSystemPrompt(defect, repoConfig),
            BuildUserMessage(defect)  // åŒ…å«æˆªå›¾ã€æè¿°ã€æ­¥éª¤
        };

        // 3. Agent å¾ªç¯
        int iteration = 0;
        int tokensUsed = 0;

        while (iteration < MaxIterations && tokensUsed < MaxTokenBudget)
        {
            iteration++;

            // 3a. è°ƒç”¨ LLM (å¸¦å·¥å…·å®šä¹‰)
            var response = await _llm.ChatAsync(new ChatRequest
            {
                Messages = messages,
                Tools = CodeAgentTools.AllTools,
                Model = "claude-sonnet-4-20250514" // ä»£ç åˆ†æç”¨ Sonnet
            });

            tokensUsed += response.Usage.TotalTokens;

            // 3b. æ£€æŸ¥æ˜¯å¦è°ƒç”¨äº†ç»ˆæ­¢å·¥å…·
            if (response.HasToolCall("submit_analysis"))
            {
                var analysis = ParseAnalysis(response.ToolCallArgs);
                await SaveReviewResult(defect.Id, analysis);
                await _eventStore.AppendAsync(runId, new ReviewCompleteEvent(analysis));
                return;
            }

            // 3c. æ‰§è¡Œå·¥å…·è°ƒç”¨
            foreach (var toolCall in response.ToolCalls)
            {
                // æ¨é€è¿›åº¦
                await _eventStore.AppendAsync(runId, new ProgressEvent(
                    $"æ­£åœ¨æ‰§è¡Œ: {toolCall.Name}({toolCall.Args.GetSummary()})..."
                ));

                // æ‰§è¡Œå·¥å…·
                var toolResult = await ExecuteToolAsync(codeProvider, toolCall);

                // è¿½åŠ åˆ°å¯¹è¯
                messages.Add(Message.ToolResult(toolCall.Id, toolResult));
            }

            // 3d. è¿½åŠ  assistant æ¶ˆæ¯
            messages.Add(response.AssistantMessage);
        }

        // è¶…å‡ºé™åˆ¶ â†’ æ ‡è®°ä¸ºéœ€äººå·¥å¤„ç†
        await SaveReviewResult(defect.Id, new DefectReview
        {
            Verdict = ReviewVerdict.NeedManualFix,
            Content = "AI åˆ†ææœªåœ¨é™å®šæ­¥éª¤å†…å®Œæˆï¼Œå»ºè®®äººå·¥ä»‹å…¥ã€‚"
        });
    }

    private async Task<string> ExecuteToolAsync(
        ICodeProvider provider, ToolCall toolCall)
    {
        return toolCall.Name switch
        {
            "search_code" => JsonSerializer.Serialize(
                await provider.SearchAsync(
                    toolCall.Args["query"],
                    toolCall.Args.GetOrDefault("path_prefix"),
                    toolCall.Args.GetOrDefault("file_extension"),
                    toolCall.Args.GetIntOrDefault("max_results", 20)
                )),

            "read_file" => JsonSerializer.Serialize(
                await provider.ReadFileAsync(
                    toolCall.Args["path"],
                    toolCall.Args.GetIntOrDefault("start_line"),
                    toolCall.Args.GetIntOrDefault("end_line")
                )),

            "list_directory" => JsonSerializer.Serialize(
                await provider.ListDirectoryAsync(
                    toolCall.Args["path"],
                    toolCall.Args.GetIntOrDefault("depth", 2)
                )),

            "find_references" => JsonSerializer.Serialize(
                await provider.FindReferencesAsync(
                    toolCall.Args["symbol"],
                    toolCall.Args.GetOrDefault("path_prefix")
                )),

            "git_log" => JsonSerializer.Serialize(
                await provider.GetGitLogAsync(
                    toolCall.Args["path"],
                    toolCall.Args.GetIntOrDefault("count", 5)
                )),

            _ => throw new InvalidOperationException($"Unknown tool: {toolCall.Name}")
        };
    }
}
```

---

### 18.4 æ–¹æ¡ˆ C è®¾è®¡ï¼šå¯¹æ¥ Claude Code

#### 18.4.1 ä¸ºä»€ä¹ˆè¦å¯¹æ¥ Claude Codeï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è‡ªå»º Agent vs Claude Code å¯¹æ¯”                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç»´åº¦               â”‚ è‡ªå»º Agent (æ–¹æ¡ˆB)    â”‚ Claude Code (æ–¹æ¡ˆC)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·¥å…·æ•°é‡           â”‚ 5-6 ä¸ªåŸºç¡€å·¥å…·        â”‚ 30+ å·¥å…· (Glob/Grep/Edit/...) â”‚
â”‚ ä»£ç ç†è§£æ·±åº¦       â”‚ å–å†³äºå·¥å…·å®ç°è´¨é‡     â”‚ ç»è¿‡å¤§é‡ä¼˜åŒ–çš„ä»£ç ç†è§£        â”‚
â”‚ ä¿®å¤èƒ½åŠ›           â”‚ ç”Ÿæˆ diff             â”‚ å¯ç›´æ¥ç¼–è¾‘æ–‡ä»¶                â”‚
â”‚ å¤šæ–‡ä»¶å…³è”åˆ†æ     â”‚ éœ€è‡ªå·±å®ç°è¿½è¸ªé€»è¾‘     â”‚ å†…ç½®è°ƒç”¨é“¾è¿½è¸ª              â”‚
â”‚ æ‰§è¡Œç¯å¢ƒ           â”‚ æœåŠ¡å™¨å†…å­˜ä¸­          â”‚ éœ€è¦æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ              â”‚
â”‚ å¹¶å‘èƒ½åŠ›           â”‚ å¤š Worker å¹¶è¡Œ        â”‚ æ¯ä¸ªä»»åŠ¡ä¸€ä¸ªè¿›ç¨‹              â”‚
â”‚ æˆæœ¬               â”‚ ä»… LLM API token     â”‚ LLM token + è¿›ç¨‹èµ„æº         â”‚
â”‚ éƒ¨ç½²å¤æ‚åº¦         â”‚ ä½ (çº¯ API è°ƒç”¨)      â”‚ é«˜ (éœ€å®‰è£… CLI + Node.js)    â”‚
â”‚ å¯æ§æ€§             â”‚ å®Œå…¨å¯æ§              â”‚ é»‘ç›’è¡Œä¸ºï¼Œéš¾ä»¥çº¦æŸ            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  ç»“è®º:                                                                    â”‚
â”‚  - MVP ç”¨æ–¹æ¡ˆ B (è‡ªå»º)ï¼šå¯æ§ã€è½»é‡ã€å¤Ÿç”¨                                  â”‚
â”‚  - v2.0 å¯é€‰æ–¹æ¡ˆ C (Claude Code)ï¼šå¤„ç†å¤æ‚å¤šæ–‡ä»¶ Bug                      â”‚
â”‚  - ä¸¤è€…ä¸å†²çªï¼šç®€å• Bug èµ°æ–¹æ¡ˆ Bï¼Œå¤æ‚ Bug å‡çº§ä¸ºæ–¹æ¡ˆ C                   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 18.4.2 Claude Code å¯¹æ¥æ¥å£è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Code å¯¹æ¥æ¶æ„                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  è°ƒç”¨æ–¹å¼: CLI å­è¿›ç¨‹æ¨¡å¼ (é HTTP API)                                   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Our Worker   â”‚â”€â”€â”€â–¶â”‚ æ–‡ä»¶ç³»ç»Ÿå‡†å¤‡  â”‚â”€â”€â”€â–¶â”‚ claude CLI è¿›ç¨‹      â”‚       â”‚
â”‚  â”‚              â”‚    â”‚ (git clone)  â”‚    â”‚ (å­è¿›ç¨‹æ‰§è¡Œ)          â”‚       â”‚
â”‚  â”‚              â”‚â—€â”€â”€â”€â”‚              â”‚â—€â”€â”€â”€â”‚                      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â”‚  è°ƒç”¨å‘½ä»¤:                                                               â”‚
â”‚  $ claude -p "{escaped_prompt}"                                         â”‚
â”‚      --output-format json                                               â”‚
â”‚      --max-turns 20                                                     â”‚
â”‚      --allowedTools "Read,Glob,Grep,Bash(git log)"                      â”‚
â”‚      --workdir /tmp/defect-repos/{defect-id}/                           â”‚
â”‚                                                                         â”‚
â”‚  æˆ–ä½¿ç”¨ Claude Agent SDK (TypeScript):                                   â”‚
â”‚  const agent = new ClaudeAgent({                                        â”‚
â”‚    model: "claude-sonnet-4-20250514",                                   â”‚
â”‚    tools: [Read, Glob, Grep, Write],                                    â”‚
â”‚    workingDir: repoPath,                                                â”‚
â”‚    maxTurns: 20                                                         â”‚
â”‚  });                                                                    â”‚
â”‚  const result = await agent.run(prompt);                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 18.4.3 ä¼ é€’ä»€ä¹ˆæ•°æ®ç»™ Claude Codeï¼Ÿ

```typescript
// ä¼ é€’ç»™ Claude Code çš„ Prompt ç»“æ„
interface ClaudeCodeInput {
  // 1. ä»»åŠ¡æŒ‡ä»¤ (ç³»ç»Ÿæç¤ºè¯ä¸­)
  systemContext: {
    role: "defect-analyzer" | "defect-fixer";
    outputSchema: "DefectAnalysisResult" | "DefectFixResult";
    constraints: string[];  // çº¦æŸè§„åˆ™
  };

  // 2. ç¼ºé™·ä¿¡æ¯
  defect: {
    id: string;
    title: string;
    description: string;
    reproSteps: string[];
    expectedBehavior: string;
    actualBehavior: string;
    environment: object;
    screenshots: string[];  // base64 or file paths
  };

  // 3. é¡¹ç›®ä¸Šä¸‹æ–‡ (å¸®åŠ© AI ç¼©çª„èŒƒå›´)
  projectContext: {
    repoName: string;
    language: string;           // "TypeScript", "C#", etc.
    framework: string;          // "React", ".NET", etc.
    relevantPaths: string[];    // é…ç½®çš„ CodePathPrefixes
    moduleName: string;         // æ‰€å±æ¨¡å—
    recentChanges?: string[];   // æœ€è¿‘æäº¤ (å¯é€‰)
  };
}

// Claude Code æœŸæœ›è¿”å›çš„ç»“æ„
interface DefectAnalysisResult {
  verdict: "pass" | "need_info" | "duplicate" | "invalid"
         | "can_auto_fix" | "need_manual_fix" | "major_change";
  rootCause: string;           // Markdown
  locatedFiles: Array<{
    path: string;
    startLine: number;
    endLine: number;
    reason: string;
    confidence: number;        // 0.0 ~ 1.0
  }>;
  fixSuggestion: {
    level: "auto" | "semi_auto" | "manual";
    description: string;
    patch?: string;            // unified diff (if auto)
    pseudoCode?: string;       // (if semi_auto)
    report?: string;           // (if manual)
    affectedFiles: string[];
    riskAssessment: string;
    testSuggestions: string[];
  };
  priority: "P0" | "P1" | "P2" | "P3";
  impact: "core" | "edge" | "ui" | "performance" | "security";
  reproConfidence: "high" | "medium" | "low" | "unknown";
}

interface DefectFixResult {
  success: boolean;
  changes: Array<{
    path: string;
    diff: string;              // unified diff
    changeType: "add" | "modify" | "delete";
  }>;
  commitMessage: string;
  testCommands?: string[];     // å»ºè®®è¿è¡Œçš„æµ‹è¯•å‘½ä»¤
  verificationSteps: string[];
}
```

#### 18.4.4 æ¥æ”¶ä»€ä¹ˆæ•°æ®ï¼Ÿå¦‚ä½•è§£æï¼Ÿ

```csharp
/// <summary>
/// Claude Code æ‰§è¡Œå™¨
/// </summary>
public class ClaudeCodeExecutor : IExternalAgentExecutor
{
    private readonly string _claudeCliPath;

    public async Task<DefectAnalysisResult> AnalyzeAsync(
        string repoPath, ClaudeCodeInput input, CancellationToken ct)
    {
        // 1. æ„å»º prompt
        var prompt = BuildPrompt(input);

        // 2. å¯åŠ¨å­è¿›ç¨‹
        var process = new Process
        {
            StartInfo = new ProcessStartInfo
            {
                FileName = _claudeCliPath,  // "claude" or "npx claude"
                Arguments = BuildArguments(prompt, repoPath),
                WorkingDirectory = repoPath,
                RedirectStandardOutput = true,
                RedirectStandardError = true,
                UseShellExecute = false,
                Environment =
                {
                    ["ANTHROPIC_API_KEY"] = _apiKeyProvider.GetKey(),
                    ["CLAUDE_CODE_MAX_TURNS"] = "20"
                }
            }
        };

        process.Start();

        // 3. è¯»å–è¾“å‡º (JSON æ ¼å¼)
        var output = await process.StandardOutput.ReadToEndAsync(ct);
        await process.WaitForExitAsync(ct);

        if (process.ExitCode != 0)
        {
            var error = await process.StandardError.ReadToEndAsync(ct);
            throw new ExternalAgentException($"Claude Code failed: {error}");
        }

        // 4. è§£æç»“æœ
        return JsonSerializer.Deserialize<DefectAnalysisResult>(output)
            ?? throw new InvalidOperationException("Failed to parse Claude Code output");
    }

    private string BuildArguments(string prompt, string repoPath)
    {
        // --output-format json: ç¡®ä¿è¾“å‡ºå¯è§£æ
        // --max-turns: é™åˆ¶æ‰§è¡Œè½®æ¬¡
        // --allowedTools: é™åˆ¶å·¥å…·æƒé™ (ä¸å…è®¸ Write/Edit, ä»…åˆ†æ)
        return $"-p \"{EscapeForShell(prompt)}\" " +
               $"--output-format json " +
               $"--max-turns 20 " +
               $"--allowedTools \"Read,Glob,Grep\"";
    }
}
```

---

### 18.5 Cursor / å…¶ä»–ç¼–ç å·¥å…·å¯¹æ¥

#### 18.5.1 Cursor çš„é™åˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cursor å¯¹æ¥å¯è¡Œæ€§åˆ†æ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ç°çŠ¶ (2025):                                                            â”‚
â”‚  â”œâ”€ Cursor æ˜¯æ¡Œé¢ IDEï¼Œæ²¡æœ‰å…¬å¼€çš„ Server-side API                       â”‚
â”‚  â”œâ”€ æ— æ³•åœ¨æœåŠ¡å™¨ç«¯è‡ªåŠ¨åŒ–è°ƒç”¨ Cursor åˆ†æä»£ç                              â”‚
â”‚  â”œâ”€ Cursor çš„ AI èƒ½åŠ›åŸºäº Claude/GPTï¼Œä½†æ¥å£å°è£…åœ¨ IDE å†…                â”‚
â”‚  â””â”€ ç»“è®º: æ— æ³•ä½œä¸ºæœåŠ¡ç«¯ Bug Bot ä½¿ç”¨                                   â”‚
â”‚                                                                         â”‚
â”‚  å¯èƒ½çš„é—´æ¥æ–¹å¼:                                                         â”‚
â”‚  â”œâ”€ å¼€å‘è€…åœ¨ Cursor ä¸­æ‰“å¼€é¡¹ç›®                                          â”‚
â”‚  â”œâ”€ æˆ‘ä»¬ç³»ç»Ÿç”Ÿæˆåˆ†æ Prompt                                             â”‚
â”‚  â”œâ”€ å¼€å‘è€…å¤åˆ¶ Prompt åˆ° Cursor Chat                                    â”‚
â”‚  â”œâ”€ Cursor åˆ†æåï¼Œå¼€å‘è€…å›è´´ç»“æœ                                       â”‚
â”‚  â””â”€ è¿™æœ¬è´¨ä¸Šæ˜¯"äººå·¥ä¸­è½¬"ï¼Œä¸æ˜¯çœŸæ­£é›†æˆ                                  â”‚
â”‚                                                                         â”‚
â”‚  ç»“è®º: Cursor ä¸é€‚åˆä½œä¸º Bug Bot åç«¯ã€‚                                  â”‚
â”‚  å¦‚æœè¦å¯¹æ¥æ¡Œé¢ IDE ç±»å·¥å…·ï¼Œä¸å¦‚å¯¹æ¥ Claude Code CLIã€‚                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 18.5.2 å…¶ä»–å¯å¯¹æ¥çš„ç¼–ç  Agent

| å·¥å…· | è°ƒç”¨æ–¹å¼ | é€‚ç”¨æ€§ | å¤‡æ³¨ |
|------|---------|--------|------|
| **Claude Code CLI** | å­è¿›ç¨‹ / Agent SDK | âœ… æ¨è | æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ + å®Œæ•´å·¥å…·é“¾ |
| **OpenAI Codex** | HTTP API | âš ï¸ å¯ç”¨ | ä»£ç è¡¥å…¨ä¸ºä¸»ï¼Œé Agent æ¨¡å¼ |
| **GitHub Copilot** | IDE æ’ä»¶ | âŒ ä¸é€‚åˆ | æ— æœåŠ¡ç«¯ API |
| **Cursor** | æ¡Œé¢ IDE | âŒ ä¸é€‚åˆ | æ— æœåŠ¡ç«¯ API |
| **Aider** | CLI å­è¿›ç¨‹ | âš ï¸ å¤‡é€‰ | å¼€æºï¼Œå¯ self-host |
| **SWE-Agent** | Python è¿›ç¨‹ | âš ï¸ ç ”ç©¶çº§ | å­¦æœ¯é¡¹ç›®ï¼Œç”Ÿäº§ç¨³å®šæ€§æœªéªŒè¯ |

---

### 18.6 ç³»ç»Ÿæç¤ºè¯è®¾è®¡

#### 18.6.1 åˆå®¡æç¤ºè¯ (Triage Prompt)

```markdown
# è§’è‰²

ä½ æ˜¯ä¸€ä¸ªç¼ºé™·åˆå®¡ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯è¯„ä¼°ä¸€ä¸ªç¼ºé™·æŠ¥å‘Šçš„è´¨é‡å’Œæœ‰æ•ˆæ€§ã€‚

# è¯„ä¼°ç»´åº¦

è¯·æŒ‰ä»¥ä¸‹ç»´åº¦è¯„ä¼°ï¼š

## 1. ä¿¡æ¯å®Œæ•´æ€§
- æ ‡é¢˜æ˜¯å¦æ¸…æ™°æè¿°äº†é—®é¢˜ç°è±¡ï¼Ÿ(ä¸èƒ½æ˜¯"æœ‰ä¸ªbug"è¿™ç§)
- æè¿°æ˜¯å¦è¯´æ˜äº†å…·ä½“çš„é—®é¢˜è¡¨ç°ï¼Ÿ
- é‡ç°æ­¥éª¤æ˜¯å¦å®Œæ•´ä¸”å¯æ‰§è¡Œï¼Ÿ
- æœŸæœ›è¡Œä¸ºå’Œå®é™…è¡Œä¸ºæ˜¯å¦éƒ½æœ‰è¯´æ˜ï¼Ÿ
- æˆªå›¾æ˜¯å¦èƒ½è¾…åŠ©ç†è§£é—®é¢˜ï¼Ÿ

## 2. å¤ç°æ€§è¯„ä¼°
- é‡ç°æ­¥éª¤æ˜¯å¦è¶³å¤Ÿå…·ä½“ï¼ˆå“ªä¸ªé¡µé¢ã€ä»€ä¹ˆæ“ä½œã€ä»€ä¹ˆé¡ºåºï¼‰ï¼Ÿ
- ç¯å¢ƒä¿¡æ¯æ˜¯å¦é½å…¨ï¼ˆæµè§ˆå™¨/ç³»ç»Ÿ/ç‰ˆæœ¬ï¼‰ï¼Ÿ
- æ˜¯å¦æ˜¯å¶å‘é—®é¢˜è¿˜æ˜¯å¿…ç°é—®é¢˜ï¼Ÿ
- ç»™å‡ºå¤ç°ç½®ä¿¡åº¦: high / medium / low / unknown

## 3. æœ‰æ•ˆæ€§åˆ¤æ–­
- æ˜¯å¦æ˜¯å·²çŸ¥è¡Œä¸ºï¼ˆä¸æ˜¯ Bugï¼Œæ˜¯ Featureï¼‰ï¼Ÿ
- æ˜¯å¦æ˜¯ç”¨æˆ·æ“ä½œé”™è¯¯ï¼Ÿ
- æè¿°çš„é—®é¢˜æ˜¯å¦é€»è¾‘è‡ªæ´½ï¼Ÿ

# è¾“å‡ºæ ¼å¼

è¯·ä½¿ç”¨ submit_analysis å·¥å…·æäº¤ä½ çš„è¯„ä¼°ç»“æœã€‚

å¦‚æœä¿¡æ¯ä¸å®Œæ•´ï¼Œverdict è®¾ä¸º "need_info"ï¼Œå¹¶åœ¨ root_cause ä¸­è¯´æ˜éœ€è¦è¡¥å……ä»€ä¹ˆã€‚
å¦‚æœåˆ¤æ–­ä¸ºæ— æ•ˆï¼Œverdict è®¾ä¸º "invalid"ï¼Œå¹¶è¯´æ˜åŸå› ã€‚
å¦‚æœä¿¡æ¯å®Œæ•´ä¸”æœ‰æ•ˆï¼Œverdict è®¾ä¸º "pass"ï¼Œç»§ç»­ä¸‹ä¸€æ­¥åˆ†æã€‚

# æ³¨æ„äº‹é¡¹

- ä¸è¦è¿‡äºä¸¥æ ¼ï¼Œäº§å“ç»ç†/æµ‹è¯•äººå‘˜ä¸æ˜¯ç¨‹åºå‘˜ï¼Œæè¿°å¯èƒ½ä¸å¤ŸæŠ€æœ¯åŒ–
- æˆªå›¾æ¯”æ–‡å­—æè¿°æ›´æœ‰è¯´æ˜åŠ›ï¼Œå³ä½¿æ–‡å­—ç®€çŸ­ï¼Œæˆªå›¾æ¸…æ™°ä¹Ÿç®—æœ‰æ•ˆ
- é‡å¤Bugçš„åˆ¤æ–­ç•™ç»™åç»­æ­¥éª¤ï¼Œè¿™ä¸€æ­¥åªçœ‹ä¿¡æ¯å®Œæ•´æ€§
```

#### 18.6.2 ä»£ç åˆ†ææç¤ºè¯ (Analysis Prompt)

```markdown
# è§’è‰²

ä½ æ˜¯ä¸€ä¸ªä»£ç åˆ†æä¸“å®¶ã€‚ä½ éœ€è¦æ ¹æ®ç¼ºé™·æè¿°ï¼Œåœ¨ä»£ç åº“ä¸­å®šä½é—®é¢˜æ ¹å› ã€‚

# å¯ç”¨å·¥å…·

ä½ æœ‰ä»¥ä¸‹å·¥å…·å¯ç”¨äºæ¢ç´¢ä»£ç åº“ï¼š
- search_code: æœç´¢ä»£ç å†…å®¹
- read_file: è¯»å–æ–‡ä»¶
- list_directory: æŸ¥çœ‹ç›®å½•ç»“æ„
- find_references: æŸ¥æ‰¾å¼•ç”¨
- git_log: æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹å†å²

# åˆ†æç­–ç•¥

è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œåˆ†æï¼š

## Step 1: ç†è§£é—®é¢˜
- ä»æˆªå›¾ä¸­è¯†åˆ« UI å…ƒç´ ï¼ˆå¦‚æœæœ‰æˆªå›¾ï¼‰
- ä»æè¿°ä¸­æå–å…³é”®ä¿¡æ¯ï¼ˆé¡µé¢è·¯å¾„ã€ç»„ä»¶åã€æ“ä½œç±»å‹ï¼‰

## Step 2: å®šä½å…¥å£
- å¦‚æœæœ‰ URL/è·¯ç”±ä¿¡æ¯ â†’ æœç´¢è·¯ç”±é…ç½® â†’ æ‰¾åˆ°é¡µé¢ç»„ä»¶
- å¦‚æœæœ‰ UI å…ƒç´ æè¿° â†’ æœç´¢ç»„ä»¶å/æ–‡æ¡ˆå…³é”®è¯
- å¦‚æœæœ‰é”™è¯¯ä¿¡æ¯ â†’ æœç´¢é”™è¯¯æ–‡æ¡ˆ

## Step 3: è¿½è¸ªè°ƒç”¨é“¾
- ä»å…¥å£æ–‡ä»¶å‘ä¸‹è¿½è¸ª: é¡µé¢ â†’ ç»„ä»¶ â†’ hooks â†’ API è°ƒç”¨ â†’ åç«¯ Controller â†’ Service
- æˆ–ä»é”™è¯¯å‘ä¸Šè¿½è¸ª: é”™è¯¯ä½ç½® â†’ è°ƒç”¨è€… â†’ è§¦å‘æ¡ä»¶

## Step 4: ç¡®è®¤æ ¹å› 
- æ‰¾åˆ°å¯ç–‘ä»£ç åï¼Œåˆ†æå…¶é€»è¾‘æ˜¯å¦ä¸ç¼ºé™·æè¿°çš„ç°è±¡ä¸€è‡´
- æ£€æŸ¥æœ€è¿‘çš„ git commit æ˜¯å¦å¼•å…¥äº†è¿™ä¸ªé—®é¢˜

## Step 5: è¯„ä¼°å½±å“
- è¿™ä¸ªé—®é¢˜å½±å“äº†å“ªäº›åŠŸèƒ½ï¼Ÿ
- ä¿®å¤å®ƒå¯èƒ½å½±å“å“ªäº›å…¶ä»–ä»£ç ï¼Ÿ

# é¡¹ç›®ä¸Šä¸‹æ–‡

- ä»“åº“: {{repoName}}
- è¯­è¨€: {{language}}
- æ¡†æ¶: {{framework}}
- ç›¸å…³ç›®å½•: {{relevantPaths}}
- æ¨¡å—: {{moduleName}}

# è¾“å‡ºè¦æ±‚

å®Œæˆåˆ†æåï¼Œä½¿ç”¨ submit_analysis å·¥å…·æäº¤ç»“è®ºã€‚

å®šä½ç»“æœå¿…é¡»åŒ…å«ï¼š
- å…·ä½“çš„æ–‡ä»¶è·¯å¾„å’Œè¡Œå·
- æ¯ä¸ªæ–‡ä»¶ä¸ºä»€ä¹ˆä¸é—®é¢˜ç›¸å…³ï¼ˆé€»è¾‘é“¾ï¼‰
- ç½®ä¿¡åº¦è¯„åˆ†ï¼ˆ0.0~1.0ï¼‰

ä¿®å¤å»ºè®®å¿…é¡»åŒ…å«ï¼š
- ä¿®å¤ç­‰çº§åˆ¤æ–­ (auto/semi_auto/manual)
- å¦‚æœæ˜¯ auto: å…·ä½“çš„ä»£ç å˜æ›´ (unified diff æ ¼å¼)
- å¦‚æœæ˜¯ semi_auto: ä¿®å¤æ€è·¯å’Œå…³é”®ä»£ç 
- å¦‚æœæ˜¯ manual: é—®é¢˜åˆ†ææŠ¥å‘Šå’Œå»ºè®®æ–¹å‘

# é‡è¦çº¦æŸ

- æœ€å¤šä½¿ç”¨ 15 æ¬¡å·¥å…·è°ƒç”¨
- ä¼˜å…ˆä½¿ç”¨ search_code ç¼©å°èŒƒå›´ï¼Œä¸è¦ä¸€å¼€å§‹å°± read_file å¤§æ–‡ä»¶
- å¦‚æœ 5 æ¬¡æœç´¢åä»æ— æ³•å®šä½ï¼Œé™çº§ä¸º "need_manual_fix"
- ä¸è¦çŒœæµ‹â€”â€”å¦‚æœä¸ç¡®å®šï¼Œæ ‡æ˜ç½®ä¿¡åº¦ä½è€Œä¸æ˜¯ç¼–é€ ç†ç”±
```

#### 18.6.3 ä¿®å¤ç”Ÿæˆæç¤ºè¯ (Fix Prompt)

```markdown
# è§’è‰²

ä½ æ˜¯ä¸€ä¸ªä»£ç ä¿®å¤ä¸“å®¶ã€‚åŸºäºå‰åºåˆ†æçš„å®šä½ç»“æœï¼Œä½ éœ€è¦ç”Ÿæˆå…·ä½“çš„ä¿®å¤ä»£ç ã€‚

# å·²çŸ¥ä¿¡æ¯

## ç¼ºé™·ä¿¡æ¯
{{defectTitle}}
{{defectDescription}}

## åˆ†æç»“è®º
{{previousAnalysis.rootCause}}

## å®šä½æ–‡ä»¶
{{#each previousAnalysis.locatedFiles}}
- {{this.path}}:{{this.startLine}}-{{this.endLine}} ({{this.reason}})
{{/each}}

# ä»»åŠ¡

è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. è¯»å–å®šä½åˆ°çš„æ–‡ä»¶çš„å®Œæ•´å†…å®¹ (ä½¿ç”¨ read_file)
2. ç†è§£å½“å‰ä»£ç çš„å®Œæ•´ä¸Šä¸‹æ–‡
3. ç”Ÿæˆä¿®å¤ä»£ç 

# ä¿®å¤è¦æ±‚

- æœ€å°åŒ–æ”¹åŠ¨ï¼šåªæ”¹å¿…é¡»æ”¹çš„ï¼Œä¸åšé‡æ„
- ä¿æŒä»£ç é£æ ¼ä¸€è‡´ï¼šç¼©è¿›ã€å‘½åã€æ³¨é‡Šé£æ ¼ä¸å‘¨å›´ä»£ç ä¸€è‡´
- ä¸å¼•å…¥æ–°ä¾èµ–ï¼ˆé™¤éç»å¯¹å¿…è¦ï¼‰
- è€ƒè™‘è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯å¤„ç†
- å¦‚æœæ¶‰åŠ UI å˜æ›´ï¼Œç¡®ä¿ä¸å½±å“å¸ƒå±€

# è¾“å‡ºæ ¼å¼

ä½¿ç”¨ submit_analysis å·¥å…·æäº¤ä¿®å¤ç»“æœï¼š
- fix_suggestion.level: "auto"
- fix_suggestion.patch: unified diff æ ¼å¼
  ```
  --- a/path/to/file.tsx
  +++ b/path/to/file.tsx
  @@ -45,7 +45,8 @@
   context line
  -old line
  +new line
   context line
  ```
- fix_suggestion.affectedFiles: å˜æ›´çš„æ–‡ä»¶åˆ—è¡¨
- fix_suggestion.riskAssessment: é£é™©è¯„ä¼°
- fix_suggestion.testSuggestions: å»ºè®®çš„æµ‹è¯•ç‚¹

# ç¦æ­¢æ“ä½œ

- ä¸è¦åˆ é™¤çœ‹èµ·æ¥æ— å…³çš„ä»£ç 
- ä¸è¦æ·»åŠ æ³¨é‡Šè¯´æ˜è¿™æ˜¯ AI ç”Ÿæˆçš„ä¿®å¤
- ä¸è¦ä¿®æ”¹ä¸ç›¸å…³çš„æ–‡ä»¶
- ä¸è¦å‡çº§ä¾èµ–ç‰ˆæœ¬
```

#### 18.6.4 æˆªå›¾åˆ†ææç¤ºè¯ (Vision Prompt)

```markdown
# è§’è‰²

ä½ æ˜¯ä¸€ä¸ª UI ç¼ºé™·åˆ†æä¸“å®¶ã€‚è¯·åˆ†ææä¾›çš„æˆªå›¾ï¼Œè¯†åˆ«å…¶ä¸­çš„ UI é—®é¢˜ã€‚

# åˆ†æè¦æ±‚

è¯·è¯†åˆ«å¹¶æè¿°ï¼š

1. **é¡µé¢å®šä½**
   - è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„é¡µé¢ï¼Ÿ(ç™»å½•ã€åˆ—è¡¨ã€è¡¨å•ã€å¯¹è¯æ¡†ç­‰)
   - é¡µé¢ä¸Šæœ‰å“ªäº›å…³é”® UI å…ƒç´ ï¼Ÿ
   - èƒ½å¦ä» URL æ æˆ–é¢åŒ…å±‘ç¡®å®šé¡µé¢è·¯å¾„ï¼Ÿ

2. **é—®é¢˜å®šä½**
   - æˆªå›¾ä¸­æ ‡çº¢/æ ‡æ³¨çš„åŒºåŸŸï¼ˆå¦‚æœæœ‰ï¼‰
   - å“ªäº› UI å…ƒç´ çœ‹èµ·æ¥å¼‚å¸¸ï¼Ÿ
   - é—®é¢˜çš„è§†è§‰è¡¨ç°æ˜¯ä»€ä¹ˆï¼Ÿ(é”™ä½ã€ç¼ºå¤±ã€é‡å ã€ç©ºç™½ç­‰)

3. **æŠ€æœ¯æ¨æ–­**
   - åŸºäº UI å…ƒç´ æ¨æ–­å¯èƒ½çš„ç»„ä»¶å (Button, Input, Table, Modal ç­‰)
   - åŸºäºé¡µé¢å†…å®¹æ¨æ–­å¯èƒ½çš„è·¯ç”±è·¯å¾„
   - åŸºäºé”™è¯¯è¡¨ç°æ¨æ–­å¯èƒ½çš„æŠ€æœ¯åŸå›  (CSSé—®é¢˜ï¼Ÿæ•°æ®ä¸ºç©ºï¼Ÿäº‹ä»¶ç»‘å®šï¼Ÿ)

# è¾“å‡ºæ ¼å¼

{
  "pageType": "login | list | form | dialog | ...",
  "routeGuess": "/suspected/route/path",
  "uiElements": ["Input", "Button", "..."],
  "problemDescription": "å¯è§çš„é—®é¢˜æè¿°",
  "technicalGuess": "å¯èƒ½çš„æŠ€æœ¯åŸå› ",
  "componentGuess": "çŒœæµ‹çš„ç»„ä»¶å",
  "searchKeywords": ["å»ºè®®æœç´¢çš„å…³é”®è¯1", "å…³é”®è¯2"]
}
```

---

### 18.7 æ‰§è¡Œç¯å¢ƒä¸å®‰å…¨éš”ç¦»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä»£ç åˆ†æå®‰å…¨æ²™ç®±                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  é—®é¢˜: AI Agent æœ‰å·¥å…·å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œå¦‚ä½•é˜²æ­¢è¶Šæƒï¼Ÿ                        â”‚
â”‚                                                                         â”‚
â”‚  å®‰å…¨æªæ–½:                                                               â”‚
â”‚                                                                         â”‚
â”‚  1. è·¯å¾„æ²™ç®±                                                             â”‚
â”‚  â”œâ”€ æ‰€æœ‰æ–‡ä»¶æ“ä½œé™å®šåœ¨ clone ç›®å½•å†…                                      â”‚
â”‚  â”œâ”€ ç¦æ­¢ ../ è·¯å¾„ç©¿è¶Š                                                   â”‚
â”‚  â”œâ”€ ç¦æ­¢ç»å¯¹è·¯å¾„                                                        â”‚
â”‚  â””â”€ ç¦æ­¢ç¬¦å·é“¾æ¥è·Ÿéš                                                    â”‚
â”‚                                                                         â”‚
â”‚  2. æ–‡ä»¶ç±»å‹é™åˆ¶                                                         â”‚
â”‚  â”œâ”€ åªè¯»å–æ–‡æœ¬æ–‡ä»¶ (æºä»£ç ã€é…ç½®ã€æ–‡æ¡£)                                   â”‚
â”‚  â”œâ”€ è·³è¿‡: .env, credentials.*, *.key, *.pem                            â”‚
â”‚  â”œâ”€ è·³è¿‡: node_modules/, .git/objects/, dist/                           â”‚
â”‚  â””â”€ æ–‡ä»¶å¤§å°ä¸Šé™: å•æ–‡ä»¶ 500KB                                          â”‚
â”‚                                                                         â”‚
â”‚  3. å·¥å…·æƒé™åˆ†çº§                                                         â”‚
â”‚  â”œâ”€ åˆ†æé˜¶æ®µ: åªæœ‰ read ç±»å·¥å…· (search, read, list, find_ref)           â”‚
â”‚  â”œâ”€ ä¿®å¤é˜¶æ®µ: å¯ä»¥ read + ç”Ÿæˆ patch (ä¸ç›´æ¥å†™å…¥)                       â”‚
â”‚  â””â”€ åº”ç”¨é˜¶æ®µ: ç”± FixWorker ç‹¬ç«‹æ‰§è¡Œ (ä¸åœ¨ Agent å¾ªç¯å†…)                 â”‚
â”‚                                                                         â”‚
â”‚  4. èµ„æºé™åˆ¶                                                             â”‚
â”‚  â”œâ”€ å•æ¬¡åˆ†æ: æœ€å¤š 15 è½®å·¥å…·è°ƒç”¨                                        â”‚
â”‚  â”œâ”€ Token é¢„ç®—: 100K tokens / ä»»åŠ¡                                      â”‚
â”‚  â”œâ”€ æ—¶é—´é™åˆ¶: 5 åˆ†é’Ÿ / ä»»åŠ¡                                             â”‚
â”‚  â”œâ”€ Clone ç£ç›˜: 1GB / ä»“åº“ (è¶…è¿‡åˆ™æ‹’ç»)                                â”‚
â”‚  â””â”€ å¹¶å‘: æœ€å¤š 3 ä¸ªåŒæ—¶åˆ†æä»»åŠ¡                                          â”‚
â”‚                                                                         â”‚
â”‚  5. Clone ç”Ÿå‘½å‘¨æœŸ                                                       â”‚
â”‚  â”œâ”€ åˆ†æå¼€å§‹ â†’ åˆ›å»ºä¸´æ—¶ç›®å½• â†’ clone                                     â”‚
â”‚  â”œâ”€ åˆ†æç»“æŸ â†’ ç«‹å³åˆ é™¤ä¸´æ—¶ç›®å½•                                          â”‚
â”‚  â”œâ”€ å®šæ—¶æ¸…ç†: 1å°æ—¶æœªä½¿ç”¨çš„ clone ç›®å½•è‡ªåŠ¨åˆ é™¤                            â”‚
â”‚  â””â”€ ç£ç›˜å‘Šè­¦: æ€» clone ç›®å½•è¶…è¿‡ 10GB â†’ è§¦å‘æ¸…ç†                          â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 18.8 å®Œæ•´æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ç¼ºé™·å¤„ç†å®Œæ•´æ•°æ®æµ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  æäº¤è€…                          ç³»ç»Ÿ                          GitHub    â”‚
â”‚  â”€â”€â”€â”€â”€                          â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€    â”‚
â”‚    â”‚                              â”‚                              â”‚      â”‚
â”‚    â”‚  1. æäº¤ç¼ºé™·                  â”‚                              â”‚      â”‚
â”‚    â”‚  (æ ‡é¢˜+æè¿°+æˆªå›¾+äº§å“)         â”‚                              â”‚      â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                              â”‚      â”‚
â”‚    â”‚                              â”‚                              â”‚      â”‚
â”‚    â”‚                              â”‚  2. åˆ›å»º Run                  â”‚      â”‚
â”‚    â”‚                              â”‚  å…¥é˜Ÿ DefectReview            â”‚      â”‚
â”‚    â”‚                              â”‚                              â”‚      â”‚
â”‚    â”‚                              â”‚  â”Œâ”€â”€â”€ ReviewWorker â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
â”‚    â”‚                              â”‚  â”‚                         â”‚ â”‚      â”‚
â”‚    â”‚                              â”‚  â”‚  3. Vision åˆ†ææˆªå›¾      â”‚ â”‚      â”‚
â”‚    â”‚  SSE: "åˆ†ææˆªå›¾ä¸­..."        â”‚  â”‚     â†’ è¯†åˆ« UI å…ƒç´        â”‚ â”‚      â”‚
â”‚    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚     â†’ æ¨æ–­è·¯ç”±/ç»„ä»¶      â”‚ â”‚      â”‚
â”‚    â”‚                              â”‚  â”‚                         â”‚ â”‚      â”‚
â”‚    â”‚                              â”‚  â”‚  4. é€‰æ‹© CodeProvider    â”‚ â”‚      â”‚
â”‚    â”‚                              â”‚  â”‚     GitHub API or Clone  â”‚â”€â”¼â”€â”€â”   â”‚
â”‚    â”‚                              â”‚  â”‚                         â”‚ â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚  â”‚  5. Agent Loop           â”‚ â”‚  â”‚   â”‚
â”‚    â”‚  SSE: "æœç´¢ 'LoginForm'..."  â”‚  â”‚     search_code â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€â”¤   â”‚
â”‚    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚     read_file â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€â”¤   â”‚
â”‚    â”‚  SSE: "è¯»å–æ–‡ä»¶..."          â”‚  â”‚     find_references â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€â”¤   â”‚
â”‚    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚     ...                  â”‚ â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚  â”‚     (æœ€å¤š 15 è½®)         â”‚ â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚  â”‚                         â”‚ â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚  â”‚  6. submit_analysis      â”‚ â”‚  â”‚   â”‚
â”‚    â”‚  SSE: "åˆ†æå®Œæˆ"             â”‚  â”‚     â†’ ä¿å­˜ Review        â”‚ â”‚  â”‚   â”‚
â”‚    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚     â†’ æ›´æ–° Status        â”‚ â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚                              â”‚  â”‚   â”‚
â”‚    â”‚  7. æŸ¥çœ‹åˆ†æç»“æœ              â”‚                              â”‚  â”‚   â”‚
â”‚    â”‚  (å®šä½+æ ¹å› +ä¿®å¤å»ºè®®)          â”‚                              â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚                              â”‚  â”‚   â”‚
â”‚    â”‚  8. [ç¡®è®¤ä¿®å¤]               â”‚                              â”‚  â”‚   â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                              â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚  å…¥é˜Ÿ DefectFix              â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚                              â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚  â”Œâ”€â”€â”€ FixWorker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚    â”‚                              â”‚  â”‚                         â”‚ â”‚  â”‚   â”‚
â”‚    â”‚  SSE: "ç”Ÿæˆä¿®å¤ä»£ç ..."      â”‚  â”‚  9. Clone ä»“åº“           â”‚â”€â”¼â”€â”€â”˜   â”‚
â”‚    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚                         â”‚ â”‚      â”‚
â”‚    â”‚                              â”‚  â”‚  10. Agent ç”Ÿæˆ Patch    â”‚ â”‚      â”‚
â”‚    â”‚                              â”‚  â”‚                         â”‚ â”‚      â”‚
â”‚    â”‚                              â”‚  â”‚  11. åˆ›å»ºåˆ†æ”¯ + Commit   â”‚ â”‚      â”‚
â”‚    â”‚                              â”‚  â”‚                         â”‚ â”‚      â”‚
â”‚    â”‚  SSE: "åˆ›å»º PR..."           â”‚  â”‚  12. Push + Create PR â”€â”€â”¼â”€â”¼â”€â”€â–¶â”‚  â”‚
â”‚    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚                         â”‚ â”‚   â”‚  â”‚
â”‚    â”‚                              â”‚  â”‚  13. ä¿å­˜ Fix è®°å½•      â”‚ â”‚   â”‚  â”‚
â”‚    â”‚                              â”‚  â”‚      æ›´æ–°çŠ¶æ€ â†’ PrCreatedâ”‚ â”‚   â”‚  â”‚
â”‚    â”‚                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚  â”‚
â”‚    â”‚                              â”‚                              â”‚   â”‚  â”‚
â”‚    â”‚                              â”‚  14. Webhook: PR merged â—€â”€â”€â”€â”€â”¼â”€â”€â”€â”˜  â”‚
â”‚    â”‚                              â”‚      â†’ æ›´æ–°çŠ¶æ€ â†’ Merged     â”‚      â”‚
â”‚    â”‚                              â”‚                              â”‚      â”‚
â”‚    â”‚  15. [ç¡®è®¤ä¿®å¤]              â”‚                              â”‚      â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                              â”‚      â”‚
â”‚    â”‚                              â”‚  â†’ çŠ¶æ€ Verified â†’ Closed   â”‚      â”‚
â”‚    â”‚                              â”‚                              â”‚      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 18.9 Bug Bot å†³ç­–ï¼šè‡ªå»º vs å¯¹æ¥

#### æœ€ç»ˆæ¨èæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Bug Bot åˆ†å±‚æ¶æ„ (æ¨è)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Layer 1: è°ƒåº¦å±‚ (DefectReviewWorker / DefectFixWorker)          â”‚   â”‚
â”‚  â”‚  èŒè´£: ä»»åŠ¡ç®¡ç†ã€çŠ¶æ€æµè½¬ã€SSE æ¨é€ã€ç»“æœå­˜å‚¨                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Layer 2: Agent æŠ½è±¡å±‚ (IDefectAnalyzer / IDefectFixer)          â”‚   â”‚
â”‚  â”‚  èŒè´£: ç»Ÿä¸€æ¥å£ï¼Œå±è”½åº•å±‚å®ç°å·®å¼‚                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚                      â”‚                       â”‚               â”‚
â”‚          â–¼                      â–¼                       â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ å†…ç½® Agent    â”‚    â”‚ Claude Code Agentâ”‚    â”‚ æœªæ¥æ‰©å±•...       â”‚      â”‚
â”‚  â”‚ (è‡ªå»ºæ–¹æ¡ˆB)   â”‚    â”‚ (å¯¹æ¥æ–¹æ¡ˆC)       â”‚    â”‚ (å…¶ä»– Agent)      â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ LLM Tool-Use â”‚    â”‚ CLI å­è¿›ç¨‹        â”‚    â”‚ HTTP API         â”‚      â”‚
â”‚  â”‚ + ICodeProviderâ”‚   â”‚ --output json     â”‚    â”‚ æˆ– SDK è°ƒç”¨       â”‚      â”‚
â”‚  â”‚ è½»é‡/å¯æ§     â”‚    â”‚ é‡åº¦/å¼ºåŠ›         â”‚    â”‚                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                     â”‚                                         â”‚
â”‚         â–¼                     â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  Layer 3: ä»£ç è®¿é—®å±‚ (ICodeProvider)       â”‚                           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  â”‚ GitHub API   â”‚  Local Clone (ripgrep)    â”‚                           â”‚
â”‚  â”‚ (MVP)        â”‚  (v1.5)                   â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                         â”‚
â”‚  è·¯ç”±ç­–ç•¥ (ç”± Layer 1 å†³å®š):                                             â”‚
â”‚  â”œâ”€ ç®€å• Bug (ç½®ä¿¡åº¦é«˜ + æ”¹åŠ¨å°) â†’ å†…ç½® Agent                           â”‚
â”‚  â”œâ”€ å¤æ‚ Bug (å¤šæ–‡ä»¶ + é€»è¾‘é“¾) â†’ Claude Code Agent                     â”‚
â”‚  â””â”€ é…ç½®é¡¹: ç®¡ç†å‘˜å¯å¼ºåˆ¶æŒ‡å®šä½¿ç”¨å“ªä¸ª Agent                              â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¥å£å®šä¹‰

```csharp
/// <summary>
/// ç¼ºé™·åˆ†æå™¨æŠ½è±¡æ¥å£
/// </summary>
public interface IDefectAnalyzer
{
    /// <summary>
    /// åˆ†æä¸€ä¸ªç¼ºé™·ï¼Œè¿”å›ç»“æ„åŒ–ç»“è®º
    /// </summary>
    Task<DefectAnalysisResult> AnalyzeAsync(
        DefectReport defect,
        DefectRepoConfig repoConfig,
        IProgress<string> progress,      // SSE è¿›åº¦å›è°ƒ
        CancellationToken ct);

    /// <summary>
    /// è¯¥åˆ†æå™¨èƒ½å¦å¤„ç†æ­¤ç¼ºé™·ï¼Ÿ(ç”¨äºè·¯ç”±å†³ç­–)
    /// </summary>
    bool CanHandle(DefectReport defect, FixLevel suggestedLevel);
}

/// <summary>
/// ç¼ºé™·ä¿®å¤å™¨æŠ½è±¡æ¥å£
/// </summary>
public interface IDefectFixer
{
    /// <summary>
    /// ç”Ÿæˆä¿®å¤å¹¶åˆ›å»º PR
    /// </summary>
    Task<DefectFixResult> FixAsync(
        DefectReport defect,
        DefectReview analysis,           // å‰åºåˆ†æç»“è®º
        DefectRepoConfig repoConfig,
        IProgress<string> progress,
        CancellationToken ct);
}

/// <summary>
/// å†…ç½® Agent å®ç°
/// </summary>
public class BuiltInDefectAnalyzer : IDefectAnalyzer
{
    // æ–¹æ¡ˆ B: LLM Tool-Use Agent Loop
    public bool CanHandle(DefectReport defect, FixLevel level)
        => level == FixLevel.Auto;  // åªå¤„ç†ç®€å• Bug
}

/// <summary>
/// Claude Code å¯¹æ¥å®ç°
/// </summary>
public class ClaudeCodeDefectAnalyzer : IDefectAnalyzer
{
    // æ–¹æ¡ˆ C: CLI å­è¿›ç¨‹
    public bool CanHandle(DefectReport defect, FixLevel level)
        => level != FixLevel.Auto;  // å¤„ç†å¤æ‚ Bug
}
```

---

### 18.10 å…³é”®å†³ç­–æ€»ç»“

| é—®é¢˜ | å†³ç­– | ç†ç”± |
|------|------|------|
| AI åœ¨å“ªå®¡æ ¸ï¼Ÿ | åœ¨ Worker è¿›ç¨‹å†…ï¼Œé€šè¿‡ Agent Loop æ‰§è¡Œ | å¤ç”¨ç°æœ‰ Run/Worker åŸºç¡€è®¾æ–½ |
| æ€ä¹ˆè¯»ä»£ç ï¼Ÿ | LLM Tool-Useï¼šç»™ LLM æä¾›æœç´¢/è¯»å–å·¥å…·ï¼Œå®ƒè‡ªä¸»æ¢ç´¢ | æ¯”é¢„é€‰æ–‡ä»¶å‡†ç¡®ï¼Œæ¯”å…¨é‡æ‰«æé«˜æ•ˆ |
| ä»£ç ä»å“ªæ¥ï¼Ÿ | MVP ç”¨ GitHub APIï¼Œv1.5 å‡çº§ä¸º Local Clone + ripgrep | æ¸è¿›å¼ï¼ŒMVP æ— éœ€æœ¬åœ°å­˜å‚¨ |
| Bug Bot è‡ªå»ºè¿˜æ˜¯å¯¹æ¥ï¼Ÿ | **è‡ªå»ºä¸ºä¸» + Claude Code å¯é€‰æ‰©å±•** | è‡ªå»ºå¯æ§æ€§å¼ºï¼›Claude Code å¤„ç†å¤æ‚åœºæ™¯ |
| Cursor èƒ½ç”¨å—ï¼Ÿ | **ä¸èƒ½**â€”â€”æ— æœåŠ¡ç«¯ API | æ¡Œé¢ IDEï¼Œä¸é€‚åˆåç«¯è‡ªåŠ¨åŒ– |
| æç¤ºè¯æ€ä¹ˆè®¾è®¡ï¼Ÿ | åˆ†é˜¶æ®µï¼šTriage â†’ Analysis â†’ Fix â†’ Visionï¼Œå„å¸å…¶èŒ | é¿å…å•ä¸€å·¨å¤§ promptï¼Œæ¯é˜¶æ®µèŒè´£æ¸…æ™° |
| å¦‚ä½•ä¿è¯å®‰å…¨ï¼Ÿ | è·¯å¾„æ²™ç®± + æ–‡ä»¶ç±»å‹è¿‡æ»¤ + èµ„æºé™åˆ¶ + æƒé™åˆ†çº§ | Agent æœ‰æ–‡ä»¶è¯»å–èƒ½åŠ›ï¼Œå¿…é¡»é˜²è¶Šæƒ |
