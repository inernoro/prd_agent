# ç¼ºé™·ç®¡ç† Agent è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**ï¼šv1.0 | **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-23 | **appKey**ï¼š`defect-agent`
>
> **å®šä½**ï¼šå°†"æ‰¾é—®é¢˜"çš„èŒè´£ä»å¼€å‘è€…ç§»äº¤ç»™äº§å“ã€æµ‹è¯•ã€ä»»ä½•äººã€‚AI è´Ÿè´£åˆå®¡ã€å¤ç°éªŒè¯ã€è‡ªåŠ¨ä¿®å¤ï¼ˆè½»é‡çº§ï¼‰ï¼Œç¨‹åºå‘˜ä»…è´Ÿè´£ Code Review å’Œåˆå¹¶ã€‚

---

## ä¸€ã€äº§å“æ¦‚è¿°

### 1.1 æ ¸å¿ƒç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ä¼ ç»Ÿæ¨¡å¼:  å‘ç°é—®é¢˜ â†’ å¼€å‘è€…æ’æŸ¥ â†’ å¼€å‘è€…ä¿®å¤ â†’ å¼€å‘è€…è‡ªæµ‹ â†’ ä¸Šçº¿      â”‚
â”‚                                                                          â”‚
â”‚   æ–°æ¨¡å¼:    ä»»ä½•äººæäº¤ â†’ AI åˆå®¡ â†’ AI å®šä½ â†’ AI ä¿®å¤ â†’ å¼€å‘è€…åˆå¹¶       â”‚
â”‚              ~~~~~~~~      ~~~~~     ~~~~~     ~~~~~     ~~~~~~~~~~       â”‚
â”‚              äº§å“/æµ‹è¯•      è¿‡æ»¤      åˆ†æ      ç”ŸæˆPR     Code Review    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç”¨æˆ·è§’è‰²

| è§’è‰² | èŒè´£ | æƒé™ |
|------|------|------|
| **æäº¤è€…** (äº§å“/æµ‹è¯•/ä»»ä½•äºº) | æäº¤ç¼ºé™·æŠ¥å‘Šã€æˆªå›¾ã€æè¿° | `defect-agent.use` |
| **AI Agent** | åˆå®¡ã€åˆ†æã€å®šä½ã€ä¿®å¤å»ºè®®/è‡ªåŠ¨ä¿®å¤ | ç³»ç»Ÿå†…ç½® |
| **å¼€å‘è€…** (å®¡æ ¸äºº) | Code Reviewã€åˆå¹¶/æ‹’ç» PR | `defect-agent.review` |
| **ç®¡ç†å‘˜** | é…ç½®è§„åˆ™ã€æŸ¥çœ‹ç»Ÿè®¡ã€ç®¡ç†ä»“åº“æˆæƒ | `defect-agent.manage` |

### 1.3 æ ¸å¿ƒä»·å€¼

- **é™ä½é—¨æ§›**ï¼šä¸æ‡‚ä»£ç ä¹Ÿèƒ½ç²¾ç¡®æè¿°å’Œå®šä½é—®é¢˜
- **AI è¿‡æ»¤**ï¼šæç¤ºè¯é©±åŠ¨çš„åˆå®¡ï¼Œè¿‡æ»¤ 80% æ— æ•ˆ/é‡å¤é—®é¢˜
- **è‡ªåŠ¨ä¿®å¤**ï¼šç®€å• Bug ç”± AI ç›´æ¥ç”Ÿæˆä¿®å¤ PR
- **åä½œé—­ç¯**ï¼šä¸ GitHub æ·±åº¦é›†æˆï¼Œå®Œæ•´çš„çŠ¶æ€æµè½¬

---

## äºŒã€ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç¼ºé™·ç®¡ç† Agent æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æäº¤ç•Œé¢  â”‚â”€â”€â”€â–¶â”‚  DefectAgent  â”‚â”€â”€â”€â–¶â”‚  AI Pipeline  â”‚â”€â”€â”€â–¶â”‚  GitHub  â”‚  â”‚
â”‚  â”‚  (å‰ç«¯)   â”‚    â”‚  Controller  â”‚    â”‚  (Worker)     â”‚    â”‚  Integrationâ”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚                                     â”‚                    â”‚      â”‚
â”‚       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚      â”‚
â”‚       â–¼              â–¼                                           â–¼      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æˆªå›¾ä¸Šä¼   â”‚   â”‚  AI åˆå®¡å¼•æ“   â”‚                          â”‚  PR ç®¡ç†  â”‚ â”‚
â”‚  â”‚ (é™„ä»¶)   â”‚   â”‚  (Prompt)    â”‚                          â”‚  Bot     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚                                        â”‚      â”‚
â”‚                        â–¼                                        â–¼      â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                 â”‚  ä»£ç åˆ†æå¼•æ“  â”‚                          â”‚ çŠ¶æ€é€šçŸ¥  â”‚ â”‚
â”‚                 â”‚  (Vision+Code)â”‚                          â”‚ (Webhook)â”‚ â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| Controller | C# .NET 8 | ç¡¬ç¼–ç  appKey: `defect-agent` |
| Worker | BackgroundService | DefectReviewWorker, DefectFixWorker |
| AI Engine | LLM (Chat + Vision + Code) | å¤šæ¨¡å‹åä½œåˆ†æ |
| å­˜å‚¨ | MongoDB | ç¼ºé™·è®°å½•ã€è¯„å®¡ç»“æœã€ä¿®å¤è®°å½• |
| å¤–éƒ¨é›†æˆ | GitHub REST API + Webhooks | PR åˆ›å»ºã€çŠ¶æ€åŒæ­¥ |
| æ¶ˆæ¯ | SSE (Run/Worker æ¨¡å¼) | å®æ—¶è¿›åº¦æ¨é€ |
| é™„ä»¶ | Attachments ç³»ç»Ÿ | æˆªå›¾/æ—¥å¿—æ–‡ä»¶ä¸Šä¼  |

---

## ä¸‰ã€å·¥ä½œæµè®¾è®¡

### 3.1 ä¸»æµç¨‹çŠ¶æ€æœº

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚              ç¼ºé™·ç”Ÿå‘½å‘¨æœŸ                     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  draft    â”‚â”€â”€â”€â–¶â”‚ submitted â”‚â”€â”€â”€â–¶â”‚ reviewing â”‚â”€â”€â”€â–¶â”‚ analyzed  â”‚â”€â”€â”€â–¶â”‚ fixing   â”‚
â”‚  (è‰ç¨¿)   â”‚    â”‚ (å·²æäº¤)   â”‚    â”‚ (AIå®¡æ ¸ä¸­) â”‚    â”‚ (å·²åˆ†æ)   â”‚    â”‚ (ä¿®å¤ä¸­)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                â”‚                              â”‚
                      â”‚                â–¼                              â–¼
                      â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚ rejected  â”‚                   â”‚ pr_createdâ”‚
                      â”‚         â”‚ (å·²é©³å›)   â”‚                   â”‚ (PRå·²åˆ›å»º)â”‚
                      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                                              â”‚
                      â”‚                                              â–¼
                      â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                                        â”‚ merged   â”‚
                      â”‚                                        â”‚ (å·²åˆå¹¶)  â”‚
                      â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                                              â”‚
                      â–¼                                              â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ closed    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ verified â”‚
               â”‚ (å·²å…³é—­)   â”‚                                    â”‚ (å·²éªŒè¯)  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 çŠ¶æ€å®šä¹‰

| çŠ¶æ€ | è¯´æ˜ | è§¦å‘æ¡ä»¶ | å¯è¿ç§»åˆ° |
|------|------|---------|---------|
| `draft` | è‰ç¨¿ï¼Œæœªæäº¤ | ç”¨æˆ·åˆ›å»º | submitted, closed |
| `submitted` | å·²æäº¤ï¼Œç­‰å¾… AI å¤„ç† | ç”¨æˆ·ç‚¹å‡»æäº¤ | reviewing, closed |
| `reviewing` | AI æ­£åœ¨å®¡æ ¸ | Worker å¼€å§‹å¤„ç† | analyzed, rejected |
| `analyzed` | AI åˆ†æå®Œæˆï¼Œç»™å‡ºç»“è®º | AI å®¡æ ¸å®Œæˆ | fixing, closed |
| `rejected` | AI åˆ¤å®šä¸ºæ— æ•ˆ/é‡å¤/æ— æ³•ä¿®å¤ | AI åˆå®¡é©³å› | submitted (ç”³è¯‰), closed |
| `fixing` | AI æ­£åœ¨ç”Ÿæˆä¿®å¤æ–¹æ¡ˆ | ç”¨æˆ·ç¡®è®¤ä¿®å¤ | pr_created |
| `pr_created` | PR å·²åˆ›å»ºï¼Œç­‰å¾… Review | GitHub PR åˆ›å»ºæˆåŠŸ | merged, closed |
| `merged` | PR å·²åˆå¹¶ | GitHub Webhook | verified, closed |
| `verified` | æäº¤è€…ç¡®è®¤å·²ä¿®å¤ | ç”¨æˆ·éªŒè¯ | closed |
| `closed` | ç»ˆæ€ | ä»»æ„é˜¶æ®µå¯å…³é—­ | â€” |

### 3.3 AI å®¡æ ¸æµæ°´çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI å®¡æ ¸ Pipeline                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Step 1: ä¿¡æ¯å®Œæ•´æ€§æ£€æŸ¥                                               â”‚
â”‚  â”œâ”€ æ ‡é¢˜æ˜¯å¦æ¸…æ™°ï¼Ÿ                                                   â”‚
â”‚  â”œâ”€ é‡ç°æ­¥éª¤æ˜¯å¦å®Œæ•´ï¼Ÿ                                                â”‚
â”‚  â”œâ”€ æˆªå›¾æ˜¯å¦æœ‰æ•ˆï¼Ÿ                                                   â”‚
â”‚  â””â”€ å¦‚ä¸å®Œæ•´ â†’ è¿”å›è¡¥å……æ„è§                                          â”‚
â”‚                                                                     â”‚
â”‚  Step 2: é‡å¤æ£€æµ‹                                                    â”‚
â”‚  â”œâ”€ å‘é‡ç›¸ä¼¼åº¦æœç´¢ (ä¸å†å²ç¼ºé™·æ¯”å¯¹)                                    â”‚
â”‚  â”œâ”€ å…³é”®è¯åŒ¹é…                                                      â”‚
â”‚  â””â”€ å¦‚é‡å¤ â†’ æ ‡è®°ä¸ºé‡å¤ï¼Œé“¾æ¥åŸ Issue                                 â”‚
â”‚                                                                     â”‚
â”‚  Step 3: å¤ç°æ€§è¯„ä¼°                                                   â”‚
â”‚  â”œâ”€ ç¯å¢ƒä¿¡æ¯æ˜¯å¦å……åˆ†ï¼Ÿ                                                â”‚
â”‚  â”œâ”€ æ­¥éª¤æ˜¯å¦å¯æ‰§è¡Œï¼Ÿ                                                  â”‚
â”‚  â””â”€ ç»™å‡ºå¤ç°ç½®ä¿¡åº¦ï¼šé«˜/ä¸­/ä½/æ— æ³•åˆ¤æ–­                                   â”‚
â”‚                                                                     â”‚
â”‚  Step 4: å½±å“è¯„ä¼°                                                    â”‚
â”‚  â”œâ”€ å½±å“èŒƒå›´ï¼šæ ¸å¿ƒåŠŸèƒ½/è¾¹ç¼˜åŠŸèƒ½/UIç¾åŒ–                                  â”‚
â”‚  â”œâ”€ ä¼˜å…ˆçº§å»ºè®®ï¼šP0(é˜»å¡)/P1(é‡è¦)/P2(ä¸€èˆ¬)/P3(ä¼˜åŒ–)                    â”‚
â”‚  â””â”€ æ”¹åŠ¨è§„æ¨¡ï¼šå¾®å°/å°/ä¸­/å¤§/é‡æ„                                      â”‚
â”‚                                                                     â”‚
â”‚  Step 5: ä»£ç å®šä½ (Vision + Code Analysis)                           â”‚
â”‚  â”œâ”€ æˆªå›¾ â†’ Vision æ¨¡å‹è¯†åˆ« UI å…ƒç´                                     â”‚
â”‚  â”œâ”€ UI å…ƒç´  â†’ ä»£ç æœç´¢å®šä½ç»„ä»¶                                        â”‚
â”‚  â”œâ”€ ç»„ä»¶ â†’ è¿½è¸ªæ•°æ®æµ/é€»è¾‘é“¾                                          â”‚
â”‚  â””â”€ è¾“å‡ºï¼šå¯ç–‘æ–‡ä»¶åˆ—è¡¨ + è¡Œå· + åˆ†æç†ç”±                               â”‚
â”‚                                                                     â”‚
â”‚  Step 6: ä¿®å¤å»ºè®®                                                    â”‚
â”‚  â”œâ”€ è½»é‡çº§ (å¯è‡ªåŠ¨ä¿®å¤)ï¼šç›´æ¥ç”Ÿæˆ Patch                                â”‚
â”‚  â”œâ”€ ä¸­ç­‰ (éœ€äººå·¥ç¡®è®¤)ï¼šç»™å‡ºä¿®å¤æ–¹æ¡ˆ + ä¼ªä»£ç                             â”‚
â”‚  â””â”€ é‡å¤§ (éœ€è®¨è®º)ï¼šç»™å‡ºåˆ†ææŠ¥å‘Š + é£é™©è¯„ä¼°                              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 æç¤ºè¯é˜¶æ®µè®¾è®¡

| é˜¶æ®µ | Prompt åç§° | è¾“å…¥ | è¾“å‡º |
|------|------------|------|------|
| åˆå®¡ | `defect-triage` | æ ‡é¢˜+æè¿°+æˆªå›¾ | å®Œæ•´æ€§åˆ¤æ–­+é‡å¤æ£€æµ‹ç»“æœ |
| åˆ†æ | `defect-analysis` | ç¼ºé™·è¯¦æƒ…+ä»£ç åº“ä¸Šä¸‹æ–‡ | å®šä½ç»“æœ+å½±å“è¯„ä¼° |
| ä¿®å¤ | `defect-fix` | å®šä½ç»“æœ+ç›¸å…³ä»£ç  | ä¿®å¤ Patch / æ–¹æ¡ˆ |
| éªŒè¯ | `defect-verify` | ä¿®å¤å‰åå¯¹æ¯” | éªŒè¯ç»“è®º |

---

## å››ã€GitHub é›†æˆ

### 4.1 æˆæƒæ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GitHub æˆæƒæ¶æ„                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  æ–¹å¼ 1: GitHub App (æ¨è)                                    â”‚
â”‚  â”œâ”€ å®‰è£…åˆ°ç›®æ ‡ä»“åº“                                            â”‚
â”‚  â”œâ”€ è‡ªåŠ¨è·å–ä»“åº“è¯»å†™æƒé™                                       â”‚
â”‚  â”œâ”€ Webhook è‡ªåŠ¨é…ç½®                                         â”‚
â”‚  â””â”€ æ”¯æŒå¤šä»“åº“ç®¡ç†                                            â”‚
â”‚                                                              â”‚
â”‚  æ–¹å¼ 2: Personal Access Token (ç®€æ˜“)                         â”‚
â”‚  â”œâ”€ ç”¨æˆ·æä¾› PAT                                             â”‚
â”‚  â”œâ”€ ç³»ç»ŸåŠ å¯†å­˜å‚¨                                              â”‚
â”‚  â”œâ”€ é€‚åˆä¸ªäºº/å°å›¢é˜Ÿ                                           â”‚
â”‚  â””â”€ éœ€è¦æ‰‹åŠ¨ç»´æŠ¤                                              â”‚
â”‚                                                              â”‚
â”‚  æ–¹å¼ 3: OAuth App (å›¢é˜Ÿ)                                     â”‚
â”‚  â”œâ”€ ç”¨æˆ· OAuth ç™»å½•æˆæƒ                                       â”‚
â”‚  â”œâ”€ è·å–ç”¨æˆ·çº§åˆ«æƒé™                                           â”‚
â”‚  â””â”€ æ“ä½œä»¥ç”¨æˆ·èº«ä»½æ‰§è¡Œ                                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ä»“åº“é…ç½®

```json
{
  "repoConfig": {
    "owner": "org-name",
    "repo": "repo-name",
    "defaultBranch": "main",
    "prBranchPrefix": "defect-agent/fix-",
    "reviewers": ["dev1", "dev2"],
    "labels": ["bug", "ai-fix"],
    "authMethod": "github-app",        // github-app | pat | oauth
    "installationId": "12345678"
  }
}
```

### 4.3 PR åˆ›å»ºæµç¨‹

```
1. AI ç”Ÿæˆä¿®å¤ Patch
       â†“
2. åˆ›å»ºåˆ†æ”¯: defect-agent/fix-{defectId}-{shortDesc}
       â†“
3. åº”ç”¨ Patch â†’ Commit
       â†“
4. åˆ›å»º PR:
   - Title: [Defect-{id}] {title}
   - Body: ç¼ºé™·æè¿° + AI åˆ†æ + ä¿®å¤è¯´æ˜ + æµ‹è¯•å»ºè®®
   - Labels: bug, ai-fix, priority-{P0-P3}
   - Reviewers: é…ç½®çš„å®¡æ ¸äºº
   - Linked Issue: (å¦‚æœ‰)
       â†“
5. é€šçŸ¥å®¡æ ¸äºº
       â†“
6. Webhook ç›‘å¬åˆå¹¶/å…³é—­äº‹ä»¶ â†’ æ›´æ–°ç¼ºé™·çŠ¶æ€
```

### 4.4 Bug Bot åä½œæ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Bug Bot å·¥ä½œæ¨¡å¼                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  ä¸Šæ¸¸ (Defect Agent):                                      â”‚
â”‚  â”œâ”€ æ¥æ”¶ç¼ºé™·æŠ¥å‘Š                                           â”‚
â”‚  â”œâ”€ AI åˆå®¡é€šè¿‡                                            â”‚
â”‚  â”œâ”€ åˆ†æå®šä½å®Œæˆ                                            â”‚
â”‚  â””â”€ è§¦å‘ä¿®å¤ä»»åŠ¡ â†’ ä¼ é€’ç»™ Bug Bot                           â”‚
â”‚                                                            â”‚
â”‚  ä¸‹æ¸¸ (Bug Bot):                                           â”‚
â”‚  â”œâ”€ æ¥æ”¶ä¿®å¤ä»»åŠ¡ (æ–‡ä»¶åˆ—è¡¨ + åˆ†æç»“è®º)                       â”‚
â”‚  â”œâ”€ æ‹‰å–ä»£ç  + ç†è§£ä¸Šä¸‹æ–‡                                   â”‚
â”‚  â”œâ”€ ç”Ÿæˆä¿®å¤ä»£ç                                             â”‚
â”‚  â”œâ”€ æœ¬åœ°éªŒè¯ (lint + test)                                  â”‚
â”‚  â”œâ”€ åˆ›å»º PR                                                â”‚
â”‚  â””â”€ å›æŠ¥ç»“æœç»™ Defect Agent                                â”‚
â”‚                                                            â”‚
â”‚  è°ƒåº¦ç­–ç•¥:                                                  â”‚
â”‚  â”œâ”€ æœ¬åœ°æ¨¡å¼ï¼šç›´æ¥åœ¨ç³»ç»Ÿå†…æ‰§è¡Œä¿®å¤                            â”‚
â”‚  â”œâ”€ PR æ¨¡å¼ï¼šFork â†’ Branch â†’ PR (å¤–éƒ¨ä»“åº“)                 â”‚
â”‚  â””â”€ Hybridï¼šç®€å•é—®é¢˜æœ¬åœ°ï¼Œå¤æ‚é—®é¢˜ PR                       â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€æ•°æ®æ¨¡å‹

### 5.1 MongoDB é›†åˆè®¾è®¡

| é›†åˆå | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|
| `defect_reports` | ç¼ºé™·æŠ¥å‘Šä¸»è¡¨ | ownerUserId, status, createdAt |
| `defect_reviews` | AI å®¡æ ¸è®°å½• | defectId, phase, createdAt |
| `defect_fixes` | ä¿®å¤è®°å½• | defectId, status |
| `defect_repo_configs` | ä»“åº“é…ç½® | ownerId |
| `defect_github_tokens` | GitHub æˆæƒå‡­æ® (åŠ å¯†) | userId |

### 5.2 æ ¸å¿ƒæ•°æ®æ¨¡å‹

```csharp
/// <summary>
/// ç¼ºé™·æŠ¥å‘Š
/// </summary>
public class DefectReport
{
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; } = null!;

    /// <summary>æäº¤è€… UserId</summary>
    public string OwnerUserId { get; set; } = null!;

    /// <summary>ç¼ºé™·æ ‡é¢˜</summary>
    public string Title { get; set; } = null!;

    /// <summary>ç¼ºé™·æè¿° (Markdown)</summary>
    public string Description { get; set; } = string.Empty;

    /// <summary>é‡ç°æ­¥éª¤</summary>
    public List<string> ReproSteps { get; set; } = new();

    /// <summary>æœŸæœ›è¡Œä¸º</summary>
    public string? ExpectedBehavior { get; set; }

    /// <summary>å®é™…è¡Œä¸º</summary>
    public string? ActualBehavior { get; set; }

    /// <summary>ç¯å¢ƒä¿¡æ¯</summary>
    public DefectEnvironment? Environment { get; set; }

    /// <summary>é™„ä»¶ ID åˆ—è¡¨ï¼ˆæˆªå›¾/æ—¥å¿—ï¼‰</summary>
    public List<string> AttachmentIds { get; set; } = new();

    /// <summary>å½“å‰çŠ¶æ€</summary>
    public DefectStatus Status { get; set; } = DefectStatus.Draft;

    /// <summary>ä¼˜å…ˆçº§ï¼ˆAI è¯„ä¼°ï¼‰</summary>
    public DefectPriority? Priority { get; set; }

    /// <summary>å½±å“èŒƒå›´ï¼ˆAI è¯„ä¼°ï¼‰</summary>
    public DefectImpact? Impact { get; set; }

    /// <summary>AI å¤ç°ç½®ä¿¡åº¦</summary>
    public ReproConfidence? ReproConfidence { get; set; }

    /// <summary>å…³è”ä»“åº“é…ç½® ID</summary>
    public string? RepoConfigId { get; set; }

    /// <summary>å…³è” GitHub Issue ç¼–å·</summary>
    public int? GithubIssueNumber { get; set; }

    /// <summary>å…³è” GitHub PR ç¼–å·</summary>
    public int? GithubPrNumber { get; set; }

    /// <summary>æŒ‡æ´¾çš„å®¡æ ¸äºº UserId</summary>
    public string? AssigneeUserId { get; set; }

    /// <summary>æ ‡ç­¾</summary>
    public List<string> Tags { get; set; } = new();

    /// <summary>é‡å¤ç¼ºé™· IDï¼ˆå¦‚è¢«æ ‡è®°ä¸ºé‡å¤ï¼‰</summary>
    public string? DuplicateOfId { get; set; }

    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
    public DateTime? ClosedAt { get; set; }
}

/// <summary>
/// ç¼ºé™·çŠ¶æ€æšä¸¾
/// </summary>
public enum DefectStatus
{
    Draft,          // è‰ç¨¿
    Submitted,      // å·²æäº¤
    Reviewing,      // AI å®¡æ ¸ä¸­
    Analyzed,       // å·²åˆ†æ
    Rejected,       // å·²é©³å›
    Fixing,         // ä¿®å¤ä¸­
    PrCreated,      // PR å·²åˆ›å»º
    Merged,         // å·²åˆå¹¶
    Verified,       // å·²éªŒè¯
    Closed          // å·²å…³é—­
}

/// <summary>
/// ä¼˜å…ˆçº§
/// </summary>
public enum DefectPriority
{
    P0_Blocker,     // é˜»å¡æ€§é—®é¢˜
    P1_Critical,    // é‡è¦é—®é¢˜
    P2_Normal,      // ä¸€èˆ¬é—®é¢˜
    P3_Minor        // ä¼˜åŒ–å»ºè®®
}

/// <summary>
/// å½±å“èŒƒå›´
/// </summary>
public enum DefectImpact
{
    CoreFunction,   // æ ¸å¿ƒåŠŸèƒ½
    EdgeFunction,   // è¾¹ç¼˜åŠŸèƒ½
    UiCosmetic,     // UI ç¾åŒ–
    Performance,    // æ€§èƒ½é—®é¢˜
    Security        // å®‰å…¨é—®é¢˜
}

/// <summary>
/// å¤ç°ç½®ä¿¡åº¦
/// </summary>
public enum ReproConfidence
{
    High,           // é«˜ï¼ˆæ­¥éª¤æ˜ç¡®ï¼Œç¯å¢ƒæ¸…æ™°ï¼‰
    Medium,         // ä¸­ï¼ˆæ­¥éª¤åŸºæœ¬æ¸…æ¥šï¼‰
    Low,            // ä½ï¼ˆä¿¡æ¯ä¸å®Œæ•´ï¼‰
    Unknown         // æ— æ³•åˆ¤æ–­
}

/// <summary>
/// ç¯å¢ƒä¿¡æ¯
/// </summary>
public class DefectEnvironment
{
    public string? Browser { get; set; }
    public string? Os { get; set; }
    public string? AppVersion { get; set; }
    public string? ScreenResolution { get; set; }
    public Dictionary<string, string>? CustomFields { get; set; }
}

/// <summary>
/// AI å®¡æ ¸è®°å½•
/// </summary>
public class DefectReview
{
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; } = null!;

    public string DefectId { get; set; } = null!;

    /// <summary>å®¡æ ¸é˜¶æ®µ</summary>
    public ReviewPhase Phase { get; set; }

    /// <summary>å®¡æ ¸ç»“è®º</summary>
    public ReviewVerdict Verdict { get; set; }

    /// <summary>AI åˆ†æå†…å®¹ (Markdown)</summary>
    public string Content { get; set; } = string.Empty;

    /// <summary>å®šä½åˆ°çš„æ–‡ä»¶åˆ—è¡¨</summary>
    public List<CodeLocation>? LocatedFiles { get; set; }

    /// <summary>ä¿®å¤å»ºè®®</summary>
    public FixSuggestion? Suggestion { get; set; }

    /// <summary>LLM è¯·æ±‚ ID (ç”¨äºè¿½è¸ª)</summary>
    public string? LlmRequestId { get; set; }

    public DateTime CreatedAt { get; set; }
}

public enum ReviewPhase { Triage, Analysis, Fix, Verify }

public enum ReviewVerdict { Pass, NeedInfo, Duplicate, Invalid, CanAutoFix, NeedManualFix, MajorChange }

/// <summary>
/// ä»£ç å®šä½ç»“æœ
/// </summary>
public class CodeLocation
{
    public string FilePath { get; set; } = null!;
    public int? StartLine { get; set; }
    public int? EndLine { get; set; }
    public string? Reason { get; set; }
    public double Confidence { get; set; }  // 0.0 ~ 1.0
}

/// <summary>
/// ä¿®å¤å»ºè®®
/// </summary>
public class FixSuggestion
{
    public FixLevel Level { get; set; }
    public string? PatchContent { get; set; }        // è½»é‡çº§ï¼šç›´æ¥ Patch
    public string? PseudoCode { get; set; }          // ä¸­ç­‰ï¼šä¼ªä»£ç æ–¹æ¡ˆ
    public string? AnalysisReport { get; set; }      // é‡å¤§ï¼šåˆ†ææŠ¥å‘Š
    public List<string>? AffectedFiles { get; set; }
    public string? RiskAssessment { get; set; }
}

public enum FixLevel { Auto, SemiAuto, Manual }

/// <summary>
/// ä¿®å¤è®°å½•
/// </summary>
public class DefectFix
{
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; } = null!;

    public string DefectId { get; set; } = null!;
    public string? ReviewId { get; set; }

    /// <summary>ä¿®å¤åˆ†æ”¯å</summary>
    public string? BranchName { get; set; }

    /// <summary>PR URL</summary>
    public string? PrUrl { get; set; }

    /// <summary>PR ç¼–å·</summary>
    public int? PrNumber { get; set; }

    /// <summary>ä¿®å¤çŠ¶æ€</summary>
    public FixStatus Status { get; set; }

    /// <summary>Commit SHA</summary>
    public string? CommitSha { get; set; }

    /// <summary>å˜æ›´çš„æ–‡ä»¶åˆ—è¡¨</summary>
    public List<FileChange>? Changes { get; set; }

    public DateTime CreatedAt { get; set; }
    public DateTime? MergedAt { get; set; }
}

public enum FixStatus { Pending, InProgress, PrCreated, Merged, Rejected, Failed }

public class FileChange
{
    public string FilePath { get; set; } = null!;
    public string ChangeType { get; set; } = null!;  // add, modify, delete
    public int LinesAdded { get; set; }
    public int LinesRemoved { get; set; }
}

/// <summary>
/// ä»“åº“é…ç½®
/// </summary>
public class DefectRepoConfig
{
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; } = null!;

    public string OwnerUserId { get; set; } = null!;
    public string RepoOwner { get; set; } = null!;
    public string RepoName { get; set; } = null!;
    public string DefaultBranch { get; set; } = "main";
    public string PrBranchPrefix { get; set; } = "defect-agent/fix-";
    public List<string> DefaultReviewers { get; set; } = new();
    public List<string> DefaultLabels { get; set; } = new() { "bug", "ai-fix" };
    public GitHubAuthMethod AuthMethod { get; set; }
    public string? InstallationId { get; set; }
    public bool IsActive { get; set; } = true;

    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
}

public enum GitHubAuthMethod { GitHubApp, PersonalAccessToken, OAuth }
```

---

## å…­ã€API è®¾è®¡

### 6.1 API ç«¯ç‚¹æ¸…å•

```
POST   /api/defect-agent/defects                    # åˆ›å»ºç¼ºé™·
GET    /api/defect-agent/defects                    # åˆ—è¡¨æŸ¥è¯¢
GET    /api/defect-agent/defects/:id                # è·å–è¯¦æƒ…
PUT    /api/defect-agent/defects/:id                # æ›´æ–°ç¼ºé™·
DELETE /api/defect-agent/defects/:id                # åˆ é™¤è‰ç¨¿

POST   /api/defect-agent/defects/:id/submit         # æäº¤å®¡æ ¸
POST   /api/defect-agent/defects/:id/fix            # è§¦å‘ä¿®å¤
POST   /api/defect-agent/defects/:id/verify         # ç¡®è®¤ä¿®å¤
POST   /api/defect-agent/defects/:id/close          # å…³é—­ç¼ºé™·
POST   /api/defect-agent/defects/:id/reopen         # é‡æ–°æ‰“å¼€/ç”³è¯‰

GET    /api/defect-agent/defects/:id/reviews         # è·å–å®¡æ ¸è®°å½•
GET    /api/defect-agent/defects/:id/fixes           # è·å–ä¿®å¤è®°å½•

POST   /api/defect-agent/defects/:id/runs            # åˆ›å»º AI å¤„ç†ä»»åŠ¡
GET    /api/defect-agent/runs/:runId/stream           # SSE å®æ—¶æµ

POST   /api/defect-agent/repos                       # æ·»åŠ ä»“åº“é…ç½®
GET    /api/defect-agent/repos                       # åˆ—è¡¨ä»“åº“é…ç½®
PUT    /api/defect-agent/repos/:id                   # æ›´æ–°ä»“åº“é…ç½®
DELETE /api/defect-agent/repos/:id                   # åˆ é™¤ä»“åº“é…ç½®

POST   /api/defect-agent/github/webhook              # GitHub Webhook æ¥æ”¶
GET    /api/defect-agent/github/auth-url             # è·å– OAuth æˆæƒ URL
POST   /api/defect-agent/github/callback             # OAuth å›è°ƒ

GET    /api/defect-agent/stats                       # ç»Ÿè®¡æ¦‚è§ˆ
GET    /api/defect-agent/stats/trends                # è¶‹åŠ¿æ•°æ®
```

### 6.2 è¯·æ±‚/å“åº”ç¤ºä¾‹

#### åˆ›å»ºç¼ºé™·

```json
// POST /api/defect-agent/defects
{
  "title": "ç™»å½•é¡µé¢éªŒè¯ç è¾“å…¥æ¡†æ— æ³•èšç„¦",
  "description": "åœ¨ Chrome æµè§ˆå™¨ä¸­ï¼Œç‚¹å‡»éªŒè¯ç è¾“å…¥æ¡†æ—¶å…‰æ ‡ä¸å‡ºç°...",
  "reproSteps": [
    "1. æ‰“å¼€ç™»å½•é¡µé¢",
    "2. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ",
    "3. ç‚¹å‡»éªŒè¯ç è¾“å…¥æ¡†",
    "4. è§‚å¯Ÿï¼šå…‰æ ‡ä¸å‡ºç°ï¼Œæ— æ³•è¾“å…¥"
  ],
  "expectedBehavior": "ç‚¹å‡»åè¾“å…¥æ¡†åº”è·å–ç„¦ç‚¹ï¼Œå…‰æ ‡é—ªçƒ",
  "actualBehavior": "ç‚¹å‡»æ— ååº”ï¼Œè¾“å…¥æ¡†ä¸èšç„¦",
  "environment": {
    "browser": "Chrome 121.0",
    "os": "macOS 14.3",
    "appVersion": "v2.1.0",
    "screenResolution": "2560x1440"
  },
  "attachmentIds": ["att_screenshot_001", "att_console_log_002"],
  "repoConfigId": "repo_config_001",
  "tags": ["login", "input", "focus"]
}
```

#### AI å®¡æ ¸ç»“æœ

```json
// GET /api/defect-agent/defects/:id/reviews
{
  "reviews": [
    {
      "id": "review_001",
      "phase": "Triage",
      "verdict": "Pass",
      "content": "## åˆå®¡ç»“è®º\n\n**ä¿¡æ¯å®Œæ•´æ€§**ï¼šâœ… é€šè¿‡...\n\n**å¤ç°ç½®ä¿¡åº¦**ï¼šé«˜...",
      "createdAt": "2025-01-23T10:00:00Z"
    },
    {
      "id": "review_002",
      "phase": "Analysis",
      "verdict": "CanAutoFix",
      "content": "## ä»£ç åˆ†æ\n\nå®šä½åˆ°é—®é¢˜æºäº...",
      "locatedFiles": [
        {
          "filePath": "src/pages/login/LoginForm.tsx",
          "startLine": 45,
          "endLine": 52,
          "reason": "éªŒè¯ç  Input ç»„ä»¶ç¼ºå°‘ tabIndex å±æ€§",
          "confidence": 0.92
        }
      ],
      "suggestion": {
        "level": "Auto",
        "patchContent": "--- a/src/pages/login/LoginForm.tsx\n+++ b/...",
        "affectedFiles": ["src/pages/login/LoginForm.tsx"],
        "riskAssessment": "ä½é£é™©ï¼šä»…æ·»åŠ  HTML å±æ€§ï¼Œä¸å½±å“é€»è¾‘"
      },
      "createdAt": "2025-01-23T10:01:00Z"
    }
  ]
}
```

---

## ä¸ƒã€å‰ç«¯è®¾è®¡

### 7.1 é¡µé¢ç»“æ„

```
prd-admin/src/pages/defect-agent/
â”œâ”€â”€ index.ts
â”œâ”€â”€ DefectListPage.tsx              # ç¼ºé™·åˆ—è¡¨ï¼ˆçœ‹æ¿/åˆ—è¡¨è§†å›¾ï¼‰
â”œâ”€â”€ DefectDetailPage.tsx            # ç¼ºé™·è¯¦æƒ… + AI å®¡æ ¸æ—¶é—´çº¿
â”œâ”€â”€ DefectSubmitPage.tsx            # æäº¤æ–°ç¼ºé™·ï¼ˆè¡¨å•ï¼‰
â”œâ”€â”€ DefectRepoSettingsPage.tsx      # ä»“åº“é…ç½®ç®¡ç†
â”œâ”€â”€ DefectStatsPage.tsx             # ç»Ÿè®¡çœ‹æ¿
â””â”€â”€ components/
    â”œâ”€â”€ DefectCard.tsx              # ç¼ºé™·å¡ç‰‡ç»„ä»¶
    â”œâ”€â”€ DefectStatusBadge.tsx       # çŠ¶æ€æ ‡ç­¾
    â”œâ”€â”€ DefectTimeline.tsx          # AI å®¡æ ¸æ—¶é—´çº¿
    â”œâ”€â”€ DefectForm.tsx              # ç¼ºé™·æäº¤è¡¨å•
    â”œâ”€â”€ DefectScreenshotUploader.tsx # æˆªå›¾ä¸Šä¼ ç»„ä»¶
    â”œâ”€â”€ DefectCodeLocator.tsx       # ä»£ç å®šä½å±•ç¤º
    â”œâ”€â”€ DefectPrViewer.tsx          # PR é¢„è§ˆç»„ä»¶
    â”œâ”€â”€ DefectKanban.tsx            # çœ‹æ¿è§†å›¾
    â””â”€â”€ DefectFilterBar.tsx         # ç­›é€‰æ 
```

### 7.2 ç•Œé¢å¸ƒå±€

#### åˆ—è¡¨é¡µ (çœ‹æ¿æ¨¡å¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¼ºé™·ç®¡ç† Agent                              [+ æ–°å»ºç¼ºé™·] [ç»Ÿè®¡] [è®¾ç½®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ç­›é€‰: çŠ¶æ€â–¼] [ä¼˜å…ˆçº§â–¼] [æ ‡ç­¾â–¼] [æœç´¢...]                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¾…å®¡æ ¸(3) â”‚ å®¡æ ¸ä¸­(1) â”‚ å·²åˆ†æ(2) â”‚ ä¿®å¤ä¸­(1) â”‚ PR(2)   â”‚ å·²åˆå¹¶(5)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚â”‚ #12    â”‚â”‚ #15    â”‚â”‚â”‚ #10    â”‚â”‚â”‚ #8     â”‚â”‚â”‚ #11    â”‚â”‚â”‚ #7         â”‚ â”‚
â”‚â”‚ P1 ğŸ”´  â”‚â”‚ P2 ğŸŸ¡  â”‚â”‚â”‚ P1 ğŸ”´  â”‚â”‚â”‚ P0 ğŸŸ£  â”‚â”‚â”‚ P2 ğŸŸ¡  â”‚â”‚â”‚ P2 ğŸŸ¡ âœ…   â”‚ â”‚
â”‚â”‚ ç™»å½•å¼‚å¸¸ â”‚â”‚ æ ·å¼é”™ä½ â”‚â”‚â”‚ æ•°æ®ä¸¢å¤± â”‚â”‚â”‚ å´©æºƒBug â”‚â”‚â”‚ APIå¼‚å¸¸ â”‚â”‚â”‚ æ’åºä¿®å¤    â”‚ â”‚
â”‚â”‚ @å¼ ä¸‰  â”‚â”‚ @æå››  â”‚â”‚â”‚ @ç‹äº”  â”‚â”‚â”‚ @èµµå…­  â”‚â”‚â”‚ @é’±ä¸ƒ  â”‚â”‚â”‚ @å­™å…«      â”‚ â”‚
â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚          â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚          â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚â”‚ #13    â”‚â”‚          â”‚â”‚ #9     â”‚â”‚          â”‚â”‚ #14    â”‚â”‚â”‚ #6         â”‚ â”‚
â”‚â”‚ ...    â”‚â”‚          â”‚â”‚ ...    â”‚â”‚          â”‚â”‚ ...    â”‚â”‚â”‚ ...        â”‚ â”‚
â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚          â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚          â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¯¦æƒ…é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† è¿”å›  #12 ç™»å½•é¡µé¢éªŒè¯ç è¾“å…¥æ¡†æ— æ³•èšç„¦         [P1 ğŸ”´] [å·²åˆ†æ]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç¼ºé™·ä¿¡æ¯                         â”‚  â”‚ AI å®¡æ ¸æ—¶é—´çº¿                 â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                 â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ æè¿°ï¼šåœ¨ Chrome æµè§ˆå™¨ä¸­...      â”‚  â”‚ â— 10:00 åˆå®¡é€šè¿‡              â”‚ â”‚
â”‚  â”‚                                 â”‚  â”‚   ä¿¡æ¯å®Œæ•´ï¼Œå¤ç°ç½®ä¿¡åº¦: é«˜     â”‚ â”‚
â”‚  â”‚ é‡ç°æ­¥éª¤ï¼š                       â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ 1. æ‰“å¼€ç™»å½•é¡µé¢                  â”‚  â”‚ â— 10:01 ä»£ç åˆ†æå®Œæˆ          â”‚ â”‚
â”‚  â”‚ 2. è¾“å…¥ç”¨æˆ·åå¯†ç                 â”‚  â”‚   å®šä½: LoginForm.tsx:45-52  â”‚ â”‚
â”‚  â”‚ 3. ç‚¹å‡»éªŒè¯ç è¾“å…¥æ¡†              â”‚  â”‚   ç»“è®º: å¯è‡ªåŠ¨ä¿®å¤            â”‚ â”‚
â”‚  â”‚ 4. å…‰æ ‡ä¸å‡ºç°                    â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚                                 â”‚  â”‚ â—‹ ç­‰å¾…ç¡®è®¤ä¿®å¤...             â”‚ â”‚
â”‚  â”‚ æˆªå›¾ï¼š                           â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ â”‚ ğŸ“· #1   â”‚ â”‚ ğŸ“· #2   â”‚        â”‚  â”‚ [ç¡®è®¤ä¿®å¤] [å…³é—­]            â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚                                 â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ ç¯å¢ƒï¼šChrome 121 / macOS 14.3   â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚                                 â”‚  â”‚                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ ä»£ç å®šä½                                                            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚  ğŸ“ src/pages/login/LoginForm.tsx  (ç½®ä¿¡åº¦: 92%)                    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â”‚ 45 â”‚  <Input                                                â”‚   â”‚
â”‚  â”‚  â”‚ 46 â”‚    type="text"                                         â”‚   â”‚
â”‚  â”‚  â”‚ 47 â”‚    placeholder="è¯·è¾“å…¥éªŒè¯ç "                            â”‚   â”‚
â”‚  â”‚  â”‚ 48 â”‚    // â† ç¼ºå°‘ tabIndex å’Œ autoFocus å¤„ç†                 â”‚   â”‚
â”‚  â”‚  â”‚ 49 â”‚    value={captcha}                                     â”‚   â”‚
â”‚  â”‚  â”‚ 50 â”‚    onChange={handleCaptchaChange}                      â”‚   â”‚
â”‚  â”‚  â”‚ 51 â”‚  />                                                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æäº¤é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æäº¤æ–°ç¼ºé™·                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  æ ‡é¢˜ *                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç®€è¦æè¿°é—®é¢˜ç°è±¡...                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  é—®é¢˜æè¿° *                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ (Markdown ç¼–è¾‘å™¨)                                                 â”‚  â”‚
â”‚  â”‚ è¯¦ç»†æè¿°ä½ é‡åˆ°çš„é—®é¢˜...                                            â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  é‡ç°æ­¥éª¤ *                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. [æ­¥éª¤è¾“å…¥æ¡†]                                        [+ æ·»åŠ ]  â”‚  â”‚
â”‚  â”‚ 2. [æ­¥éª¤è¾“å…¥æ¡†]                                        [- åˆ é™¤]  â”‚  â”‚
â”‚  â”‚ 3. [æ­¥éª¤è¾“å…¥æ¡†]                                        [- åˆ é™¤]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  æˆªå›¾/é™„ä»¶                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“ æ‹–æ‹½ä¸Šä¼ æˆ–ç‚¹å‡»é€‰æ‹©  (æ”¯æŒ: PNG, JPG, GIF, MP4, LOG)           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                                       â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ“·1 â”‚ â”‚ ğŸ“·2 â”‚ â”‚  +  â”‚                                       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  ç¯å¢ƒä¿¡æ¯                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ æµè§ˆå™¨    â”‚  â”‚ æ“ä½œç³»ç»Ÿ   â”‚  â”‚ åº”ç”¨ç‰ˆæœ¬   â”‚  â”‚ åˆ†è¾¨ç‡    â”‚             â”‚
â”‚  â”‚ [è‡ªåŠ¨æ£€æµ‹]â”‚  â”‚ [è‡ªåŠ¨æ£€æµ‹]â”‚  â”‚ [v2.1.0] â”‚  â”‚ [2560x..] â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                        â”‚
â”‚  å…³è”ä»“åº“                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [é€‰æ‹©å·²é…ç½®çš„ä»“åº“ â–¼]                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚  æ ‡ç­¾                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [login] [input] [focus] [+ æ·»åŠ æ ‡ç­¾]                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â”‚                                    [ä¿å­˜è‰ç¨¿]  [æäº¤å®¡æ ¸ â†’]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 Store è®¾è®¡ (Zustand)

```typescript
interface DefectAgentStore {
  // åˆ—è¡¨
  defects: DefectReport[];
  loading: boolean;
  filter: DefectFilter;
  viewMode: 'kanban' | 'list';

  // å½“å‰è¯¦æƒ…
  currentDefect: DefectReport | null;
  currentReviews: DefectReview[];
  currentFixes: DefectFix[];

  // å®æ—¶å¤„ç†
  activeRunId: string | null;
  streamEvents: StreamEvent[];

  // Actions
  fetchDefects: () => Promise<void>;
  fetchDefectDetail: (id: string) => Promise<void>;
  createDefect: (input: CreateDefectInput) => Promise<string>;
  submitDefect: (id: string) => Promise<void>;
  triggerFix: (id: string) => Promise<void>;
  verifyFix: (id: string) => Promise<void>;
  closeDefect: (id: string) => Promise<void>;

  // SSE
  subscribeToRun: (runId: string) => void;
  unsubscribeFromRun: () => void;
}
```

---

## å…«ã€AppCaller æ³¨å†Œ

### 8.1 LLM è°ƒç”¨æ ‡è¯†

```csharp
public static class DefectAgent
{
    public const string AppName = "Defect Agent";

    public static class Triage
    {
        [AppCallerMetadata(
            "ç¼ºé™·åˆå®¡",
            "æ£€æŸ¥ä¿¡æ¯å®Œæ•´æ€§ã€é‡å¤æ£€æµ‹ã€å¤ç°æ€§è¯„ä¼°",
            ModelTypes = new[] { ModelTypes.Chat, ModelTypes.Vision },
            Category = "Triage"
        )]
        public const string Review = "defect-agent.triage::chat";

        [AppCallerMetadata(
            "æˆªå›¾åˆ†æ",
            "åˆ†æç¼ºé™·æˆªå›¾ä¸­çš„ UI å…ƒç´ ",
            ModelTypes = new[] { ModelTypes.Vision },
            Category = "Triage"
        )]
        public const string ScreenshotAnalysis = "defect-agent.triage::vision";
    }

    public static class Analysis
    {
        [AppCallerMetadata(
            "ä»£ç å®šä½",
            "æ ¹æ®ç¼ºé™·æè¿°å®šä½ç›¸å…³ä»£ç ",
            ModelTypes = new[] { ModelTypes.Code },
            Category = "Analysis"
        )]
        public const string CodeLocate = "defect-agent.analysis::code";

        [AppCallerMetadata(
            "å½±å“åˆ†æ",
            "è¯„ä¼°ç¼ºé™·å½±å“èŒƒå›´å’Œä¿®å¤ä»£ä»·",
            ModelTypes = new[] { ModelTypes.Chat },
            Category = "Analysis"
        )]
        public const string ImpactAssess = "defect-agent.analysis::chat";
    }

    public static class Fix
    {
        [AppCallerMetadata(
            "ç”Ÿæˆä¿®å¤",
            "ç”Ÿæˆä¿®å¤ä»£ç  Patch",
            ModelTypes = new[] { ModelTypes.Code },
            Category = "Fix"
        )]
        public const string Generate = "defect-agent.fix::code";

        [AppCallerMetadata(
            "ä¿®å¤éªŒè¯",
            "éªŒè¯ä¿®å¤åçš„ä»£ç æ­£ç¡®æ€§",
            ModelTypes = new[] { ModelTypes.Code },
            Category = "Fix"
        )]
        public const string Verify = "defect-agent.fix.verify::code";
    }
}
```

### 8.2 æ¨¡å‹éœ€æ±‚æ€»ç»“

| App Caller Key | è¯´æ˜ | æ¨¡å‹ç±»å‹ |
|---------------|------|---------|
| `defect-agent.triage::chat` | ç¼ºé™·åˆå®¡ | chat |
| `defect-agent.triage::vision` | æˆªå›¾åˆ†æ | vision |
| `defect-agent.analysis::code` | ä»£ç å®šä½ | code |
| `defect-agent.analysis::chat` | å½±å“åˆ†æ | chat |
| `defect-agent.fix::code` | ç”Ÿæˆä¿®å¤ | code |
| `defect-agent.fix.verify::code` | ä¿®å¤éªŒè¯ | code |

---

## ä¹ã€æƒé™è®¾è®¡

### 9.1 æƒé™ç‚¹

```csharp
// AdminPermissionCatalog.cs
public const string DefectAgentUse = "defect-agent.use";
public const string DefectAgentReview = "defect-agent.review";
public const string DefectAgentManage = "defect-agent.manage";
```

### 9.2 æƒé™çŸ©é˜µ

| æ“ä½œ | use | review | manage |
|------|-----|--------|--------|
| æŸ¥çœ‹ç¼ºé™·åˆ—è¡¨ | âœ… | âœ… | âœ… |
| æäº¤ç¼ºé™· | âœ… | âœ… | âœ… |
| æŸ¥çœ‹ AI å®¡æ ¸ç»“æœ | âœ… | âœ… | âœ… |
| è§¦å‘è‡ªåŠ¨ä¿®å¤ | âŒ | âœ… | âœ… |
| åˆå¹¶/æ‹’ç» PR | âŒ | âœ… | âœ… |
| ç®¡ç†ä»“åº“é…ç½® | âŒ | âŒ | âœ… |
| ç®¡ç† GitHub æˆæƒ | âŒ | âŒ | âœ… |
| æŸ¥çœ‹ç»Ÿè®¡æ•°æ® | âŒ | âœ… | âœ… |

### 9.3 èœå•å®šä¹‰

```csharp
// AdminMenuCatalog.cs
new("defect-agent", "/defect-agent", "ç¼ºé™·ç®¡ç† Agent", "AI é©±åŠ¨çš„ç¼ºé™·æ£€æµ‹ä¸ä¿®å¤", "Bug", 85),
```

---

## åã€Worker è®¾è®¡

### 10.1 DefectReviewWorker

```csharp
/// <summary>
/// AI å®¡æ ¸ Workerï¼šæ‰§è¡Œåˆå®¡ â†’ åˆ†æ â†’ å®šä½ Pipeline
/// </summary>
public sealed class DefectReviewWorker : BackgroundService
{
    // é˜Ÿåˆ—ï¼šRunKinds.DefectReview
    // å¤„ç†æµç¨‹ï¼š
    // 1. Dequeue defectId
    // 2. åŠ è½½ç¼ºé™·è¯¦æƒ… + é™„ä»¶
    // 3. Step 1: ä¿¡æ¯å®Œæ•´æ€§ (chat)
    // 4. Step 2: é‡å¤æ£€æµ‹ (embedding ç›¸ä¼¼åº¦)
    // 5. Step 3: æˆªå›¾åˆ†æ (vision)
    // 6. Step 4: ä»£ç å®šä½ (code)
    // 7. Step 5: å½±å“è¯„ä¼° (chat)
    // 8. Step 6: ä¿®å¤å»ºè®®ç”Ÿæˆ (code)
    // 9. å­˜å‚¨ Review è®°å½•
    // 10. æ›´æ–°ç¼ºé™·çŠ¶æ€ â†’ Analyzed / Rejected
    // 11. é€šè¿‡ IRunEventStore å‘é€ SSE äº‹ä»¶
}
```

### 10.2 DefectFixWorker

```csharp
/// <summary>
/// ä¿®å¤ Workerï¼šç”Ÿæˆ Patch â†’ åˆ›å»º PR
/// </summary>
public sealed class DefectFixWorker : BackgroundService
{
    // é˜Ÿåˆ—ï¼šRunKinds.DefectFix
    // å¤„ç†æµç¨‹ï¼š
    // 1. Dequeue defectId
    // 2. åŠ è½½åˆ†æç»“æœ (CodeLocation + FixSuggestion)
    // 3. æ‹‰å–ç›®æ ‡ä»“åº“ä»£ç  (git clone / GitHub API)
    // 4. ç”Ÿæˆä¿®å¤ä»£ç  (code æ¨¡å‹)
    // 5. æœ¬åœ°éªŒè¯ (lint, type check)
    // 6. åˆ›å»ºåˆ†æ”¯ + Commit
    // 7. Push + åˆ›å»º PR (GitHub API)
    // 8. å­˜å‚¨ Fix è®°å½•
    // 9. æ›´æ–°ç¼ºé™·çŠ¶æ€ â†’ PrCreated
    // 10. é€šçŸ¥å®¡æ ¸äºº
}
```

---

## åä¸€ã€åŸºç¡€è®¾æ–½éœ€æ±‚

### 11.1 ä»£ç ç´¢å¼•æœåŠ¡

ä¸ºäº†è®© AI èƒ½å®šä½ä»£ç ï¼Œéœ€è¦ä»£ç åº“ç´¢å¼•åŸºç¡€è®¾æ–½ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ä»£ç ç´¢å¼•åŸºç¡€è®¾æ–½                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ–¹æ¡ˆ A: GitHub API å®æ—¶æŸ¥è¯¢ (MVP)                           â”‚
â”‚  â”œâ”€ ä½¿ç”¨ GitHub Search API æœç´¢ä»£ç                           â”‚
â”‚  â”œâ”€ ä½¿ç”¨ Contents API è¯»å–æ–‡ä»¶                               â”‚
â”‚  â”œâ”€ ä¼˜ç‚¹ï¼šæ— éœ€æœ¬åœ°å­˜å‚¨ï¼Œå®æ—¶æ€§å¥½                              â”‚
â”‚  â””â”€ ç¼ºç‚¹ï¼šAPI é™æµï¼Œå“åº”æ…¢                                   â”‚
â”‚                                                             â”‚
â”‚  æ–¹æ¡ˆ B: æœ¬åœ° Clone + ç´¢å¼• (æ¨è)                            â”‚
â”‚  â”œâ”€ å®šæ—¶ git pull ä¿æŒåŒæ­¥                                   â”‚
â”‚  â”œâ”€ ä½¿ç”¨ tree-sitter è§£æ AST                               â”‚
â”‚  â”œâ”€ æ„å»ºå€’æ’ç´¢å¼• (ç¬¦å·â†’æ–‡ä»¶ä½ç½®)                              â”‚
â”‚  â”œâ”€ ä¼˜ç‚¹ï¼šæŸ¥è¯¢å¿«ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢                                â”‚
â”‚  â””â”€ ç¼ºç‚¹ï¼šéœ€è¦å­˜å‚¨ç©ºé—´å’ŒåŒæ­¥æœºåˆ¶                              â”‚
â”‚                                                             â”‚
â”‚  æ–¹æ¡ˆ C: Embedding + å‘é‡æ•°æ®åº“ (é«˜çº§)                       â”‚
â”‚  â”œâ”€ ä»£ç å— embedding å­˜å…¥å‘é‡åº“                              â”‚
â”‚  â”œâ”€ ç¼ºé™·æè¿° â†’ å‘é‡ç›¸ä¼¼æœç´¢                                  â”‚
â”‚  â”œâ”€ ä¼˜ç‚¹ï¼šè¯­ä¹‰åŒ¹é…å¼º                                         â”‚
â”‚  â””â”€ ç¼ºç‚¹ï¼šå‡†ç¡®æ€§ä¾èµ– embedding è´¨é‡                          â”‚
â”‚                                                             â”‚
â”‚  æ¨èè·¯å¾„: A (MVP) â†’ B (v1.5) â†’ C (v2.0)                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 è°ƒåº¦ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¿®å¤æ‰§è¡Œè°ƒåº¦                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å†³ç­–æ ‘:                                                     â”‚
â”‚                                                             â”‚
â”‚  ä¿®å¤ä»»åŠ¡åˆ°è¾¾                                                â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€ æ”¹åŠ¨ â‰¤ 3 ä¸ªæ–‡ä»¶ ä¸” â‰¤ 20 è¡Œ?                         â”‚
â”‚       â”‚   â””â”€ YES â†’ æœ¬åœ°æ¨¡å¼ (ç³»ç»Ÿå†…ç›´æ¥ç”Ÿæˆ Patch)            â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€ æ”¹åŠ¨ â‰¤ 10 ä¸ªæ–‡ä»¶?                                   â”‚
â”‚       â”‚   â””â”€ YES â†’ PR æ¨¡å¼ (åˆ›å»º Branch + PR)               â”‚
â”‚       â”‚                                                     â”‚
â”‚       â””â”€ æ”¹åŠ¨ > 10 ä¸ªæ–‡ä»¶?                                   â”‚
â”‚           â””â”€ æ ‡è®°ä¸º Manualï¼Œä»…ç»™å‡ºåˆ†ææŠ¥å‘Š                    â”‚
â”‚                                                             â”‚
â”‚  æœ¬åœ°æ¨¡å¼æ‰§è¡Œ:                                               â”‚
â”‚  1. è¯»å–ç›®æ ‡æ–‡ä»¶ (GitHub Contents API)                       â”‚
â”‚  2. LLM ç”Ÿæˆä¿®å¤ä»£ç                                          â”‚
â”‚  3. éªŒè¯ diff åˆç†æ€§                                         â”‚
â”‚  4. é€šè¿‡ GitHub API åˆ›å»º Commit                              â”‚
â”‚  5. åˆ›å»º PR                                                 â”‚
â”‚                                                             â”‚
â”‚  PR æ¨¡å¼æ‰§è¡Œ:                                                â”‚
â”‚  1. Clone ä»“åº“åˆ°ä¸´æ—¶ç›®å½•                                      â”‚
â”‚  2. åˆ›å»ºä¿®å¤åˆ†æ”¯                                              â”‚
â”‚  3. LLM ç”Ÿæˆä¿®å¤ä»£ç                                          â”‚
â”‚  4. æœ¬åœ° lint + test                                         â”‚
â”‚  5. Push + åˆ›å»º PR                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åäºŒã€åä½œå¹³å°é›†æˆ

### 12.1 é€šçŸ¥æœºåˆ¶

| äº‹ä»¶ | é€šçŸ¥å¯¹è±¡ | é€šçŸ¥æ–¹å¼ |
|------|---------|---------|
| ç¼ºé™·æäº¤ | ç®¡ç†å‘˜ | ç³»ç»Ÿé€šçŸ¥ (AdminNotification) |
| AI å®¡æ ¸å®Œæˆ | æäº¤è€… | ç³»ç»Ÿé€šçŸ¥ |
| AI é©³å› | æäº¤è€… | ç³»ç»Ÿé€šçŸ¥ + é©³å›ç†ç”± |
| PR åˆ›å»º | å®¡æ ¸äºº | ç³»ç»Ÿé€šçŸ¥ + GitHub Notification |
| PR åˆå¹¶ | æäº¤è€… | ç³»ç»Ÿé€šçŸ¥ |
| éœ€è¦ä¿¡æ¯è¡¥å…… | æäº¤è€… | ç³»ç»Ÿé€šçŸ¥ |

### 12.2 æŒ‡æ´¾ä¸çŠ¶æ€æµè½¬

```
æäº¤è€…æäº¤ â†’ ç³»ç»Ÿè‡ªåŠ¨æŒ‡æ´¾ (è½®è¯¢/è´Ÿè½½å‡è¡¡) â†’ å®¡æ ¸äººæ”¶åˆ°é€šçŸ¥
                              â†“
              å®¡æ ¸äººå¯ä»¥ï¼šæ¥å— / è½¬æ´¾ / æ‹’ç»
                              â†“
              æ¥å—åè¿›å…¥ AI ä¿®å¤æµç¨‹
                              â†“
              PR åˆ›å»º â†’ å®¡æ ¸äºº Code Review
                              â†“
              åˆå¹¶å â†’ é€šçŸ¥æäº¤è€…éªŒè¯
```

### 12.3 GitHub Webhook äº‹ä»¶å¤„ç†

| GitHub äº‹ä»¶ | ç³»ç»ŸåŠ¨ä½œ |
|------------|---------|
| `pull_request.merged` | æ›´æ–°ç¼ºé™·çŠ¶æ€ä¸º Merged |
| `pull_request.closed` (æœªåˆå¹¶) | æ›´æ–°ä¿®å¤çŠ¶æ€ä¸º Rejected |
| `issue_comment.created` | åŒæ­¥è¯„è®ºåˆ°ç¼ºé™·æ—¶é—´çº¿ |
| `pull_request_review.submitted` | åŒæ­¥ Review çŠ¶æ€ |

---

## åä¸‰ã€Debugger Skill

### 13.1 æ—¥å¿—è§„èŒƒ

```csharp
// Controller å±‚
_logger.LogInformation("[defect-agent] Create defect by {UserId}: {Title}", userId, title);
_logger.LogInformation("[defect-agent] Submit defect {DefectId} for review", defectId);

// Worker å±‚
_logger.LogInformation("[defect-agent:review] Run {RunId} started for defect {DefectId}", runId, defectId);
_logger.LogInformation("[defect-agent:review] Step {Step} completed: {Verdict}", step, verdict);
_logger.LogWarning("[defect-agent:review] Run {RunId} step {Step} timeout, retrying", runId, step);
_logger.LogError(ex, "[defect-agent:fix] PR creation failed for defect {DefectId}", defectId);

// GitHub é›†æˆå±‚
_logger.LogInformation("[defect-agent:github] PR #{PrNumber} created for defect {DefectId}", prNumber, defectId);
_logger.LogInformation("[defect-agent:github] Webhook received: {Event}", eventType);
```

### 13.2 è°ƒè¯•è·¯å¾„

```
é—®é¢˜æ’æŸ¥è·¯å¾„ï¼š

1. ç¼ºé™·æäº¤å¤±è´¥
   â†’ Controller æ—¥å¿— â†’ æƒé™ä¸­é—´ä»¶æ—¥å¿— â†’ MongoDB å†™å…¥æ—¥å¿—

2. AI å®¡æ ¸å¡ä½
   â†’ Worker æ—¥å¿— â†’ RunEventStore äº‹ä»¶ â†’ LLM è¯·æ±‚æ—¥å¿— (llm_request_logs)
   â†’ SmartModelScheduler æ—¥å¿—ï¼ˆæ¨¡å‹å¯ç”¨æ€§ï¼‰

3. PR åˆ›å»ºå¤±è´¥
   â†’ DefectFixWorker æ—¥å¿— â†’ GitHub API å“åº”æ—¥å¿—
   â†’ æ£€æŸ¥ Token æœ‰æ•ˆæ€§ â†’ æ£€æŸ¥ä»“åº“æƒé™

4. Webhook æœªè§¦å‘
   â†’ GitHub Webhook æŠ•é€’è®°å½• â†’ /api/defect-agent/github/webhook æ—¥å¿—
   â†’ Webhook Secret éªŒè¯æ—¥å¿—

5. SSE æ–­è¿
   â†’ RunEventStore äº‹ä»¶åºåˆ— â†’ afterSeq å¯¹æ¯”
   â†’ å®¢æˆ·ç«¯é‡è¿æ—¥å¿—
```

### 13.3 è°ƒè¯•æ£€æŸ¥æ¸…å•

- [ ] æƒé™æ‹’ç»è¿”å› 403 ä¸”æœ‰æ—¥å¿—
- [ ] Worker å•æ¡ä»»åŠ¡å¼‚å¸¸ä¸å½±å“åç»­ä»»åŠ¡å¤„ç†
- [ ] GitHub Token è¿‡æœŸè‡ªåŠ¨æç¤ºç”¨æˆ·é‡æ–°æˆæƒ
- [ ] LLM è°ƒç”¨è¶…æ—¶ (30s) æœ‰åˆç†å›é€€å’Œé‡è¯•
- [ ] å¤§æ–‡ä»¶ (>100KB) æˆªå›¾ä¸Šä¼ æœ‰å¤§å°é™åˆ¶æç¤º
- [ ] å¹¶å‘æäº¤åŒä¸€ç¼ºé™·æœ‰å¹‚ç­‰å¤„ç†
- [ ] Webhook éªŒè¯å¤±è´¥è¿”å› 401 ä¸”è®°å½•æ¥æº IP

---

## åå››ã€æµ‹è¯•æ–¹æ¡ˆ

### 14.1 åç«¯æµ‹è¯•

```
Tests/
â”œâ”€â”€ DefectAgent.Controller.Tests.cs
â”‚   â”œâ”€â”€ CreateDefect_ValidInput_ReturnsCreated
â”‚   â”œâ”€â”€ CreateDefect_MissingTitle_ReturnsBadRequest
â”‚   â”œâ”€â”€ SubmitDefect_DraftStatus_MovesToSubmitted
â”‚   â”œâ”€â”€ SubmitDefect_AlreadySubmitted_ReturnsBadRequest
â”‚   â”œâ”€â”€ TriggerFix_NoReviewPermission_ReturnsForbidden
â”‚   â””â”€â”€ GithubWebhook_InvalidSignature_ReturnsUnauthorized
â”‚
â”œâ”€â”€ DefectAgent.ReviewWorker.Tests.cs
â”‚   â”œâ”€â”€ Process_CompleteInfo_PassesTriage
â”‚   â”œâ”€â”€ Process_IncompleteInfo_ReturnsNeedInfo
â”‚   â”œâ”€â”€ Process_DuplicateDefect_MarksDuplicate
â”‚   â”œâ”€â”€ Process_LlmTimeout_RetriesWithBackoff
â”‚   â””â”€â”€ Process_VisionAnalysis_LocatesFiles
â”‚
â”œâ”€â”€ DefectAgent.FixWorker.Tests.cs
â”‚   â”œâ”€â”€ Process_SimpleFixAutoMode_CreatesPR
â”‚   â”œâ”€â”€ Process_ComplexFix_MarksManual
â”‚   â”œâ”€â”€ Process_GithubApiError_RecordsFailure
â”‚   â””â”€â”€ Process_BranchConflict_ReportsToUser
â”‚
â””â”€â”€ DefectAgent.GithubIntegration.Tests.cs
    â”œâ”€â”€ CreatePR_ValidPatch_ReturnsUrl
    â”œâ”€â”€ HandleWebhook_MergeEvent_UpdatesStatus
    â”œâ”€â”€ RefreshToken_Expired_ThrowsAuthException
    â””â”€â”€ ValidateSignature_ValidPayload_ReturnsTrue
```

### 14.2 å‰ç«¯æµ‹è¯•

```
__tests__/
â”œâ”€â”€ DefectListPage.test.tsx
â”‚   â”œâ”€â”€ renders_kanban_view_by_default
â”‚   â”œâ”€â”€ filters_by_status
â”‚   â”œâ”€â”€ switches_to_list_view
â”‚   â””â”€â”€ shows_empty_state_when_no_defects
â”‚
â”œâ”€â”€ DefectSubmitPage.test.tsx
â”‚   â”œâ”€â”€ validates_required_fields
â”‚   â”œâ”€â”€ uploads_screenshots
â”‚   â”œâ”€â”€ saves_draft
â”‚   â””â”€â”€ submits_for_review
â”‚
â”œâ”€â”€ DefectDetailPage.test.tsx
â”‚   â”œâ”€â”€ shows_timeline
â”‚   â”œâ”€â”€ shows_code_location
â”‚   â”œâ”€â”€ handles_sse_stream
â”‚   â””â”€â”€ triggers_fix_action
â”‚
â”œâ”€â”€ defectAgentStore.test.ts
â”‚   â”œâ”€â”€ creates_defect
â”‚   â”œâ”€â”€ updates_status_on_submit
â”‚   â”œâ”€â”€ handles_sse_events
â”‚   â””â”€â”€ clears_state_on_close
â”‚
â””â”€â”€ defectAgentService.test.ts
    â”œâ”€â”€ calls_correct_endpoints
    â”œâ”€â”€ handles_api_errors
    â””â”€â”€ serializes_environment_info
```

---

## åäº”ã€å¼€å‘é‡Œç¨‹ç¢‘

### Phase 1: MVP (æ ¸å¿ƒé—­ç¯)

- [ ] ç¼ºé™· CRUD + çŠ¶æ€æµè½¬
- [ ] æˆªå›¾ä¸Šä¼ 
- [ ] AI åˆå®¡ (ä¿¡æ¯å®Œæ•´æ€§ + å¤ç°æ€§è¯„ä¼°)
- [ ] åŸºæœ¬çš„ä»£ç å®šä½ (GitHub Search API)
- [ ] ç®€å•ä¿®å¤å»ºè®® (æ–‡æœ¬æŠ¥å‘Š)
- [ ] å‰ç«¯ï¼šæäº¤è¡¨å• + åˆ—è¡¨ + è¯¦æƒ…é¡µ

### Phase 2: GitHub é›†æˆ

- [ ] GitHub App / PAT æˆæƒ
- [ ] è‡ªåŠ¨åˆ›å»º PR
- [ ] Webhook çŠ¶æ€åŒæ­¥
- [ ] PR é¢„è§ˆç»„ä»¶
- [ ] å®¡æ ¸äººæŒ‡æ´¾ä¸é€šçŸ¥

### Phase 3: æ™ºèƒ½å¢å¼º

- [ ] é‡å¤æ£€æµ‹ (Embedding ç›¸ä¼¼åº¦)
- [ ] ä»£ç ç´¢å¼•æœåŠ¡ (æœ¬åœ° Clone + ç´¢å¼•)
- [ ] å¤šæ­¥éª¤ä¿®å¤ (å¤æ‚ Bug)
- [ ] ä¿®å¤éªŒè¯ (è‡ªåŠ¨è¿è¡Œæµ‹è¯•)
- [ ] ç»Ÿè®¡çœ‹æ¿

### Phase 4: åä½œæ·±åŒ–

- [ ] çœ‹æ¿è§†å›¾ (æ‹–æ‹½)
- [ ] å›¢é˜Ÿåä½œ (æŒ‡æ´¾/è½¬æ´¾)
- [ ] è¯„è®ºç³»ç»Ÿ
- [ ] SLA å‘Šè­¦ (è¶…æ—¶æœªå¤„ç†)
- [ ] ä¸å¤–éƒ¨ Issue Tracker é›†æˆ (Jira/Linear)

---

## åå…­ã€é£é™©ä¸çº¦æŸ

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| LLM å¹»è§‰å¯¼è‡´é”™è¯¯å®šä½ | ä¿®å¤æ— æ•ˆä»£ç  | ç½®ä¿¡åº¦é˜ˆå€¼ + äººå·¥ç¡®è®¤ |
| GitHub API é™æµ | æ‰¹é‡æ“ä½œé˜»å¡ | è¯·æ±‚é˜Ÿåˆ— + æŒ‡æ•°é€€é¿ |
| å¤§å‹ä»“åº“ä»£ç é‡å¤§ | åˆ†æè¶…æ—¶ | å¢é‡ç´¢å¼• + èŒƒå›´é™å®š |
| Token æ³„éœ² | å®‰å…¨é£é™© | åŠ å¯†å­˜å‚¨ + æœ€å°æƒé™ + å®šæœŸè½®æ¢ |
| å¹¶å‘ä¿®å¤å†²çª | PR åˆå¹¶å†²çª | ä¸²è¡Œå¤„ç† + å†²çªæ£€æµ‹ |
| AI ä¿®å¤å¼•å…¥æ–° Bug | ä»£ç è´¨é‡ | å¼ºåˆ¶ Review + CI é—¨ç¦ |
